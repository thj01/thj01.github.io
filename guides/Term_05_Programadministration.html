<!DOCTYPE html>

<head>
	
	<meta charset="UTF-8" lang="da"/>

	<title>Vidas.dk</title>

	<link rel="stylesheet" href="../css/style.css" />
	<link rel="stylesheet" href="../css/styles/docco.css" />
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

	<script src="http://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script src="../js/toc2.js" type="text/javascript"></script>
	<script>$(function(){$("#license").load("license.html"); });</script>
	<script type="text/javascript" async
		src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
		MathJax.Hub.Config({ jax: ["input/TeX","output/HTML-CSS"], displayAlign: "left"
 		});
	</script>
        <script>
	$(document).ready(function(){
		$(".hide").click(function(){$("#toc").hide();});
		$(".show").click(function(){$("#toc").show();});
	});
	</script>
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<!-- 
code highlighter : https://highlightjs.org/
code converter : http://www.freebits.co.uk/convert-html-code-to-text.html 
-->
<html>
<body onload="generateTOC(document.getElementById('toc'));">

<footer id="license"></footer>

<header>
	<div class="show" id="toggle_menu"></div> 
</header>

<div class="toggle">
	<div id="toc" class="hide">
		<div id="toc_title"><span class=""><a href="#" target="">(Luk)</a></span></div>	
	</div>
</div>
		
<p></p><p></p>

<div class="title">Kommandoer</div>
	

<h1>Programadministration</h1>

<h2><span class="inl_cmd">apt</span> - program administration og vedligeholdelse</h2>

<p>Ubuntu anvender Debians pakkesystem <span class="inl_cmd">dpkg</span> (Debian package management system), som bliver administreret af programmet <span class="inl_cmd">apt</span> (Advances Packaging tool). Gevinsten ved at bruge kommandolinien er et stærkt og fleksibelt værktøj til at administrere ens programmer.</p>

<p><span class="inl_cmd">apt</span> har en konfigurationsfil (<span class="inl_cmd">/etc/apt/sources.list</span>), der henviser til nogle repositories (programbiblioteker) på Internettet. Når man beder <span class="inl_cmd">apt</span> om at installeret et program søger det efter filerne i disse repositories. Man kan tilføje flere repositories enten ved at tilføje dem til <span class="inl_cmd">/etc/apt/sources.list</span> eller ved at tilføje PPA'er (<span class="bold">P</span>ersonal <span class="bold">P</span>ackage <span class="bold">A</span>rchieve) som er mindre pakkearkiver oprettet af private eller programudbydere.</p>

<p>Eksempler:</p>

<table class="cmd_table">
	<thead>
		<tr>
			<th></th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>apt update</td>
			<td>Synkroniserer din lokale apt med dine repositories.</td>
		</tr>
		<tr>
			<td>apt upgrade</td>
			<td>Opgraderer alle programmer på computeren som apt kontrollerer.</td>
		</tr>
		<tr>
			<td>apt upgrade -y</td>
			<td>Som ovenfor, men udfører kommandoen automatisk. Alle kommandoerne kan køres med -y</td>
		</tr>
		<tr>
			<td>apt dist-upgrade</td>
			<td>Opgraderer programmer samt de nødvendige programmer til den nyeste version der findes i <span class="inl_cmd">/etc/apt/sources.list</span> også selvom det ikke er din servers foretrukne version af programmet.</td>
		</tr>
		<tr>
			<td>apt remove [program]</td>
			<td>Fjerner [program]</td>
		</tr>
		<tr>
			<td>apt purge [program]</td>
			<td>Fjerner program og alle dets filer - også konfigurationsfiler</td>
		</tr>
		<tr>
			<td>apt autoremove</td>
			<td>Gennemgår apt og fjerner alle filer der ikke er i brug.</td>
		</tr>
		<tr>
			<td>apt clean</td>
			<td>Fjerner alle hentede pakker</td>
		</tr>
		<tr>
			<td>dpkg --configure -a</td>
			<td>Det sker at apt ikke kan anvendes fordi noget er låst (f.eks. hvis en proces er blevet afbrudt. Denne kommando reconfigurerer pakkesystemet.</td>
		</tr>
	</tbody>
</table>

<p>Man bør opdatere sine repositories og have alle programmer på computeren opdateret før man installerer nye programmer. Det er især vigtigt at opdatere hvis man lige har tilføjet  nye repositories eller PPA'er, da de ellers ikke vil blive anvendt.</p>

<p>man-page: <span class="inl_cmd">apt</span>
<a href="http://manpages.ubuntu.com/manpages/xenial/en/man8/apt.8.html" target="_blank">
http://manpages.ubuntu.com/manpages/xenial/en/man8/apt.8.html</a></p>

<h2>Når <span class="inl_cmd">apt</span> fejler</h2>

<p>Det hænder at <span class="inl_cmd">apt</span> fejler. Når dette sker kan det være nødvendigt at få <span class="inl_cmd">apt</span> til at reconfigurere sig selv. Det gøres med kommandoen:</p>

<code class="cmd">sudo dpkg --configure -a</code>

<p>Når <span class="inl_cmd">apt</span> er geninitialiseret kan man genstarte processen med kommandoen, hvor -f står for "fix broken":</p>

<code class="cmd">sudo apt install -f</code>

<h2>Administration af tjenester på serveren</h2>

<p>Generelt administreres tjenester på på Ubuntu med service kommandoen. Den fungerer efter nedestående skabelon:</p>

<code class="cmd">systemctl {start|stop|reload|restart|force-reload|status} [tjeneste]</code>

<p>Ønsker du f.eks. at genstarte <span class="cmd_inl">bind9</span> tjenesten gøres det med kommandoen:</p>

<code class="cmd">systemctl restart bind9</code>

<p>For at tjekke om en tjeneste kører</p>

<code class="cmd">systemctl status bind9</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ systemctl status bind9
● bind9.service
   Loaded: not-found (Reason: No such file or directory)
   Active: inactive (dead)
</pre>

<p>man-page: <span class="inl_cmd">service</span>
<a href="http://manpages.ubuntu.com/manpages/trusty/en/man8/service.8.html" target="_blank">
http://manpages.ubuntu.com/manpages/trusty/en/man8/service.8.html</a></p>

<h2>Fjerne overflødige kerner</h2>

<p>Ubuntu beholder de gamle kerner der ligger på systemet, så de kan anvendes til at boote med. Dette er en sikkerhedsfeature, da man risikerer at nye kerner indeholder fejl, eller mangler funktionalitet som dine programmer anvender. De fylder dog en del.</p>

<p>De kan fjernes med følgende kommando (en linie):</p>

<code class="cmd">sudo apt purge $(dpkg -l linux-{image,headers}-"[0-9]*" | awk '/ii/{print $2}' | grep -ve $(uname -r | sed -r 's/-[a-z]+//') | sed ':a;N;$!ba;s/\n/ /g')</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo apt purge $(dpkg -l linux-{image,headers}-"
[0-9]*" | awk '/ii/{print $2}' | grep -ve $(uname -r | sed -r 's/-[a-z]+//') 
| sed ':a;N;$!ba;s/\n/ /g')
Indlæser pakkelisterne... Færdig
Opbygger afhængighedstræ        
Læser tilstandsoplysninger... Færdig
Følgende pakker vil blive AFINSTALLERET:
  linux-generic-lts-utopic* linux-headers-3.16.0-30*
  linux-headers-3.16.0-30-generic* linux-headers-3.16.0-46*
  linux-headers-3.16.0-46-generic* linux-headers-generic-lts-utopic*
  linux-image-3.16.0-30-generic* linux-image-3.16.0-46-generic*
  linux-image-extra-3.16.0-30-generic* linux-image-extra-3.16.0-46-generic*
  linux-image-generic-lts-utopic*
0 opgraderes, 0 nyinstalleres, 11 afinstalleres og 0 opgraderes ikke.
Efter denne handling, vil 559 MB diskplads blive frigjort.
Vil du fortsætte? [J/n]
</pre>

<h1>Repositories</h1>

<p>Ubuntu har adgang til sine programmer ved hjælp af repositories eller PPA'er (<span class="bold">P</span>ersonal <span class="bold">P</span>ackage <span class="bold">A</span>rchieve).</p>

<p>Herunder vil du lære at aktivere, tilføje og fjerne repositories ved hjælp af at redigere i konfigurationsfilen <span class="inl_cmd">/etc/apt/sources.list</span> og ved at anvende kommandolinien.</p>

<h2>Ved hjælp af <span class="inl_cmd">sources.list</span></h2>

<p>Et repository bliver konfigureret ved hjælp af en "dev" linie:</p>

<pre class="black">
<span class="brown">deb</span> <span class="green1">http://extras.ubuntu.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">main</span>
</pre>

<p>Linien fortæller hvor den er placeret, hvilken distribution det drejer sig om og hvad det hedder. Læg mærke til at nogle af linierne starter med <span class="brown">deb-src</span>. <span class="inl_cmd">src</span> står for source og giver adgang til programmernes kildekode. Disse linier er ikke nødvendige for langt de fleste brugere. Hvis du ikke ønsker at anvende tid på at gennemsøge disse linier kan du med fordel sætte et <span class="inl_cmd">#</span> foran så linien bliver udkommenteret.</p>

<p>Da ubuntu blev installeret blev <span class="inl_cmd">/etc/apt/sources.list</span> konfigureret med standard repositories. Det betyder bl.a. at "partner" repositoriet er deaktiveret. I dette reposiory ligger der proporitære og closed-source programmer som kan være praktiske at få adgang til. Det skal vi have ændret. Åbn <span class="inl_cmd">/etc/apt/sources.list</span> med <span class="inl_cmd">nano</span> gå ned i bunden af filen:</p>

<code class="cmd">nano /etc/apt/sources.list</code>

<pre class="black">
<span class="blue1">## Uncomment the following two lines to add software from Canonical's
## 'partner' repository.
## This software is not part of Ubuntu, but is offered by Canonical and the
## respective vendors as a service to Ubuntu users.
# deb http://archive.canonical.com/ubuntu xenial partner <span class="red">&lt;-- denne linie skal ændres</span>
# deb-src http://archive.canonical.com/ubuntu xenial partner <span class="red">&lt;-- denne linie skal ændres</span>

## This software is not part of Ubuntu, but is offered by third-party
## developers who want to ship their latest software.</span>
<span class="brown">deb</span> <span class="green1">http://extras.ubuntu.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">main</span>
<span class="brown">deb-src</span> <span class="green1">http://extras.ubuntu.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">main</span>
</pre>

<p>Som du kan se herover har flere af linierne et <span class="inl_cmd">#</span> foran sig. Det betyder at de er udkommenteret, og derfor ikke bliver læst af programmet. Fjern <span class="inl_cmd">#</span> foran linierne så de kommer til at se ud som herunder:</p>

<pre class="black">
<span class="brown">deb</span> <span class="green1">http://archive.canonical.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">partner</span>
<span class="brown">deb-src</span> <span class="green1">http://archive.canonical.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">partner</span>
</pre>

<p>Opdater <span class="inl_cmd">apt</span>, så man fremover har adgang til programmer herfra.</p>

<code class="cmd">sudo apt update</code>

<h2>Ved hjælp af PPA</h2>

<p>Der findes en række repositories som er generelle for Ubuntu og Debian distributioner, og som bliver vedligeholdt til at tjene specifikke distributioner. Det hænder dog at man gerne vil have andre versioner af programmerne end disse repositories tilbyder. Dette bliver løst ved hjælp af PPA'er (<span class="bold">P</span>ersonal <span class="bold">P</span>ackage <span class="bold">A</span>archives).</p>

<p>Man skal dog være klar over at man ved at tilføje PPA'er tilføjer funktionalitet til sin distribution, og derved ofte installerer nyere version af programmer og afhængigheder udviklerne af distributionen har sagt god for. Derfor er det vigtigt at man kun anvender anerkendte PPA. Specielt når man anvender LTS systemer, vil der i løbet af 2 år komme opdateringer til programmer, som kan være nødvendige for ens workflow</p>

<p>Nedestående kommando tilføjer PPA linien og sikkerhedsnøgler til systemet.</p>

<code class="cmd">add-apt-repository PPA:[PPA navn] -y</code>

<p>Hvis man f.eks. ønsker at have den nyeste version af GIMP'en installeret anvender man PPA'en : <span class="inl_cmd">ppa:otto-kesselgulasch/gimp</span>. Den aktiveres med følgende kommando:</p>

<code class="cmd">add-apt-repository ppa:otto-kesselgulasch/gimp -y</code>

<p>Herefter vil commandoen oprette to nye filer i mappen <span class="inl_cmd">/etc/apt/sources.list.d</span>, så <span class="inl_cmd">apt</span> fremover kigger i dette arkiv også.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ls -a /etc/apt/sources.list.d | grep otto
<span class="red">otto</span>-kesselgulasch-gimp-trusty.list
<span class="red">otto</span>-kesselgulasch-gimp-trusty.list.save
</pre>

<p>Hvis programmet indeholder afhængigheder til nyere versioner af programmer der er installeret på computeren skal man udføre en <span class="inl_cmd">dist-upgrade</span>, f.eks:</p>

<code class="cmd">apt dist-upgrade -y</code>

<p>Nogle gange giver en <span class="inl_cmd">apt upgrade</span> Besked om at nogle pakker er blevet holdt tilbage efter en PPA opdatering (se rød markering).</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo apt upgrade
Indlæser pakkelisterne... Færdig
Opbygger afhængighedstræ        
Læser tilstandsoplysninger... Færdig
Beregner opgraderingen ... Færdig
<span class="red">Følgende pakker er blevet holdt tilbage:</span>
  linux-generic-lts-utopic linux-headers-generic-lts-utopic
  linux-image-generic-lts-utopic
0 opgraderes, 0 nyinstalleres, 0 afinstalleres og 3 opgraderes ikke.
</pre>

<p>Det skyldes, at de nye versioner der skal installeres kræver nyere filer end dem der er installeret. Dem skal du opdatere og det gøres ved at sætte <span class="inl_cmd">apt</span> til at lave en <span class="inl_cmd">dist-upgrade</span></p>

<code class="cmd">sudo apt dist-upgrade</code>

<h2>Fjerne PPA filer</h2>

<p>Hvis man ønsker at fjerne en PPA er den bedste metode at installere programmet <span class="inl_cmd">ppa-purge</span>. Det kan gøres manuelt, men for at sikre sig at Ubuntu kun anvender de normalt tilgængelige kræver det at man afinstallerer og geninstallere programmerne.</p>

<p>Installer <span class="inl_cmd">ppa-purge</span></p>

<code class="cmd">sudo apt install ppa-purge -y</code>

<p>Herefter kan en PPA-fil fjernes med kommandoen:</p>

<code class="cmd">sudo ppa-purge *PPA-navn*</code>

<p></p>
<p></p>
<p></p>
<p></p>

	</body>

</html>
