<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vidas.dk</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/jquery-ui.min.css">
  <link rel="stylesheet" href="../css/jquery.tocify.css">
  <link rel="stylesheet" href="../css/style_new.css" />
<!-- Scripts in bottom to speed up pageload-->
 

</head>
<body>
	
	
<div class="container-fluid">

<div class="row-fluid">
	
<div class="col-sm-3">
	
	<div id="toc">
	
		<div id="toc_headline"></div>
	
	</div>

</div><!-- Start slut 1. kolonne - TOC -->
	
<div class="col-sm-9">
	
<div class="title">Kommandoer <br/>Programadministration</div>
	
<h1><span class="inl_cmd">apt</span></h1>

<p>Ubuntu anvender Debians pakkesystem <span class="inl_cmd">dpkg</span> (Debian package management system), som bliver administreret af programmet <span class="inl_cmd">apt</span> (Advances Packaging tool). Gevinsten ved at bruge kommandolinien er et stærkt og fleksibelt værktøj til at administrere ens programmer.</p>

<p><span class="inl_cmd">apt</span> har en konfigurationsfil (<span class="inl_cmd">/etc/apt/sources.list</span>), der henviser til nogle repositories (programbiblioteker) på Internettet. Når man beder <span class="inl_cmd">apt</span> om at installeret et program søger det efter filerne i disse repositories. Man kan tilføje flere repositories enten ved at tilføje dem til <span class="inl_cmd">/etc/apt/sources.list</span> eller ved at tilføje PPA'er (<span class="bold">P</span>ersonal <span class="bold">P</span>ackage <span class="bold">A</span>rchieve) som er mindre pakkearkiver oprettet af private eller programudbydere.</p>

<p>Eksempler:</p>

<table class="cmd_table">
	<thead>
		<tr>
			<th></th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>apt update</td>
			<td>Synkroniserer din lokale apt med dine repositories.</td>
		</tr>
		<tr>
			<td>apt upgrade</td>
			<td>Opgraderer alle programmer på computeren som apt kontrollerer.</td>
		</tr>
		<tr>
			<td>apt upgrade -y</td>
			<td>Som ovenfor, men udfører kommandoen automatisk. Alle kommandoerne kan køres med -y</td>
		</tr>
		<tr>
			<td>apt dist-upgrade</td>
			<td>Opgraderer programmer samt de nødvendige programmer til den nyeste version der findes i <span class="inl_cmd">/etc/apt/sources.list</span> også selvom det ikke er din servers foretrukne version af programmet.</td>
		</tr>
		<tr>
			<td>apt remove [program]</td>
			<td>Fjerner [program]</td>
		</tr>
		<tr>
			<td>apt purge [program]</td>
			<td>Fjerner program og alle dets filer - også konfigurationsfiler</td>
		</tr>
		<tr>
			<td>apt autoremove</td>
			<td>Gennemgår apt og fjerner alle filer der ikke er i brug.</td>
		</tr>
		<tr>
			<td>apt clean</td>
			<td>Fjerner alle hentede pakker</td>
		</tr>
		<tr>
			<td>dpkg --configure -a</td>
			<td>Det sker at apt ikke kan anvendes fordi noget er låst (f.eks. hvis en proces er blevet afbrudt. Denne kommando reconfigurerer pakkesystemet.</td>
		</tr>
	</tbody>
</table>

<p>Man bør opdatere sine repositories og have alle programmer på computeren opdateret før man installerer nye programmer. Det er især vigtigt at opdatere hvis man lige har tilføjet  nye repositories eller PPA'er, da de ellers ikke vil blive anvendt.</p>

<p>man-page: <span class="inl_cmd">apt</span>
<a href="http://manpages.ubuntu.com/manpages/xenial/en/man8/apt.8.html" target="_blank">
http://manpages.ubuntu.com/manpages/xenial/en/man8/apt.8.html</a></p>

<h1>Når <span class="inl_cmd">apt</span> fejler</h1>

<p>Det hænder at <span class="inl_cmd">apt</span> fejler. Når dette sker kan det være nødvendigt at få <span class="inl_cmd">apt</span> til at reconfigurere sig selv. Det gøres med kommandoen:</p>

<code class="cmd">sudo dpkg --configure -a</code>

<p>Når <span class="inl_cmd">apt</span> er geninitialiseret kan man genstarte processen med kommandoen, hvor -f står for "fix broken":</p>

<code class="cmd">sudo apt install -f</code>

<h1>Administration af tjenester på serveren</h1>

<p>Generelt administreres tjenester på på Ubuntu med service kommandoen. Den fungerer efter nedestående skabelon:</p>

<code class="cmd">service {start|stop|reload|restart|force-reload|status} [tjeneste]</code>

<p>Det som de forskellige muligheder gør er:</p>

<ul class="disc">
	<li><span class="inl_cmd">start</span> - starter tjenesten (når den har været stoppet)</li>
	<li><span class="inl_cmd">stop</span> - stopper tjenesten</li>
	<li><span class="inl_cmd">reload</span> - genindlæser konfigurationsfilerne uden at tjenesten stopper</li>
	<li><span class="inl_cmd">restart</span> - genstarter tjenesten (tjenesten stopper kortvarigt)</li>
	<li><span class="inl_cmd">force-reload</span> - på ubuntu det samme som <span class="inl_cmd">reload</span></li>
	<li><span class="inl_cmd">status</span> - fortæller om tjenesten er aktiv eller ej</li>
</ul>


<p>Ønsker du f.eks. at genstarte <span class="cmd_inl">bind9</span> tjenesten gøres det med kommandoen:</p>

<code class="cmd">service restart bind9</code>

<p>For at tjekke om en tjeneste kører</p>

<code class="cmd">service status bind9</code>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ systemctl status bind9
● bind9.service
   Loaded: not-found (Reason: No such file or directory)
   Active: inactive (dead)
</pre>

<p>man-page: <span class="inl_cmd">service</span>
<a href="http://manpages.ubuntu.com/manpages/trusty/en/man8/service.8.html" target="_blank">
http://manpages.ubuntu.com/manpages/trusty/en/man8/service.8.html</a></p>

<h1>Fjerne overflødige kerner</h1>

<p>Ubuntu beholder de gamle kerner der ligger på systemet, så de kan anvendes til at boote med. Dette er en sikkerhedsfeature, da man risikerer at nye kerner indeholder fejl, eller mangler funktionalitet som dine programmer anvender. De fylder dog en del.</p>

<p>De kan fjernes med følgende kommando (en linie):</p>

<code class="cmd">sudo apt purge $(dpkg -l linux-{image,headers}-"[0-9]*" | awk '/ii/{print $2}' | grep -ve $(uname -r | sed -r 's/-[a-z]+//') | sed ':a;N;$!ba;s/\n/ /g')</code>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sudo apt purge $(dpkg -l linux-{image,headers}-"
[0-9]*" | awk '/ii/{print $2}' | grep -ve $(uname -r | sed -r 's/-[a-z]+//') 
| sed ':a;N;$!ba;s/\n/ /g')
Indlæser pakkelisterne... Færdig
Opbygger afhængighedstræ        
Læser tilstandsoplysninger... Færdig
Følgende pakker vil blive AFINSTALLERET:
  linux-generic-lts-utopic* linux-headers-3.16.0-30*
  linux-headers-3.16.0-30-generic* linux-headers-3.16.0-46*
  linux-headers-3.16.0-46-generic* linux-headers-generic-lts-utopic*
  linux-image-3.16.0-30-generic* linux-image-3.16.0-46-generic*
  linux-image-extra-3.16.0-30-generic* linux-image-extra-3.16.0-46-generic*
  linux-image-generic-lts-utopic*
0 opgraderes, 0 nyinstalleres, 11 afinstalleres og 0 opgraderes ikke.
Efter denne handling, vil 559 MB diskplads blive frigjort.
Vil du fortsætte? [J/n]
</pre>

<h1>Repositories</h1>

<blockquote>
	<p>
		<span class="inl_cmd">Repository</span>: Et sted hvor noget er opbevaret eller gemt
	</p>
</blockquote>

<p>Når <span class="inl_cmd">apt</span> administrerer programmer sker det ved at, at det henter programmet og de programmer der også skal installeres fra disse repositories. Det kan ske fra de officielle repositories som <span class="inl_cmd">main, partner, universe, restricted</span> osv. Det er også muligt at oprette sine egne repositories ved hjælp af PPA'er (<span class="bold">P</span>ersonal <span class="bold">P</span>ackage <span class="bold">A</span>rchieve) da de officielle repositories kan være ret konservative og kun tilbyde ældre versioner af nogle programmer. Man kan sørge for køre med de nyste versioner af sin software ved hjælp af PPA'er.</p>

<p>Det kan være nødvendigt, hvis man (som jeg) anvender LTS-versionerne (<b>L</b>ong <b>T</b>erm <b>S</b>upport) af Ubuntu, så man f.eks. har den nyeste version af Libreoffice, GIMP'en og andre programmer man anvender.</p>

<p>Herunder vil du lære at aktivere, tilføje og fjerne repositories ved hjælp af at redigere i konfigurationsfilen <span class="inl_cmd">/etc/apt/sources.list</span> og ved at anvende kommandolinien.</p>

<h2>VIGTIGT</h2>

<p>Når man har tilføjet repositories skal man først "aktivere" dem. Det gøres ved at køre</p>

<code class="cmd">sudo apt update</code>

<p>Kører man med LTS-versionerne, så kan det være nødvendigt at lave en <span class="inl_cmd">dist-upgrade</span>, hvor man opdatere de centrale dele af sit system. På den måde får man fordelene ved ikke-LTS'erne uden at miste de 5 års sikkerhedsopdateringen.</p>

<p>Kør kommandoen:</p>

<code class="cmd">apt dist-upgrade -y</code>

<h2>Ved hjælp af <span class="inl_cmd">sources.list</span></h2>

<p>Et repository bliver konfigureret ved hjælp af en "dev" linie:</p>

<pre class="black">
<span class="brown">deb</span> <span class="green1">http://extras.ubuntu.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">main</span>
</pre>

<p>Linien fortæller hvor den er placeret, hvilken distribution det drejer sig om og hvad repositoriet hedder. Læg mærke til at nogle af linierne starter med <span class="brown">deb-src</span>. <span class="inl_cmd">src</span> står for source og giver adgang til programmernes kildekode. Disse linier er ikke nødvendige medmindre man er programmør og udvikler. langt de fleste kan med fordel sætte et <span class="inl_cmd">#</span> foran så linierne eller helt fjerne dem.</p>

<p>Da ubuntu blev installeret blev <span class="inl_cmd">/etc/apt/sources.list</span> konfigureret med standard repositories. Det betyder bl.a. at "partner" repositoriet er deaktiveret. I dette reposiory ligger der proporitære og closed-source programmer som kan være praktiske at få adgang til. Det skal vi have ændret. Åbn <span class="inl_cmd">/etc/apt/sources.list</span> med <span class="inl_cmd">nano</span> gå ned i bunden af filen:</p>

<code class="cmd">nano /etc/apt/sources.list</code>

<pre class="black">
<span class="blue1">## Uncomment the following two lines to add software from Canonical's
## 'partner' repository.
## This software is not part of Ubuntu, but is offered by Canonical and the
## respective vendors as a service to Ubuntu users.
# deb http://archive.canonical.com/ubuntu xenial partner <span class="red">&lt;-- denne linie skal ændres</span>
# deb-src http://archive.canonical.com/ubuntu xenial partner

## This software is not part of Ubuntu, but is offered by third-party
## developers who want to ship their latest software.</span>
<span class="brown">deb</span> <span class="green1">http://extras.ubuntu.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">main</span>
<span class="brown">deb-src</span> <span class="green1">http://extras.ubuntu.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">main</span>
</pre>

<p>Som du kan se herover har flere af linierne et <span class="inl_cmd">#</span> foran sig. Det betyder at de er udkommenteret, og derfor ikke bliver læst af programmet. Fjern <span class="inl_cmd">#</span> foran <span class="inl_cmd">deb</span>-linien så det ser ud som herunder:</p>

<pre class="black">
<span class="brown">deb</span> <span class="green1">http://archive.canonical.com/ubuntu</span> <span class="red">xenial</span> <span class="violet">partner</span>
<span class="blue1"># deb-src http://archive.canonical.com/ubuntu xenial partner</span>
</pre>

<h2>Ved hjælp af PPA</h2>

<p>Der findes en række repositories som er generelle for Ubuntu og Debian distributioner, og som bliver vedligeholdt til at tjene specifikke distributioner. Det hænder dog at man gerne vil have andre versioner af programmerne end disse repositories tilbyder. Dette bliver løst ved hjælp af PPA'er (<span class="bold">P</span>ersonal <span class="bold">P</span>ackage <span class="bold">A</span>archives).</p>

<p>Nedestående kommando tilføjer PPA linien og sikkerhedsnøgler til systemet.</p>

<code class="cmd">add-apt-repository PPA:[PPA navn] -y</code>

<p>Hvis man f.eks. ønsker at have den nyeste version af GIMP'en installeret anvender man PPA'en : <span class="inl_cmd">ppa:otto-kesselgulasch/gimp</span>. Den aktiveres med følgende kommando:</p>

<code class="cmd">add-apt-repository ppa:otto-kesselgulasch/gimp -y</code>

<p>Herefter vil commandoen oprette to nye filer i mappen <span class="inl_cmd">/etc/apt/sources.list.d</span>, så <span class="inl_cmd">apt</span> fremover kigger i dette arkiv også.</p>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ ls -a /etc/apt/sources.list.d | grep otto
<span class="red">otto</span>-kesselgulasch-gimp-trusty.list
<span class="red">otto</span>-kesselgulasch-gimp-trusty.list.save
</pre>

<p>Lad os kigge på indholdet af <span class="inl_cmd">.list</span>-filen:</p>

<pre class="black">
<span class="brown">deb</span> <span class="green1">http://ppa.launchpad.net/otto-kesselgulasch/gimp/ubuntu</span> <span class="red">xenial</span> <span class="violet">main</span>
</pre>





<p>Nogle gange giver en <span class="inl_cmd">apt upgrade</span> Besked om at nogle pakker er blevet holdt tilbage efter en PPA opdatering (se rød markering).</p>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sudo apt upgrade
Indlæser pakkelisterne... Færdig
Opbygger afhængighedstræ        
Læser tilstandsoplysninger... Færdig
Beregner opgraderingen ... Færdig
<span class="red">Følgende pakker er blevet holdt tilbage:</span>
  linux-generic-lts-utopic linux-headers-generic-lts-utopic
  linux-image-generic-lts-utopic
0 opgraderes, 0 nyinstalleres, 0 afinstalleres og 3 opgraderes ikke.
</pre>

<p>Det skyldes, at installationen kræver nyere filer end dem der er tilgængelige i den konkrete version. For at få adgang til dem skal vi lave en <span class="inl_cmd">dist-upgrade</span>.</p>

<code class="cmd">sudo apt dist-upgrade</code>

<p>Herefter kører installationen igennem.</p>

<h2>Fjerne PPA'er</h2>

<p>PPA'er er nemme at fjerne manuelt. fremgangsmåden er:</p>

<ol class="">
	<li>Afinstaller programmet</li>
	<li>Fjern PPA</li>
	<li>Opdater <span class="inl_cmd">apt</span></li>
</ol>

<p>Herunder fjerner jeg program og PPA til <span class="inl_cmd">skype for linux</span>.</p>

<p>Fjern programmet</p>

<code class="cmd">sudo apt purge skypeforlinux</code>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sudo apt purge skypeforlinux 
Indlæser pakkelisterne... Færdig
Opbygger afhængighedstræ        
Læser tilstandsoplysninger... Færdig
Følgende pakker vil blive AFINSTALLERET:
  skypeforlinux*
0 opgraderes, 0 nyinstalleres, 1 afinstalleres og 0 opgraderes ikke.
Efter denne handling, vil 167 MB diskplads blive frigjort.
Vil du fortsætte? [J/n] j
(Læser database ... 200478 filer og kataloger installeret i øjeblikket.)
Afinstallerer skypeforlinux (5.3.0.1) ...
Behandler udløsere for desktop-file-utils (0.22-1ubuntu5.1) ...
Behandler udløsere for gnome-menus (3.13.3-6ubuntu3.1) ...
Behandler udløsere for mime-support (3.59ubuntu1) ...
Behandler udløsere for hicolor-icon-theme (0.15-0ubuntu1) ...
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Dan et overblik over de installerede PPA'er.</p>

<code class="cmd">ls /etc/apt/sources.list.d</code>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ ls /etc/apt/sources.list.d
danielrichter2007-ubuntu-grub-customizer-xenial.list
diesch-ubuntu-testing-xenial.list
diesch-ubuntu-testing-xenial.list.save
geany-dev-ubuntu-ppa-xenial.list
geany-dev-ubuntu-ppa-xenial.list.save
george-edison55-ubuntu-nitroshare-xenial.list
george-edison55-ubuntu-nitroshare-xenial.list.save
google-chrome.list
google-chrome.list.save
graphics-drivers-ubuntu-ppa-xenial.list
graphics-drivers-ubuntu-ppa-xenial.list.save
inkscape_dev-ubuntu-stable-xenial.list
inkscape_dev-ubuntu-stable-xenial.list.save
libreoffice-ubuntu-ppa-xenial.list
libreoffice-ubuntu-ppa-xenial.list.save
otto-kesselgulasch-ubuntu-gimp-xenial.list
otto-kesselgulasch-ubuntu-gimp-xenial.list.save
pmjdebruijn-ubuntu-darktable-release-xenial.list
pmjdebruijn-ubuntu-darktable-release-xenial.list.save
skype-stable.list
skype-stable.list.save
virtualbox.list
virtualbox.list.save
wine-ubuntu-wine-builds-xenial.list
wine-ubuntu-wine-builds-xenial.list.save
</pre>

<p>Fjern herefter de konkrete PPA'er ved hjælp af <span class="inl_cmd">rm</span>. Læg mærke til at jeg sætter <span class="inl_cmd">*</span> efter kommandoen for både at få <span class="inl_cmd">.list</span> og <span class="inl_cmd">.list.save</span>.</p>

<code class="cmd">sudo rm /etc/apt/sources.list.d/skype-stable.*</code>

<p>Opdater <span class="inl_cmd">apt</span></p>

<code class="cmd">sudo apt update</code>
	
</div><!-- end: col-md-9 -->

<footer>

	<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons licens" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>Indholdet på Vidas.dk er licenseret under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> og er skrevet af Thomas Jensen. (<a href="../hvem_er_jeg.html" target="_blank">Læs mere</a>)</p>

</footer>
	
	
</div><!-- end: row-fluid -->

</div> <!-- end: container-fluid -->


<!-- SCRIPT SECTION -->
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/jquery-ui.min.js"></script>
<script type="text/javascript" src="../js/jquery.tocify.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>

<!-- PRETTYFY-->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>


<!-- HIGHLIGHT -->
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>

<!-- MATHJAX -->
<script type="text/javascript" 
	src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "left",
  displayIndent: "0em"
});
</script>


<!-- TOCIFY -->
<script>
	$(function() {var toc = $("#toc").tocify({ selectors: "h1, h2, h3, h4" }).data("toc-tocify"); });
</script>
<!-- GOOGLE ANALYTICS -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89933285-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
