<!DOCTYPE html>

<head>
	
	<meta charset="UTF-8" lang="da"/>

	<title>Fildeling med Linux- Thomas Jensen</title>

	<link rel="stylesheet" href="../css/styles/docco.css" />

	<link rel="stylesheet" href="../css/style.css" />

	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>
	
	<script src="../js/toc2.js" type="text/javascript"></script>
	<script src="https://code.jquery.com/jquery-2.2.2.js"></script>
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>

</head>

<!-- 

code highlighter : https://highlightjs.org/

code converter : http://www.freebits.co.uk/convert-html-code-to-text.html 

-->

<html>

<body onload="generateTOC(document.getElementById('toc'));">

<footer id="license"></footer>

	<script> $( "#license" ).load( "license.html" ); </script>

	<div id="toc">
	<p>Indholdsfortegnelse</p>
	
	</div>

<div class="title">Fildeling med Linux</div>
	

<h1>Introduktion</h1>

<p>En filserver er en computer der giver netværkets computere mulighed for at gemme eller hente filer. Det kan den gøre ved give alle adgang eller styre det ved hjælp af rettigheder. Det kan både være på bruger og/eller maskinniveau.</p>

<p>Denne guide sigter mod et simpelt hjemmenetværk med få brugere, og hvor brugeropsætning skal foregå på de enkelte maskiner</p>

<p>Ubuntuserveren er sat op på følgende netværk:</p>

<table class="">
	<thead>
		<tr>
			<th></th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Netværk</td>
			<td>192.168.0.0/24</td>
		</tr>
		<tr>
			<td>server IP</td>
			<td>192.168.0.10</td>
		</tr>
		<tr>
			<td>Klient IP</td>
			<td>DHCP</td>
		</tr>
		<tr>
			<td>Windows - workgroup (kun SAMBA/CIFS)</td>
			<td>HOMENETWORK</td>
		</tr>
	</tbody>
</table>

<p>I denne guide vil det blive gennemgået hvordan man deler filer på et Linux system ved hjælp af NFS og SAMBA/CIFS.</p>

<span class="afsnit">NFS</span>

<p>NFS står for <span class="inl_cmd"><span class="bold">N</span>etwork <span class="bold">F</span>ile <span class="bold">System</span></span>. Fordelen ved at anvende NFS er, at det er en integreret del af Linux. Det betyder at man administrerer brugere og rettigheder til filer/mapper direkte.</p>

<span class="afsnit">SAMBA/CIFS</span>

<p>SAMBA og CIFS står for henholdsvis <span class="inl_cmd"><span class="bold">S</span>erver <span class="bold">M</span>essage <span class="bold">B</span>lock</span> og <span class="inl_cmd"><span class="bold">C</span>ommon <span class="bold">I</span>nternet <span class="bold">F</span>ile <span class="bold">S</span>ystem</span>. SMB protokollen er oprindeligt udviklet af IBM, men blev senere videreudviklet af Microsoft som kaldte deres omplementering for CIFS.</p>

<span class="afsnit">Hvad skal du vælge</span>

<p>Svaret er meget simpelt. Skal du dele filer med andet end Linuxcomputere, så skal du vælge SAMBA/CIFS. Det er kun de færreste Windows versioner hvor man kan installere drivere til NFS. Selvom protokollen er Opensource har Microsft valgt ikke at omplementere de. Anvender du kun Linux, så kan du med fordel anvende NFS.</p>

<p>For at gøre dette praktisk vil der for både NFS og SAMBA/CIFS blive oprettet tre forskellige shares der er afgrænset af henholdsvis brugeren, gruppen og alle.</p>

<h2>Praktisk</h2>

<p>Til hver af protokollerne vil der blive lavet følgende:</p>

<table class="">
	<thead>
		<tr>
			<th>Protokol</th>
			<th>Adresse</th>
			<th>Beskrivelse</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td rowspan="3">NFS</td>
			<td><span class="inl_cmd">/srv/NFS/brugere/*bruger*</span></td>
			<td>Brugerens private filer</td>
		</tr>
		<tr>
			<td><span class="inl_cmd">/srv/NFS/grupper/*gruppe*</span></td>
			<td>Gruppens filer</td>
		</tr>
		<tr>
			<td><span class="inl_cmd">/srv/NFS/alle</span></td>
			<td></td>
		</tr>
		<tr>
			<td rowspan="3">SMB/CIFS</td>
			<td><span class="inl_cmd">/srv/SMB/brugere/*bruger*</span></td>
			<td>Brugerens private filer</td>
		</tr>
		<tr>
			<td><span class="inl_cmd">/srv/SMB/grupper/*gruppe*</span></td>
			<td>Gruppens filer</td>
		</tr>
		<tr>
			<td><span class="inl_cmd">/srv/SMB/alle</span></td>
			<td></td>
		</tr>
	</tbody>
</table>

<p>Jeg vælger at lægge brugernes private filer i samme mappe som alle de andre. Det er for at gøre det nemmere at have overblik og lave backup. Har man derudover valgt at installere med LVM, så vil man løbende kunne udvide <span class="inl_cmd">/srv</span> partitionen når der er behov for det</p>

<p>For at eksemplificere opretter vi en familie med forældrene <span class="inl_cmd">hans</span> og <span class="inl_cmd">grethe</span> samt barnet <span class="inl_cmd">klaus</span>. Forældrene er medlemme er gruppen <span class="inl_cmd">parents</span>.</p>

<p>Da der skal laves en del systemarbejde vælger jeg at skifte til root-shell. Det er for at undgå at skulle skrive <span class="inl_cmd">sudo</span> foran alle kommandoerne.</p>

<code class="cmd">sudo su</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ sudo su
[sudo] adgangskode for thoj: 
root@mainsrv:/home/thoj#
</pre>

<h2>Oprettelse brugere</h2>

<p>Herunder opretter vi brugerne på systemet. Ved at anvende <span class="inl_cmd">useradd</span> kan vi konfigurere brugeren med det samme. Bl.a. opretter vi ikke nogen hjemmemappe til brugerne, da de ikke har brug for den, og de får heller ikke adgang til selve system, da de ikke kan åbne en shell.</p>
	
<code class="cmd">sudo useradd -M -u 2010 -s /bin/false hans</code>
<code class="more_cmd">sudo useradd -M -u 2011 -s /bin/false grethe</code>
<code class="more_cmd">sudo useradd -M -u 2012 -s /bin/false klaus</code>

<p>Kontroller at de er oprettet korrekt. De nye brugere er blevet oprettet i bunden af filen <span class="inl_cmd">/etc/passwd</span></p>

<code class="cmd">tail -3 /etc/passwd</code>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# tail -3 /etc/passwd
hans:x:2010:2010::/home/hans:/bin/false
grethe:x:2011:2011::/home/grethe:/bin/false
klaus:x:2012:2012::/home/klaus:/bin/false
</pre>

<p>Opret herefter et password til hver af brugerne ved hjælp af kommandoen <span class="inl_cmd">passwd</span>. Herunder er det vist med brugeren <span class="inl_cmd">hans</span></p>

<code class="cmd">passwd hans</code>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# passwd hans
Indtast ny UNIX-adgangskode: <span class="red">&lt;-- Indtast password (f.eks: 123qwe)</span>
Genindtast ny UNIX-adgangskode: <span class="red">&lt;-- Indtast password (f.eks: 123qwe)</span>
passwd: password updated successfully
</pre>

<p>Læg mærke til at der ud for hver bruger står et tal:</p>

<pre class="black">
hans:x:<span class="red">2010</span>:<span class="red">2010</span>::/home/hans:/bin/false
</pre>

<p>Dette tal er brugerens UID (<span class="bold">U</span>ser <span class="bold">ID</span>entification. Det er detta tal som NFS anvender til at verifcere brugeren. Brugeren Hans skal have det samme <span class="inl_cmd">UID</span> på de maskiner han anvender til at tilgå NFS serveren</p>


<p>I vores tilfælde med få maskiner er det relativt let at styre brugerrettighederne, men til større systemer kan det selvfølgelig lade sig gøre at få dette styret centralt ved hjælp af LDAP (se <a href="https://help.ubuntu.com/community/SettingUpNFSHowTo" target="_blank">Setting Up NFS Howto</a> og <a href="https://help.ubuntu.com/lts/serverguide/openldap-server.html" target="_blank">OpenLDAP Server</a>.</p>


<h2>Oprettelse af grupper</h2>

<p></p>

<p>Opret gruppen <span class="inl_cmd">parents</span></p>

<code class="cmd">addgroup parents</code>

<p>Kontroller at gruppen er oprettet korrekt. De nye grupper er blevet oprettet i bunden af filen <span class="inl_cmd">/etc/group</span></p>

<code class="cmd">tail -3 /etc/group</code>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# addgroup parents
Tilføjer gruppe »parents« (GID 1001)...
Færdig.
root@mainsrv:/home/thoj# tail -3 /etc/group
grethe:x:2011:
klaus:x:2012:
parents:x:1001:
</pre>


<pre class="ubuntu_terminal">
root@tjmainsrv:/home/thoj# tail -4 /etc/group
regnskab:x:1008:
it:x:1009:
salg:x:1010:
alle:x:1011:
</pre>

<p>Tilføj brugerne til grupperne</p>

<code class="more_cmd">usermod -a -G regnskab,salg,alle lath</code>
<code class="more_cmd">usermod -a -G regnskab,alle hafe</code>
<code class="more_cmd">usermod -a -G it,alle vibo</code>
<code class="more_cmd">usermod -a -G it,salg,alle mecu</code>

<p>Kontroller at brugerne (her markeret med rødt) er kommet i grupperne:</p>

<pre class="ubuntu_terminal">
root@tjmainsrv:/home/thoj# tail -4 /etc/group
regnskab:x:1008:<span class="red">lath,hafe</span>
it:x:1009:<span class="red">vibo,mecu</span>
salg:x:1010:<span class="red">lath,mecu</span>
alle:x:1011:<span class="red">lath,hafe,vibo,mecu</span>
</pre>

<h2>Oprettelse af mapper og deres rettigheder</h2>

<p>Opret rodmappen til firmaet og naviger hen til den</p>

<code class="cmd">mkdir -p /srv/firma</code>
<code class="more_cmd">cd /srv/firma</code>

<p>Opret mapperne:</p>

<code class="cmd">mkdir regnskab salg it alle</code>

<pre class="ubuntu_terminal">
root@tjmainsrv:/srv/firma# ls -al
total 24
drwxr-xr-x 6 root root 4096 feb  8 12:53 <span class="blue1">.</span>
drwxr-xr-x 6 root root 4096 feb  8 12:52 <span class="blue1">..</span>
drwxr-xr-x 2 root root 4096 feb  8 12:53 <span class="blue1">alle</span>
drwxr-xr-x 2 root root 4096 feb  8 12:52 <span class="blue1">it</span>
drwxr-xr-x 2 root root 4096 feb  8 12:52 <span class="blue1">regnskab</span>
drwxr-xr-x 2 root root 4096 feb  8 12:52 <span class="blue1">salg</span>
</pre>

<p>Vi styrer adgangen til disse mapper på gruppeniveau, så derfor ændrer vi gruppeejerskabet af mapperne, og sørger for at kun ejer og gruppe har adgang til mapperne. Læg mærke til at jeg bruger den fulde sti. Det skyldes at jeg ikke vil risikere at ramme andre filer end lige den jeg arbejder på:</p>

<code class="cmd">chown -R :alle /srv/firma/alle</code>
<code class="more_cmd">chown -R :it /srv/firma/it</code>
<code class="more_cmd">chown -R :regnskab /srv/firma/regnskab</code>
<code class="more_cmd">chown -R :salg /srv/firma/salg</code>

<p>Kontroller at det er gjort korrekt. Gruppenavne er her markeret med rødt.</p>

<pre class="ubuntu_terminal">
root@tjmainsrv:/srv/firma# ls -al
total 24
drwxr-xr-x 6 root root     4096 feb  8 12:53 <span class="blue1">.</span>
drwxr-xr-x 6 root root     4096 feb  8 12:52 <span class="blue1">..</span>
drwxr-xr-x 2 root <span class="red">alle</span>     4096 feb  8 12:53 <span class="blue1">alle</span>
drwxr-xr-x 2 root <span class="red">it</span>       4096 feb  8 12:52 <span class="blue1">it</span>
drwxr-xr-x 2 root <span class="red">regnskab</span> 4096 feb  8 12:52 <span class="blue1">regnskab</span>
drwxr-xr-x 2 root <span class="red">salg</span>     4096 feb  8 12:52 <span class="blue1">salg</span>
</pre>

<p>For alle er det kun ejer og gruppe der skal have fulde rettigheder til mapperne. Alle skal ikke have adgang. I dette tilfælde vil vi ændre rettighederne på alle fire mapper og så ændre mappen <span class="inl_cmd">alle</span> til sidst:</p>

<code class="cmd">chmod -R 770 /srv/firma/*</code>

<pre class="ubuntu_terminal">
root@tjmainsrv:/srv/firma# chmod -R 770 /srv/firma/*
root@tjmainsrv:/srv/firma# ls -al
total 24
drwxr-xr-x 6 root root     4096 feb  8 12:53 <span class="blue1">.</span>
drwxr-xr-x 6 root root     4096 feb  8 12:52 <span class="blue1">..</span>
d<span class="red">rwxrwx---</span> 2 root alle     4096 feb  8 12:53 <span class="blue1">alle</span>
d<span class="red">rwxrwx---</span> 2 root it       4096 feb  8 12:52 <span class="blue1">it</span>
d<span class="red">rwxrwx---</span> 2 root regnskab 4096 feb  8 12:52 <span class="blue1">regnskab</span>
d<span class="red">rwxrwx---</span> 2 root salg     4096 feb  8 12:52 <span class="blue1">salg</span>
</pre>

<p>Nu vi har brugere og mapper på plads kan vi begynde at dele filerne over netværket.</p>

<h1>NFS</h1>

<h2>Hvad er NFS</h2>

<p>NFS (<span class="bold">N</span>etwork <span class="bold">F</span>ile <span class="bold">S</span>ystem) er standarden for at dele filer over et Linux netværk. NFS er integreret i Linux, og anvender filsystemets rettigheder og har adgang til brugeroplysninger på NFS serveren.</p>

<p>NFS fungere ved, at mapper der skal deles eksporteres, og administrationen af adgang sættes af de filrettigheder brugeren har på serveren. Det er af denne årsag vi skulle give brugerne de samme UID på både klienter og server. Man kan dele netværk både igennem <span class="inl_cmd">/etc/fstab</span> og ved at mount drevene selv.</p>

<h2>NFS serverdel</h2>

<p>Installer NFS serveren</p>

<code class="cmd">apt-get install nfs-kernel-server -y</code>

<p>Opret NFS shares i <span class="inl_cmd">/etc/exports</span> (markeret med rødt). Læg mærke til at vi "låser" disse shares til <span class="inl_cmd">10.0.2.10/24</span> netværket. Hvis vi ville have dem delt med alle netværk, anvendes en asterisk/stjerne (*).</p>

<pre class="black"># /etc/exports: the access control list for filesystems which may be exported
#               to NFS clients.  See exports(5).
#
# Example for NFSv2 and NFSv3:
# /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_sub$
#
# Example for NFSv4:
# /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)
# /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)
#

<span class="red">/srv/firma/regnskab   10.0.2.0/24(rw,async,no_subtree_check)
/srv/firma/it   10.0.2.0/24(rw,async,no_subtree_check)
/srv/firma/salg   10.0.2.0/24(rw,async,no_subtree_check)
/srv/firma/alle   10.0.2.0/24(rw,async,no_subtree_check)
</span>
</pre>

<p>IP adressen der kommer lige efter de shares afgrænser hvem der kan tilgå dem. Ønsker man at alle computere skal kunne tilgå ens share sætter man i stedet en asterisk (stjerne).</p>

<p>Gør dem tilgængelige for systemet:</p>

<code class="cmd">exportfs -a</code>

<p>Start NFS tjenesten</p>

<code class="cmd">service nfs-kernel-server start</code>

<pre class="ubuntu_terminal">
root@tjmainsrv:/home/thoj# service nfs-kernel-server start
 * Exporting directories for NFS kernel daemon...                        [ OK ] 
 * Starting NFS kernel daemon                                            [ OK ] 
</pre>

<p>Tjek om de er eksporteret korrekt med <span class="inl_cmd">showmount -e 10.0.2.10</span></p>

<pre class="ubuntu_terminal">
root@tjmainsrv:/home/thoj# showmount -e 10.0.2.10
Export list for 10.0.2.10:
/srv/firma/alle     10.0.2.0/24
/srv/firma/salg     10.0.2.0/24
/srv/firma/it       10.0.2.0/24
/srv/firma/regnskab 10.0.2.0/24
</pre>

<h2>NFS klientdel - Linux</h2>

<p>For at anvende NFS på klienterne skal brugerne oprettes, <span class="inl_cmd">nfs-common</span> skal installeres, og mappen <span class="inl_cmd">/NFS</span> oprettes.</li>

<ol class="">
	<li>Installer brugerne lath, hafe, vibo og mecu som ovenfor med samme passwords.</li>
	
	<li>Installer <span class="inl_cmd">nfs-common</span></li>
	
		<code class="cmd">apt-get install nfs-common -y </code>
		
	<li>Opret mappen til at dele filerne i:</li>
	
		<code class="cmd">mkdir /NFS</code>
</ol>
	





<p>Naviger til mappen og kontroller indholdet.</p>

<code class="cmd">cd /NFS</code>
<code class="more_cmd">ls -al</code>



<pre class="ubuntu_terminal">
root@thoj-VirtualBox:/home/thoj# cd /NFS
root@thoj-VirtualBox:/NFS# ls -al
totalt 8
drwxr-xr-x  2 root root 4096 feb  8 20:08 <span class="blue1">.</span>
drwxr-xr-x 25 root root 4096 feb  8 20:08 <span class="blue1">..</span>
root@thoj-VirtualBox:/NFS#
</pre>

<h3>Tilgang til shares - kommandolinie</h3>

<p>NFS monteres ligesom alle andre filsystemer i Linux med kommandoen <span class="inl_cmd">mount</span>. I dette første eksempel montere vi alle de NFS-shares som serveren har:</p>

<code class="cmd">mount -t nfs 10.0.2.10:/ /NFS</code>

<pre class="ubuntu_terminal">
root@thoj-VirtualBox:/NFS# ls -al
totalt 24
drwxr-xr-x  6 root root 4096 feb  8 12:53 <span class="blue1">.</span>
drwxr-xr-x 25 root root 4096 feb 11 10:06 <span class="blue1">..</span>
drwxrwx---  3 root 1011 4096 feb 11 11:09 <span class="blue1">alle</span>
drwxrwx---  2 root 1009 4096 feb  8 12:52 <span class="blue1">it</span>
drwxrwx---  2 root 1008 4096 feb 11 10:32 <span class="blue1">regnskab</span>
drwxrwx---  2 root 1010 4096 feb  8 12:52 <span class="blue1">salg</span>
root@thoj-VirtualBox:/NFS# 
</pre>

<p>Herefter kan du gå ind i mappen <span class="inl_cmd">/NFS</span> og se alle de drev serveren eksportere. Læg mærke til at du skal navigere dig igennem <span class="inl_cmd">/sev/nfs</span> før du kommer til mapperne admin og alle.</p>

<pre class="ubuntu_terminal">


* * * V I S    O U T P U T  * * *


</pre>

<p>For at ændre på dette skal vi først afmontere vores NFS-shares og "gen mounte" vores nfs-shares:</p>

<code class="cmd">umount 10.0.2.10:/</code>
<code class="more_cmd">mount -t nfs 10.0.2.10:/srv/nfs /NFS</code>

<pre class="ubuntu_terminal">


* * * V I S    O U T P U T  * * *


</pre>

<p>For at afmontere denne gang skal vi angive samme sti som vi brugte til at montere med.</p>

<code class="cmd">umount 10.0.2.10:/srv/nfs</code>

<p>Hvis du altså blot ønsker at importere et share giver du den fulde sti f.eks:</p>

<code class="more_cmd">mount -t nfs 10.0.2.10:/srv/nfs/admin /NFS</code>

<p>Læg mærke til at det er rettighederne på serveren der gælder. Derfor bør man have oprettet brugerne med de samme passwords på serveren.</p>


<h3>Oprettelse af shares <span class="inl_cmd">/etc/fstab</span></h3>

<p></p>

<h2>NFS klientdel - Windows</h2>

<p><a href="https://technet.microsoft.com/en-us/library/cc754350.aspx" target="_blank">https://technet.microsoft.com/en-us/library/cc754350.aspx</a></p>


<h1>Samba</h1>

<p>Samba er en fildelingstjeneste der anvender den samme protokol til fildeling som Windows. Herunder vil vi sætte samba op, så den kan dele filer med et blandet netværk bestående af både windows og Ubuntu maskiner. Samba giver computerne adgang til dens mapper ved at lave shares. I et sharenavn skelnes der ikke mellem store og små bogstaver og ikke alle tegn er anvendelige (f.eks. æøå). For at kunne lave shares med fornuftige navne kan du anvende f.eks. store og små bogstaver og underscore f.eks: <span class="inl_cmd">MitShare</span>, <span class="inl_cmd">mit_share</span>.</p>

<p>Disse shares er grupperet under en arbejdsgruppe eller et domæne. Her sætter vi Samba op som en workgroup med navnet <span class="inl_cmd">HOMENETWORK</span>.</p>

<p>Samba har sin egen bruger database, og det betyder at man ikke behøver at oprette brugere på Linuxmaskinen, men kan nøjes med at oprette dem i Samba.</p>



<p>Samba installeres med kommandoen:</p>

<code class="cmd">apt-get install samba -y</code>

<p>Hvis du kommer ud i at du hellere vil geninstallere Samba for at starte forfra skal du afinstallere både <span class="inl_cmd">samba</span> og <span class="inl_cmd">samba-common</span> pakken. Herefter vil du kunne geninstallere samba.</p>

<code class="cmd">sudo apt-get purge samba samba-common</code>

<p>På klienterne skal der installeres følgende: <span class="inl_cmd">smbclient cifs-utils</span></p>

<code class="cmd">apt-get install smbclient cifs-utils -y</code>

<h2>Konfigurer Windows</h2>

<p></p>

<h2>Konfiguration af SAMBA</h2>

<ol class="">
	<li>Konfigurer <span class="inl_cmd">/etc/samba/smb.conf</span></li>
	<li>Tilføj dit share til <span class="inl_cmd">/etc/samba/smb.conf</span></li>
	<li>Opret mapperne hvor filerne skal ligge</li>
	<li>Tilføj brugere der skal kunne anvende Samba</li>
	<li>Genstart samba</li>
</ol>

<h3>Konfigurer <span class="inl_cmd">/etc/samba/smb.conf</span></h3>

<p>Konfigurationsfilen <span class="inl_cmd">/etc/samba/smb.conf</span> styrer hele opsætningen af Samba. DVS. den indeholder både konfigurationen af selve funktionaliteten, men også de enkelte shares som sættes ind i bunden af filen. Før vi konfigurerer mapperne der skal deles skal vi have lavet nogle indledende konfigurationer. I [global] sektionen af <span class="inl_cmd">/etc/samba/smb.conf</span> sætter vi workgroup = THOJNETWORK  og tilføjer linien <span class="inl_cmd">security = user</span> lige herefter</p>

<pre class="black">
#======================= Global Settings =======================

[global]

## Browsing/Identification ###

# Change this to the workgroup/NT-domain name your Samba server will part of
   workgroup = THOJNETWORK

   security = user
</pre>

<p>Her vil vi oprette to forskellige shares</p>

<table class="">
	<thead>
		<tr>
			<th>Share</th>
			<th>mappe</th>
			<th>Rettigheder</th>
		</tr>
	</thead>
	<tbody>

		<tr>
			<td>alle</td>
			<td>/srv/samba/alle</td>
			<td>0777</td>
		</tr>
		<tr>
			<td>admin</td>
			<td>/srv/samba/admin</td>
			<td>0700</td>
		</tr>
	</tbody>
</table>

<p>Før vi går igang med at konfigurere Samba opretter vi mapperne og tildeler rettigheder</p>

<code class="cmd">mkdir -p /srv/samba/alle /srv/samba/admin</code>

<p>Når vi sætter rettigheder, hvor alle brugere skal have adgang, så anvender vi brugeren <span class="inl_cmd">nouser</span> og gruppen <span class="inl_cmd">nogroup</span>. For at sætte rettighederne for <span class="inl_cmd">/srv/samba/alle</span>:</p>

<code class="cmd">chown -R nobody.nogroup /srv/samba/alle</code>

<code class="cmd">chmod -R 777 /srv/samba/alle</code>

<p>Herunder forudsætter vi at brugeren <span class="inl_cmd">thoj</span> er administrator. For at sætte rettigheder for <span class="inl_cmd">/srv/samba/admin</span>:</p>

<code class="cmd">chown -R thoj:thoj /srv/samba/admin</code>

<code class="cmd">chmod -R 700 /srv/samba/admin</code>

<p>Kontroller at rettighederner er rigtigt sat:</p>

<code class="cmd">ls -al /srv/samba/</code>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# ls -al /srv/samba/
totalt 16
drwxr-xr-x 4 root   root    4096 sep 11 19:13 <span class="blue1">.</span>
drwxr-xr-x 9 root   root    4096 sep 11 19:13 <span class="blue1">..</span>
drwx------ 2 thoj   thoj    4096 sep 11 19:13 <span class="blue1">admin</span>
drwxrwxrwx 2 nobody nogroup 4096 sep 11 19:13 <span class="blue1">alle</span>
</pre>

<p>Herefter kan vi oprette de enkelte shares</p>

<h3>Fildeling uden brugerkontrol</h3>

<p>Vi tilføjer <span class="inl_cmd">alle</span>. Nederst i <span class="inl_cmd">/etc/samba/smb.conf</span> indsætter vi følgende:</p>


<pre class="black">
[alle]
    comment = Ubuntu File Server Share
    path = /srv/samba/alle
    browsable = yes
    guest ok = yes
    read only = no
    create mask = 0755
</pre>

<h3>Fildeling med brugerkontrol</h3>

<p>Tilføj nedestående til sidst i filen <span class="inl_cmd">/etc/samba/smb.conf</span></p>

<pre class="black">
[admin]			
 comment = fildeling
 path = /srv/samba/admin
 browsable = yes
 guest ok = no
 read only = no
 create mask = 0700
</pre>

<p>Tilføj brugeren <span class="inl_cmd">thoj</span> til samba. Du kan ikke se når du taster dit kordeord.</p>

<code class="cmd">smbpasswd -a thoj</code>
<code class="cmd">smbpasswd -a test</code>

<pre class="ubuntu_terminal">
root@tjmainsrv:/home/thoj# smbpasswd -a thoj
New SMB password:
Retype new SMB password:
Added user thoj.
</pre>

<h3>Genstart Samba</h3>

<code class="cmd">restart smbd && restart nmbd</code>

<h3>Oprettelse af Brugeres home</h3>

<p>Samba er konfigureret, så der kun skal laves få ændringer for at brugerne kan få adgang til deres private mapper. Lav følgende ændringer i afsnittet <span class="inl_cmd">"===Share definitions==="</span> der er markeret med fed skrift herunder i <span class="inl_cmd">/etc/samba/smb.conf</span>.</p>

<pre class="black">#======================= Share Definitions =======================

# Un-comment the following (and tweak the other settings below to suit)
# to enable the default home directory shares. This will share each
# user's home directory as \\server\username
<span class="bold">[homes]
   comment = Home Directories
   browseable = yes</span>

# By default, the home directories are exported read-only. Change the
# next parameter to 'no' if you want to be able to write to them.
   <span class="bold">read only = no</span>

...

# By default, \\server\username shares can be connected to by anyone
# with access to the samba server.
# Un-comment the following parameter to make sure that only "username"
# can connect to \\server\username
# This might need tweaking when using external authentication schemes
   <span class="bold">valid users = %S</span>
</pre>

<p>Genstart Samba</p>

<code class="cmd">restart smbd && restart nmbd</code>


<p></p>
<p></p>
<p></p>
<p></p>





	</body>

</html>





