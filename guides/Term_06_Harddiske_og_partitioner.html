<!DOCTYPE html>

<head>
	
	<meta charset="UTF-8" lang="da"/>

	<title>Vidas.dk</title>

	<link rel="stylesheet" href="../css/style.css" />
	<link rel="stylesheet" href="../css/styles/docco.css" />
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

	<script src="http://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script src="../js/toc2.js" type="text/javascript"></script>
	<script>$(function(){$("#license").load("license.html"); });</script>
	<script type="text/javascript" async
		src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
		MathJax.Hub.Config({ jax: ["input/TeX","output/HTML-CSS"], displayAlign: "left"
 		});
	</script>
        <script>
	$(document).ready(function(){
		$(".hide").click(function(){$("#toc").hide();});
		$(".show").click(function(){$("#toc").show();});
	});
	</script>
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<!-- 
code highlighter : https://highlightjs.org/
code converter : http://www.freebits.co.uk/convert-html-code-to-text.html 
-->
<html>
<body onload="generateTOC(document.getElementById('toc'));">

<footer id="license"></footer>

<header>
	<div class="show" id="toggle_menu"></div> 
</header>

<div class="toggle">
	<div id="toc" class="hide">
		<div id="toc_title"><span class=""><a href="#" target="">(Luk)</a></span></div>	
	</div>
</div>
		
<p></p><p></p>

<div class="title">Kommandoer</div>
	

	
<h1>Harddiske og partitioner</h1>

<p>I daglig tale er harddisken den lille metalkasse der indeholder en til flere skiver, hvorpå der kan gemmes data. I computerteknologisk sammenhæng kan det dog også være andet. En harddisk er en enhed der holder på data også selvom der ikke er strøm og derudover skal den indeholde en partitionstabel. Det betyder at følgende enheder vil blive opfattet som harddiske af Linux:</p>

<table class="">
	<thead>
		<tr>
			<th>Betegnelse</th>
			<th>Forklaring</th>
			<th>Montering</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>HDD</td>
			<td><span class="bold">H</span>ard <span class="bold">D</span>isk <span class="bold">D</span>rive</td>
			<td>Internt</td>
		</tr>
		<tr>
			<td>SSD</td>
			<td><span class="bold">S</span>olid <span class="bold">S</span>tate <span class="bold">D</span>rive</td>
			<td>Intern</td>
		</tr>
		<tr>
			<td>HHD</td>
			<td><span class="bold">H</span>ybrid <span class="bold">H</span>ard <span class="bold">D</span>rive</td>
			<td>Intern</td>
		</tr>
		<tr>
			<td>mSATA</td>
			<td><span class="bold">m</span>ini <span class="bold">S</span>erial <span class="bold">AT</span> <span class="bold">A</span>ttachment</td>
			<td>Intern</td>
		</tr>
		<tr>
			<td>eSATA</td>
			<td><span class="bold">e</span>xternal <span class="bold">S</span>erial <span class="bold">AT</span> <span class="bold">A</span>ttachment</td>
			<td>Ekstern</td>
		</tr>
		<tr>
			<td>USB</td>
			<td><span class="bold">U</span>niversal <span class="bold">S</span>erial <span class="bold">B</span>us</td>
			<td>Ekstern</td>
		</tr>
	</tbody>
</table>

<p>Linux kan starte fra alle partitioner, da selve bootprocessen styres af en bootmanager. Derfor kan Linux startes op både fra CD/DVD skriver og USB-drev.</p>

<p>Linuxsystemet administrerer sine diske ved hjælp af den fysiske placering på bundkortet. Vores testsystem vil altså give følgende opdeling</p>

<table class="">
	<thead>
		<tr>
			<th>Fysiske placering</th>
			<th>Enhed</th>
			<th>Filplacering</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>SATA 1</td>
			<td>Harddisk 100GB</td>
			<td><span class="inl_cmd">/dev/sda</span></td>
		</tr>
		<tr>
			<td>SATA 2</td>
			<td>Harddisk 100GB</td>
			<td><span class="inl_cmd">/dev/sdb</span></td>
		</tr>
		<tr>
			<td>SATA 3</td>
			<td>DVD-drev</td>
			<td><span class="inl_cmd">/dev/sr0</span></td>
		</tr>
	</tbody>
</table>

<p>Når Linux starter op registrerer det alle fysisk tilsluttede enheder og sætter dem ind i sit filsystem på ovenstående adresser. Vi kan se hvordan systemets harddiske er sat op ved hjælp af <span class="inl_cmd">lsblk</span></p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk 
├─sda1   8:1    0 46,6G  0 part /
├─sda2   8:2    0  3,8G  0 part [SWAP]
└─sda3   8:3    0 28,9G  0 part /data
sr0     11:0    1 1024M  0 rom 
</pre>

<p><span class="inl_cmd">lsblk</span> kan give langt flere informationer ved at angive nogle options. Kommandoen skal køres som superuser, da nogle af informationerne kræver <span class="inl_cmd">root</span>-rettigheder </p>

<code class="cmd">sudo lsblk -o name,type,fstype,size,ro,type,mountpoint</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo lsblk -o name,type,fstype,size,ro,type,mountpoint
NAME   TYPE FSTYPE   SIZE RO TYPE MOUNTPOINT
sda    disk          100G  0 disk 
├─sda1 part ext4    46,6G  0 part /
├─sda2 part swap     3,8G  0 part [SWAP]
└─sda3 part ext4    28,9G  0 part /data
sdb    disk          100G  0 disk 
sr0    rom          1024M  0 rom  
</pre>

<p>Hvis vi kigger på harddisk <span class="inl_cmd">sda</span>, kan vi se at den er delt ind i 3 partitioner, der hver har sit monteringspunkt, hvorimod <span class="inl_cmd">sdb</span> hverken er partitioneret eller monteret.</p>

<h2>Find dine harddiske</h2>

<p>Fremgangsmåden til at konfigurere en harddisk er, at den skal:</p>

<ol class="">
	<li>Identificeres,</li>
	<li>Partitioneres,</li>
	<li>Formateres og</li>
	<li>Monteres</li>
</ol>

<p><span class="inl_cmd">lsblk</span> viser hvad operativsystemet kan se. Hvis vi ønsker at kigge på selve harddisken skal vi anvende programmet <span class="inl_cmd">fdisk</span>. Dette program konfigurerer selve harddisken og hvordan den er inddelt. Af samme årsag skal <span class="inl_cmd">fdisk</span> altid køres som <span class="inl_cmd">root</span>. Vi kan heller ikke se med hvilket filsystem drevet er formateret, kun hvilken type det er forberedt til.</p>

<code class="cmd">sudo fdisk -l</code>

<p>Jeg har i nedestående kode markeret hvor informationerne om henholdsvis <span class="inl_cmd">sda</span> og <span class="inl_cmd">sdb</span> starter. Læg mærke til at <span class="inl_cmd">fdisk</span> ikke har registreret DVD-drevet, da det ikke er et fast drev.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo fdisk -l

<span class="red">Disk /dev/sda: 107.4 GB, 107374182400 bytes</span>
255 hoveder, 63 sektorer/spor, 13054 cylindre, i alt 209715200 sektorer
Enheder = sektorer af 1 * 512 = 512 byte
Sektorstørrelse (logisk/fysisk): 512 byte / 512 byte
I/O-størrelse (minimum/optimal): 512 byte / 512 byte
Diskidentifikation: 0x00031198

    Enhed Opstart   Start         Slut     Blokke   Id  System
/dev/sda1   *        2048    97656831    48827392   83  Linux
/dev/sda2        97656832   105656319     3999744   82  Linux swap / Solaris
/dev/sda3       105656320   166203391    30273536   83  Linux

<span class="red">Disk /dev/sdb: 107.4 GB, 107374182400 bytes</span>
255 hoveder, 63 sektorer/spor, 13054 cylindre, i alt 209715200 sektorer
Enheder = sektorer af 1 * 512 = 512 byte
Sektorstørrelse (logisk/fysisk): 512 byte / 512 byte
I/O-størrelse (minimum/optimal): 512 byte / 512 byte
Diskidentifikation: 0x00000000

Disk /dev/sdb indeholder ikke en gyldig partitionstabel
</pre>

<p><span class="inl_cmd">sda</span> blliver gjort tilgængelig for Linux ved hjælp af filen <span class="inl_cmd">/etc/fstab</span>. Vi kan kigge på filen ved hjælp af <span class="inl_cmd">nano</span>. Gem kun ændringer hvis du er helt sikker på hvad du gør, da Linux måske ikke kan montere harddiskene ved genstart.</p>

<pre class="black">
# /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system&gt; &lt;mount point&gt;  &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
# / was on /dev/sda1 during installation
UUID=c2c76ea3-8bee-4930-be2c-20d11a7358c1 /               ext4    errors=remount-ro 0       1
# /data was on /dev/sda3 during installation
UUID=a2d7f466-6131-4048-86b1-b0304e9bd905 /data           ext4    defaults        0       2
# swap was on /dev/sda2 during installation
UUID=1c538622-36c6-4fcb-a127-636a82ad84e3 none            swap    sw              0       0

</pre>

<h2>Partitionering af harddisken</h2>

<p>Harddiske partitioneres af programmet <span class="inl_cmd">fdisk</span>, så længe de er under 2 TB. Er det over 2 TB anvendes programmet gdisk, som ikke bliver gennemgået her. Start partitioneringsprogrammet op med med:</p>

<p><span class="bold">VIGTIGT</span>: Hvis du på noget tidspunkt bliver i tvivl om at du har gjort noget forkert, så kan du hoppe ud af programmet ved at bruge <kbd>q</kbd> eller <kbd>Ctrl</kbd>+<kbd>c</kbd>! Programmet skriver først til disken når du vælger det.</p>

<code class="cmd">sudo fdisk /dev/sdb</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo fdisk /dev/sdb
[sudo] password for thoj: 
Enheden indeholder hverken en gyldig DOS-partitionstabel eller en Sun-, SGI- eller OSF-disketiket.
Opretter en ny DOS-disketiket med diskidentifikation 0xfad2f3ee.
Ændringer vil holdes i hukommelsen, indtil du bestemmer dig for at
gemme dem. Derefter kan det tidligere indhold naturligvis ikke genskabes.

Advarsel: Ugyldigt flag 0x0000 for partitionstabel 4 vil blive rettet med »w« (forkortelse for write; dansk=skriv)

Kommando (m for hjælp): 
</pre>

<p>Det første <span class="inl_cmd">fdisk</span> gør, er at gøre opmærksom på at disken ikke har nogen partitionstabel. Det er det første der skal oprettes. Tast <kbd>m</kbd> og så <kbd>Enter</kbd>:</p>

<pre class="black">
Kommando (m for hjælp): <kbd>m</kbd>+<kbd>Enter</kbd>
Kommandobeskrivelse
   a   skift et opstartsflag (bootable)
   b   skift bsd-disketiket
   c   skift DOS-kompatilitetsflaget
   d   slet en partition
   l   vis liste over kendte partitionstyper
   m   vis denne menu
   n   tilføj en ny partition
   o   opret en ny, tom DOS-partitionstabel
   p   vis partitionstabellen
   q   afslut uden at gemme ændringerne
   s   opret en ny, tom Sun-disketiket
   t   skift system-id for en partition
   u   skift enheder for visning/indtastning
   v   verificer partitionstabellen
   w   skriv partitionstabel til disk og afslut
   x   ekstra funktionalitet (kun for eksperter)

Kommando (m for hjælp): 
</pre>

<p>Først skal der oprettes en ny partitionstabel. Tryk <kbd>o</kbd></p>

<pre class="black">
Kommando (m for hjælp): <kbd>o</kbd>+<kbd>Enter</kbd>
Opretter en ny DOS-disketiket med diskidentifikation 0xa6162a16.
Ændringer vil holdes i hukommelsen, indtil du bestemmer dig for at
gemme dem. Derefter kan det tidligere indhold naturligvis ikke genskabes.

Advarsel: Ugyldigt flag 0x0000 for partitionstabel 4 vil blive rettet med »w« (forkortelse for write; dansk=skriv)

Kommando (m for hjælp):
</pre>

<p>Herefter skal der oprettes en ny partition. Det er en proces med flere tastetryk, som jeg viser samlet herunder. Det du skal taste er:</p>

<ol class="">
	<li>[n] - opret ny partition</li>
	<li>[p] - den skal være primær</li>
	<li>[Enter] - vælg første partition (standard)</li>
	<li>[Enter] - vælg første sektor (standard)</li>
	<li>[Enter] - vælg sidste sektor (standard)</li>
</ol>

<p></p>

<pre class="black">
Kommando (m for hjælp): <kbd>n</kbd>+<kbd>Enter</kbd>
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): <kbd>p</kbd>+<kbd>Enter</kbd>
Partitionsnummer (1-4, standard 1): <kbd>Enter</kbd>
Bruger standardværdi 1
Første sektor (2048-209715199, standard 2048): <kbd>Enter</kbd>
Bruger standardværdi 2048
Seneste sektor, +sektorer eller +størrelse{K,M,G} (2048-209715199, standard 209715199): <kbd>Enter</kbd>
Bruger standardværdi 209715199

Kommando (m for hjælp): 
</pre>

<p>Få en oversigt over det du har gjort: tast <kbd>p</kbd></p>

<pre class="black">
Kommando (m for hjælp): <kbd>p</kbd>+<kbd>Enter</kbd>

Disk /dev/sdb: 107.4 GB, 107374182400 bytes
255 hoveder, 63 sektorer/spor, 13054 cylindre, i alt 209715200 sektorer
Enheder = sektorer af 1 * 512 = 512 byte
Sektorstørrelse (logisk/fysisk): 512 byte / 512 byte
I/O-størrelse (minimum/optimal): 512 byte / 512 byte
Diskidentifikation: 0xa6162a16

    Enhed Opstart   Start         Slut     Blokke   Id  System
/dev/sdb1            2048   209715199   104856576   83  Linux

Kommando (m for hjælp): 
</pre>

<p>Vær opmærksom på <span class="inl_cmd">Id</span> og <span class="inl_cmd">System</span>. Det angiver hvilke typer af filsystemer partitionen kan formateres til. Her er det korrekt at det skal være <span class="inl_cmd">83</span> og <span class="inl_cmd">Linux</span>.</p>

<p>Skriv ændringerne til disken. Tast <kbd>w</kbd></p>

<pre class="black">
Kommando (m for hjælp): <kbd>w</kbd>+<kbd>Enter</kbd>
Partitionstabellen er ændret!

Kalder ioctl() for at genindlæse partitionstabellen.
Synkroniserer diske.
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Før vi går videre tjekker vi om disken er partitioneret korrekt med: <span class="inl_cmd">fdisk -l /dev/sdb</span></p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo fdisk -l /dev/sdb

Disk /dev/sdb: 107.4 GB, 107374182400 bytes
43 hoveder, 44 sektorer/spor, 110843 cylindre, i alt 209715200 sektorer
Enheder = sektorer af 1 * 512 = 512 byte
Sektorstørrelse (logisk/fysisk): 512 byte / 512 byte
I/O-størrelse (minimum/optimal): 512 byte / 512 byte
Diskidentifikation: 0xa6162a16

    Enhed Opstart   Start         Slut     Blokke   Id  System
/dev/sdb1            2048   209715199   104856576   83  Linux
</pre>

<h2>Formater harddisken</h2>

<p>Harddisken skal fomateres til <span class="inl_cmd">ext4</span>. Det gøres med kommandoen:</p>

<code class="cmd">sudo mkfs -t ext4 /dev/sdb1</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo mkfs -t ext4 /dev/sdb1
mke2fs 1.42.9 (4-Feb-2014)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
6553600 inodes, 26214144 blocks
1310707 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=4294967296
800 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done   

<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Vi tjekker om harddisken er formateret korrekt med <span class="inl_cmd">lsblk</span> (min markering).</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo lsblk -o name,type,fstype,size,ro,type,mountpoint
NAME   TYPE FSTYPE   SIZE RO TYPE MOUNTPOINT
sda    disk          100G  0 disk 
├─sda1 part ext4    46,6G  0 part /
├─sda2 part swap     3,8G  0 part [SWAP]
└─sda3 part ext4    28,9G  0 part /data
sdb    disk          100G  0 disk 
└─<span class="red">sdb1 part ext4     100G  0 part </span>
sr0    rom          1024M  0 rom
</pre>

<h2>Fast montering i filsystemet</h2>

<p>Arbejdsgangen når man monterer en disk er følgende:</p>

<ol class="">
	<li>Oprette en mappe til at montere drevet i.</li>
	<li>Find diskens UUID (<span class="bold">U</span>niversally <span class="bold">U</span>nique <span class="bold">ID</span>entifier)</li>
	<li>Monteres på filsystemet (Montering)</li>
	<li>Konfigureres (Rettigheder)</li>
</ol>

<p>Her vil vi montere drevet i mappen <span class="inl_cmd">/backup</span>. Opret mappen:</p>

<code class="cmd">sudo mkdir /backup</code>

<p>Find diskens UUID</p>

<code class="cmd">sudo blkid /dev/sdb1</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo blkid /dev/sdb1
/dev/sdb1: UUID="6731e565-b3d7-4d81-86c7-74b6e3e1d591" TYPE="ext4" 
</pre>

<p>Det lange UUID nummer (6731e565-b3d7-4d81-86c7-74b6e3e1d591) er et tilfældigt nummer som Ubuntu har skabt og består af en 128bits kode. Det er en sikkerhedsfaktor der gør, at man ikke bare kan skifte en disk ud, uden at Ubuntu opdager det. Du skal selvfølgelig anvende den UUID dit system angiver. Åben filen <span class="inl_cmd">/etc/fstab</span> med nano og indsæt det med rødt (med din UUID):</p>

<code class="cmd">sudo nano /etc/fstab</code>

<pre class="black">
# /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# <file system> <mount point>   <type>  <options>       <dump>  <pass>
# / was on /dev/sda1 during installation
UUID=c2c76ea3-8bee-4930-be2c-20d11a7358c1 /               ext4    errors=remount-ro 0       1
# /data was on /dev/sda3 during installation
UUID=a2d7f466-6131-4048-86b1-b0304e9bd905 /data           ext4    defaults        0       2
# swap was on /dev/sda2 during installation
UUID=1c538622-36c6-4fcb-a127-636a82ad84e3 none            swap    sw              0       0

<span class="red">#Tilføjet /dev/sdb1 som /backup
UUID=6731e565-b3d7-4d81-86c7-74b6e3e1d591 /backup ext4 defaults 0 2</span>
</pre>

<p>Når computeren starter bliver alle diske der er konfigureret i <span class="inl_cmd">/etc/fstab</span> monteret. For at få adgang til drevet med det samme køres kommandoen:</p>

<code class="cmd">sudo mount -a</code>

<p>Tjek at drevet er monteret med <span class="inl_cmd">lsblk</span>.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0   100G  0 disk 
├─sda1   8:1    0  46,6G  0 part /
├─sda2   8:2    0   3,8G  0 part [SWAP]
└─sda3   8:3    0  28,9G  0 part /data
sdb      8:16   0   100G  0 disk 
└─<span class="red">sdb1   8:17   0   100G  0 part /backup</span>
sr0     11:0    1  1024M  0 rom 
</pre>

<p>Ændre ejerskabet og rettighederne så kun du har adgang til drevet</p>

<code class="cmd">sudo chown -R tj:tj /media/backup</code>

<code class="more_cmd">sudo chmod -R 700 /media/backup/</code>

<p>Denne metode kan anvendes både til alle former for harddiske og netværksdrev.</p>


<p><a href="https://help.ubuntu.com/community/InstallingANewHardDrive" target="_blank">https://help.ubuntu.com/community/InstallingANewHardDrive</a></p>

<h2>Midlertidig montering</h2>

<p>Som vi har gennemgået ovenfor, så er der to mapper i filstrukturen til at montere ikke faste drev i. Det er henholdsvis <span class="inl_cmd">/mnt</span> og <span class="inl_cmd">/media</span>. Vi vil i denne sammenhæng vælge <span class="inl_cmd">/media</span> da det handler om en harddisk.</p>

<p>Vi vil herunder gennemgå en midlertidig montering, som hvis det havde været et eSATA/USB-drev, og en fast montering i filstrukturen.</p>

<p>Ofte har man brug for at montere et drev midlertidigt, f.eks. et USB-drev.   </p>

<p>Arbejdsgangen når man monterer en disk er følgende:</p>

<ol class="">
	<li>Oprette en mappe til at montere drevet i.</li>
	<li>Monteres på filsystemet (Montering)</li>
	<li>Konfigureres (Rettigheder)</li>
</ol>

<p>Opret mappe til at montere drevet i. Her vælger vi <span class="inl_cmd">/media/backup</span>.</p>

<code class="cmd">sudo mkdir /media/backup</code>

<p>Drevet monteres:</p>

<code class="cmd">sudo mount /dev/sdb1 /media/backup</code>

<p>Kontroller at harddisken er monteret med <span class="inl_cmd">lsblk</span>.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0   100G  0 disk 
├─sda1   8:1    0  46,6G  0 part /
├─sda2   8:2    0   3,8G  0 part [SWAP]
└─sda3   8:3    0  28,9G  0 part /data
sdb      8:16   0   100G  0 disk 
└─<span class="red">sdb1   8:17   0   100G  0 part /media/backup</span>
sr0     11:0    1  1024M  0 rom  
</pre>

<p>Kontroller rettighederne</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo ls -al /media | grep backup
drwxr-xr-x   3 root root 4096 mar 16 15:00 <span class="red">backup</span>
</pre>

<p>Ændre ejerskabet og rettighederne så kun du har adgang til drevet</p>

<code class="cmd">sudo chown -R tj:tj /media/backup</code>

<code class="more_cmd">sudo chmod -R 700 /media/backup/</code>

<p>Kontroller rettighederne igen</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo ls -al /media | grep backup
drwx------   3 thoj thoj 4096 mar 16 15:00 <span class="red">backup</span>
</pre>

<p>Afmonter herefter drevet igen, for at vi kan montere det fast ved hjælp af <span class="inl_cmd">/etc/fstab</span>.</p>

<code class="cmd">umount /dev/sdb1</code>

<h2>USB-boot disk</h2>

<p>Ofte har man brug for at lave en nøjagtig kopi af en partition, f.eks. når man skal brænde en ISO fil over på en USB disk. Dette gøres med programmet <span class="inl_cmd">dd</span>. Der findes også GUI programmer til det, men min erfaring er, at de nogle gange roder med partitionstabellen, så USB disken reelt bliver ubrugelig. <span class="inl_cmd">dd</span> virker altid!</p> 

<code class="cmd">dd if=*input fil* of=*destinations fil* *Optioner*</code>
<code class="more_cmd">sync</code>

<p><span class="bold">VIGTIGT</span>: Det er vigtigt at køre sync efter man har kopieret data, da man risikerer at ikke al data er skrevet. Det skyldes at mange filskrivningsoperationerer cached, så operativsystemet kan vente med at skrive til det har tid.</p>

<p>Herunder er vist hele proceduren med at oprette en USB bootdisk fra en ISO. Vær opmærksom på at USB disken først have sin partitionstabel renset, hvis den har været anvendt til at brænde ISO filer før. Dette skyldes at den skrivbare del er "begrænset" til ISO-filens størrelse.</p>

<ol class="">
	<li>Kør <span class="inl_cmd">isohybrid</span> på isofilen</li>
	
		<code class="cmd">isohybrid *isofil*</code>
		
	<li>Sæt USB-nøglen i, og vent til systemet har initialiseret den (ca. 5 sekunder)</li>
	
	<li>Afmonter USB nøglen</li>
	
		<code class="cmd">umount *sti_til_USB*</code>
		
	<li>Fjern eksisterende partitioner med <span class="inl_cmd">fdisk</span> og opret en ny. Lad den nye partition fylde hele USB-disken.</li>
	
	<li>kør dd </li>
	
		<code class="cmd">sudo dd if=*sti_til_filen* of=*sti_til_USB*</code>
		
	<li>Vent til Terminalen </li>
		
	<li>&nbsp;&nbsp;&nbsp;<span class="red">VIGTIGT</span> &nbsp;&nbsp;&nbsp;Kør <span class="inl_cmd">sync</span>, for at sikr dig at alle data er skrevet til USB disken </li>
</ol>

<p>På systemet vi her går ud fra er der i forvejen to harddiske, hvilket betyder at en USB-disk vil blive registreret som den efterfølgende, altså <span class="inl_cmd">/dev/sdc</span>.</p>

<p>I eksemplet herunder oprettes en USB-bootdisk med systemrescueCD. En distribution jeg varmt kan anbefale til systemarbejde. ISO filen er blevet hentet på nettet (<a href="https://www.system-rescue-cd.org/Download" target="_blank">https://www.system-rescue-cd.org/Download</a>) og placeret her <span class="inl_cmd">/data/systemrescuecd-x86-4.7.1.iso</span>.</p>

<p>Find ISO-filens placering og navn.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ls -al /data | grep *.iso
-rw-rw-r--  1 thoj thoj 481296384 feb 25 11:40 <span class="red">systemrescuecd-x86-4.7.1.iso</span>
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo isohybrid /data/systemrescuecd-x86-4.7.1.iso 
</pre>

<p>USB-disken sættes i (vent 5 sekunder), afmonter disken og tjek at den er afmonteret</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ lsblk | grep sdc
<span class="red">sdc</span>      8:16   1   3,8G  0 disk 
└─<span class="red">sdc</span>1   8:17   1   3,8G  0 part /media/tj/663A-63FE
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo umount /dev/sdb1
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo lsblk | grep sdb
<span class="red">sdc</span>      8:16   1   3,8G  0 disk 
└─<span class="red">sdc</span>1   8:17   1   3,8G  0 part
</pre>

<p>Kopier ISO filen over på USB-nøglen (Det tager et par minutter alt efter størrelsen på isofilen) og kør <span class="inl_cmd">sync</span></p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sudo dd if=/data/systemrescuecd-x86-4.7.1.iso of=/dev/sdb
[sudo] password for thoj: 
940032+0 blokke ind
940032+0 blokke ud
481296384 byte (481 MB) kopieret, 130,186 s, 3,7 MB/s
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ sync
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Herefter kan USB-drevet fjernes og anvendes til at boote med.</p>


<p>Læs også: <a href="https://www.system-rescue-cd.org/Sysresccd-manual-en_How_to_install_SystemRescueCd_on_an_USB-stick" target="_blank">https://www.system-rescue-cd.org/Sysresccd-manual-en_How_to_install_SystemRescueCd_on_an_USB-stick</a></p>

<p>Læs også: <a href="https://wiki.archlinux.org/index.php/disk_cloning" target="_blank">https://wiki.archlinux.org/index.php/disk_cloning</a></p>

<p>man-page <span class="inl_cmd">dd</span>: 
	<a href="http://manpages.ubuntu.com/manpages/trusty/man1/dd.1.html" target="_blank">
	http://manpages.ubuntu.com/manpages/trusty/man1/dd.1.html</a></p>



<p></p>
<p></p>
<p></p>
<p></p>

	</body>

</html>
