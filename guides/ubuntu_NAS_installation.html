<!DOCTYPE html>
<html lang="da">
<head>
  <title>NAS Installation</title>
  <link rel="icon" href="../images/favicon.png">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/jquery-ui.min.css">
  <link rel="stylesheet" href="../css/jquery.tocify.css">
  <link rel="stylesheet" href="../css/style_new.css" />
<!-- Scripts in bottom to speed up pageload-->
 

</head>
<body>
	
	
<div class="container-fluid">

<div class="row-fluid">
	
<div class="col-xs-3">
	
	<div id="toc">
	
		<div id="toc_headline"></div>
	
	</div>

</div><!-- Start slut 1. kolonne - TOC -->
	
<div class="col-xs-9">
	
<div class="title">Ubuntu NAS <br/> Installation</div>





<p>I Denne guide vil du blive guidet igennem hvordan du laver en NAS server. Guiden er lavet på Virtualbox, og guiden er testet på en fysisk maskine, med følgende konfiguration:</p>

<table class="">
	<thead>
		<tr>
			<th colspan="2">Hardware</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>CPU</td>
			<td>Intel Dualcore</td>
		</tr>
		<tr>
			<td>RAM</td>
			<td>4 GB</td>
		</tr>
		<tr>
			<td rowspan="3">Harddiske</td>
			<td>1 stk 1 TB harddisk til systemdrev
		</td>
		<tr>
			<td>2 stk 4 TB harddiske til backup (fysisk maskine)</td>
		</tr>
		<tr>
			<td>2 stk 2 TB harddiske til backup (VirtualBox)</td>

		</tr>
		<tr>
			<td>DVD</td>
			<td>Standard R/W</td>
		</tr>

	</tbody>
</table>

<p>Til Guiden har jeg anvendt <a href="http://releases.ubuntu.com/18.04/ubuntu-18.04-live-server-amd64.iso" download >Ubuntuserver 18.04 live</a></p>

<h1>Brænding af ISO-fil</h1>

<p>Til at brænde <span class="inl_cmd">ISO-filen</span> over på en USB vi jeg anbefale at du anvender følgende programmer:</p>

<p><b>Til Windows: </b> Rufus (<a href="https://rufus.akeo.ie/" target="_blank">https://rufus.akeo.ie/</a>)</p>

<p><b>Til Mac: </b> UNetbootin (<a href="http://unetbootin.github.io/" target="_blank">http://unetbootin.github.io/</a>)</p>

<p><b>Til Ubuntu: </b> Brug det medfølgende program "Startup Disk Creator"</p>

<blockquote>
	<p>
		I Guiden vil der blive anvendt en blanding af skærmbilleder og beskrivelser til at vejlede dig. Det er gjort fordi guiden ellers kan blive uoverskuelig med alle de skærmbilleder.
	</p>
</blockquote>

<p>Når USB-nøglen er brændt skal du sørge for at din NAS-maskine booter fra USB.</p>

<h1>Start installation</h1>

<p>Installationen af Ubuntu-server foregår ved hjælp af tasteturet.</p>

<p>Man skifter mellem menupunkterne ved hjælp af <kbd>Tab</kbd> (næste) eller <kbd>Shift</kbd>+<kbd>Tab</kbd> (tilbage). Nogle gange kan man anvende piletasterne.</p>

<p>Når man står på den mulighed man vil aktivere, trykker man enten på <kbd>Mellemrum</kbd> eller <kbd>Enter</kbd>.</p>

<p>Vil man fortryde trykker man på <kbd>Esc</kbd>.</p>

<p>Menuer med <span class="inl_cmd">(+)</span> åbner undermenuer.</p>




<h2>Installationssprog</h2>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_01.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<h1>Sprog og lokation</h1>

<p>Her skal du vælge keyboard layout</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_02.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Vælg layout, og anvend "Danish".</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_03.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Kontroller at der står "Danish" to gange og vælg <button type="_">Done</button></p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_04.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Fortsæt installationen ved at vælge : Install Ubuntu</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_05.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<h1>Netværk</h1>

<p>Netværksguiden er ret omfattende, men fremgangsmåde er som ovenfor. Vælg dit netværkskort - her <span class="inl_cmd">enp0s3</span> og tryk <kbd>Enter</kbd></p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_06.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Marker "Use a static IPv4 configuration" og tryk <kbd>Enter</kbd></p>


<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_07.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Her skal du indtaste dine netværksoplysninger.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_08.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>I mit tilfælde er det:</p>

<ul class="none">
	<li><b>Subnet: </b>192.168.0.0/24 (netværks adressen)</li>
	<li><b>Address: </b>192.168.0.20 (computerens adresse)</li>
	<li><b>Gateway: </b>192.168.0.1 (routerens adresse)</li>
	<li><b>Nameservers: </b>8.8.8.8 , 8.8.4.4 (googles DNS'er)</li>
</ul>

<p>Gå videre ved at vælge <button type="_">Save</button>. Kontroller at Ubuntu angiver den rigtige adresse og vælg <button type="_">Done</button>.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_09.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Kontroller endnu engang og vælg <button type="_">Done</button>. VI anvender ikke en proxy, så her trykker vi blot <kbd>Enter</kbd> for at komme videre.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_10.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<h1>Opsætning af harddisk</h1>

<blockquote>
	<p>Vi opretter først vores RAID drev efter installationen, da det er en del nemmere end at gøre det her.</p>
</blockquote>

<p>I dette setup laver vi et simpelt harddisk setup. Vælg <button type="_">Use An Entire Disk</button>.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_11.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Vælg den første harddisk (systemdisken)</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_12.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Vi følger standardindsstillingerne så vi vælger <button type="_">Done</button>:</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_13.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Når vu trykker <button type="_">Done</button>, kommer der en advarsel om at alt bliver slettet hvis vi fortsætter. Og da vi er ved at installere systemet er det som det skal være. Vælg <button type="_">Continue</button>.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_14.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<h1>Afslut installationen</h1>

<p>Indtast informationer om dig selv</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_15.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Vigtigt:</p>

<ul class="none">
	<li>Serverens navn skal være: nas</li>
	<li>Vælg et brugerord der består af dine initialer med små bogstaver</li>
	<li>Din bruger er den du skal bruge til at administrere systemet med, så kodeordet skal være godt.</li>
	<li>Det eneste felt der ikke skal stå noget i er <span class="inl_cmd">"Import SSH identity"</span></li>
</ul>

<p>Vælg <button type="_">Done</button>, hvorefter installationen går igang.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_16.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Når installationen er færdig står der <span class="inl_cmd">Finished Install!</span> øverst og du kan vælge <button type="_">Reboot Now</button></p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_17.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Maskinen lukker nu ned og beder dig om at fjerne boot-mediet.</p>

<p>Done</p>



<h1>Første start</h1>

<p>Når ubuntu starter op skal du logge ind. Indtast dit brugernavn samt password. Læg mærke til at du ikke kan se dine tegn når du taster password ind.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_18.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>På første side kan man se informationer om systemet, samt om det trænger til en opdatering. Her kan vi se at systemet er fuldt ud opdateret.</p>

<figure id="">

	<img class="p90" src="images/VB_ubuntu1804_nas_19.png" alt="_" title="_" />

	<figcaption></figcaption>

</figure>

<p>Tillykke - du har installeret Ubuntu server 18.04.</p>

<h1>sudo</h1>

<p><span class="inl_cmd">sudo</span> betyder <b>SU</b>peruser <b>DO</b>, og er en smart måde som man anvender til at give nogle bruger administratorrettigheder. Det gør man ved at sætte dem i <span class="inl_cmd">sudo</span>-gruppen. Den bruger du oprettede under installationen er automatisk tilføjet til denne gruppe, og derfor kan du lave systemarbejde.</p>

<p>Lad os prøve at et eksempel, hvor vi genstarter netværkstjenesten. Kør kommandoen: <span class="inl_cmd">service networking restart</span> - altså uden <span class="inl_cmd">sudo</span>.</p>

<pre class="black">
tj@NAS:~$ service networking restart
<span class="red">==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===</span>
Authentication is required to restart 'networking.service'.
Authenticating as: Thomas Jensen,,, (tj)
Password: 
</pre>

<p>Her brokker programmet sig, fordi du ikke har rettighederne til at køre det. Men som en service får du muligheden for at indtaste dit password, så netværket kan genstartes.</p>

<p>Havde du gjort det "rigtigt" med <span class="inl_cmd">sudo</span> ville du have fået følgende output:</p>

<pre class="black">
tj@NAS:~$ sudo service networking restart 
[sudo] adgangskode for tj: 
</pre>

<p>Altså ingen brok, men bare en bekræftelse på at du tilhører <span class="inl_cmd">sudo</span>-gruppen.</p>

<blockquote>
	<p>
		Læg mærke til, at hvis du kører flere <span class="inl_cmd">sudo</span> kommandoer efter hinanden, så skal du ikke indtaste dit password. Det skyldes, at Ubuntu husker det et kort stykke tid.
	</p>
	
	<p>Af samme årsag bør man også logge af en computer før man forlader den, for at andre ikke kan misbruge dine rettigheder. Det gøres med kommandoen: <span class="inl_cmd">exit</span>, eller ved at lukke terminalvinduet.</p>
</blockquote>


<h1>Opdatering</h1>

<p>Ubuntu opdateres ved hjælp af det som kaldes <span class="inl_cmd">repositories</span>. et repositorie har hele tiden den nyeste version af programmet der passer til den version af Ubuntu man kører med. Så for at opdatere skal man altså sammenligne de programmer man har installeret med dem som ligger i repository.</p>

<p>Det smarte ved dette system er, at man kan tilføje og fjerne repositories efter behov - og derved få fat i de programmer man ønsker.</p>

<h2>Ændre lokalitet</h2>

<p>Som udgangspunkt henter den installation vi har lavet sine opdateringer fra lokale servere i DK. Det er min erfaring at de nogle gange er langsommere end de generelle.</p>

<p>Vi ændrer det ved at køre følgende kommandoer:</p>

<ul class="none">
	
	<li>Laver en backup af konfigurationsfilen hvis noget skulle gå galt. Bør man gøre som en helt naturlig del af ens arbejdsproces</li>
	
		<code class="cmd">sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup</code>
		
	<li>Erstat alle forekomster af <span class="inl_cmd">dk.archive</span> med <span class="inl_cmd">archive</span></li>
	
		<code class="cmd">sudo sed -i s/dk.archive/archive/ /etc/apt/sources.list</code>
		<p></p>
	
</ul>

<p>For at tilføje partner repositoriet skal du redigere i filen <span class="inl_cmd">/etc/apt/sources.list</span> og fjerne et hash-tag</p>

<code class="cmd">sudo nano /etc/apt/sources.list</code>

<pre class="black">
<span class="blue1">## Uncomment the following two lines to add software from Canonical's
## 'partner' repository.
## This software is not part of Ubuntu, but is offered by Canonical and the
## respective vendors as a service to Ubuntu users.
# deb http://archive.canonical.com/ubuntu bionic partner <span class="red">&lt;-- Denne linie skal ændres</span>
# deb-src http://archive.canonical.com/ubuntu bionic partner</span>
</pre>

<p>Fjern <span class="inl_cmd">#</span> og mellemrummet foran deb linien så der står:</p>

<pre class="black">
<span class="blue1">## Uncomment the following two lines to add software from Canonical's
## 'partner' repository.
## This software is not part of Ubuntu, but is offered by Canonical and the
## respective vendors as a service to Ubuntu users.
<span class="brown">deb</span> <span class="green1">http://archive.canonical.com/ubuntu</span> <span class="red">bionic</span> <span class="violet">partner</span>
# deb-src http://archive.canonical.com/ubuntu bionic partner</span>
</pre>

<p></p>

<p>For at gemme ændringer skal du gøre følgende, tast <kbd>Ctrl</kbd>+<kbd>x</kbd>. Nederst på skærmen kommer følgende frem</p>

<pre class="black">
<span class="white_bg">Gem ændret buffer (AT SVARE "Nej" VIL ØDELÆGGE ÆNDRINGER)?                                          </span>                    
<span class="white_bg"> J</span> Ja
<span class="white_bg"> N</span> Nej          <span class="white_bg">^C</span> Annullér
</pre>

<p>Tast <kbd>j</kbd></p>

<pre class="black">
<span class="white_bg">Filnavn at skrive: /etc/apt/sources.list                                                            </span>                                       
<span class="white_bg">^G</span> Få hjælp     <span class="white_bg">M-D</span> DOS-format  <span class="white_bg">M-A</span> Tilføj ved e<span class="white_bg">M-b</span> SikrKopiér f
<span class="white_bg">^C</span> Annullér     <span class="white_bg">M-M</span> Mac-format  <span class="white_bg">M-P</span> Tilføj ved s<span class="white_bg">^T</span> Til filer
</pre>

<p>Tast <kbd>Enter</kbd>, og du er tilbage i selve terminalen.</p>

<details>

	<summary>Hvis det går galt</summary>

	<p>Vi lavede en backup med linien:</p>
	
	<code class="cmd">sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup</code>
	
	<p>Det vi gjorde var faktisk at kopiere <span class="inl_cmd">/etc/apt/sources.list</span> til en ny fil der hedder <span class="inl_cmd">/etc/apt/sources.list.backup</span></p>
	
	<p>For at omgøre dette gør vi det omvendte</p>

	<code class="cmd">sudo cp /etc/apt/sources.list.backup /etc/apt/sources.list</code>

	<p>Husk: Rigtige mænd tager ikke backup ... de græder bare ;)</p>
	
</details>

<h2>Opdatering</h2>

<p>Opdateringen består af to processer:</p>

<ul class="none fat_li">

	<li>Opdatering af repositories</li>
	
		<code class="cmd">sudo apt update</code>
	
	<li>Opdatering af programmer</li>
	
		<code class="more_cmd">sudo apt upgrade -y</code>

</ul>

<blockquote>
	<p>Det kan også gøres på en linie:</p>
	
	<code class="cmd">sudo apt update && sudo apt upgrade -y</code>
</blockquote>


<p>Det lille <span class="inl_cmd">-y</span> til sidst gør, at <span class="inl_cmd">apt</span> ikke spørger om du vil godkende opdateringerne. Hvis du vil se hvad der bliver opdateret skriver du ikke <span class="inl_cmd">-y</span>. Det betyder, at du skal godkende opdateringerne manuelt.</p>

<h1>Opsætning af RAID1</h1>
	
<p>Under installationen "gemte" vi de to ekstra harddiske. Det skyldes at det er nemmere at sætte dem op bagefter. Denne guide her inspireret fra: <a href="https://www.digitalocean.com/community/tutorials/how-to-create-raid-arrays-with-mdadm-on-ubuntu-16-04" target="_blank">https://www.digitalocean.com/community/tutorials/how-to-create-raid-arrays-with-mdadm-on-ubuntu-16-04</a></p>

<p>Processen er følgende:</p>	
	
<ul class="disc">
	<li>Konfigurering af harddiske</li>
	<li>Konfigurering af Raid 1</li>
	<li>Formatering og montering af Raid i filstrukturen</li>
</ul>

<h2>Konfigurerering af harddiske</h2>

<p>Først skal vi have et overblik</p>

<code class="cmd">lsblk</code>
 
<pre class="black">tj@nas:~$ lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
loop0    7:0    0 86.6M  1 loop /snap/core/4486
sda      8:0    0    1T  0 disk
├─sda1   8:1    0    1M  0 part
└─sda2   8:2    0 1024G  0 part /
sdb      8:16   0    2T  0 disk
sdc      8:32   0    2T  0 disk
sr0     11:0    1 1024M  0 rom
</pre>

<p>Her kan vi se at de to ekstra harddiske hedder <span class="inl_cmd">sdb</span> og <span class="inl_cmd">sdc</span>. For at konfigurere dem skal vi anvende programmet <span class="inl_cmd">parted</span></p>

<p>Det smarte ved at anvende parted er, at man kan konfiguere harddiske direkte fra kommandolinien, hvilket gør arbejdet en del nemmere. Du kan læse mere om <span class="inl_cmd">parted</span> her: <a href="https://www.sleeandtopher.com/how-to-partition-a-gpt-hard-drive-in-ubuntu/" target="_blank">https://www.sleeandtopher.com/how-to-partition-a-gpt-hard-drive-in-ubuntu/</a></p>

<code class="cmd">sudo parted -s /dev/sdb mklabel gpt mkpart primary ext4 0TB 2TB</code>

<code class="more_cmd">sudo -s parted /dev/sdc mklabel gpt mkpart primary ext4 0TB 2TB</code>

<pre class="black">tj@nas:~$ sudo parted /dev/sdb mklabel gpt mkpart primary 0TB 2TB
Information: You may need to update /etc/fstab.
tj@nas:~$ sudo parted /dev/sdc mklabel gpt mkpart primary 0TB 2TB
Information: You may need to update /etc/fstab.
</pre>

<p>Resulatet af partitioneringen kan vi se ved at køre <span class="inl_cmd">lsblk</span> igen. Læg mærke til at vi nu kan se partitionerne <span class="inl_cmd">sdb1</span> og <span class="inl_cmd">sdc1</span>.</p>

<pre class="black">tj@nas:~$ lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
loop0    7:0    0 86.6M  1 loop /snap/core/4486
sda      8:0    0    1T  0 disk
├─sda1   8:1    0    1M  0 part
└─sda2   8:2    0 1024G  0 part /
sdb      8:16   0    2T  0 disk
└─sdb1   8:17   0    2T  0 part
sdc      8:32   0    2T  0 disk
└─sdc1   8:33   0    2T  0 part
sr0     11:0    1 1024M  0 rom
</pre>

<h2>Opsætning af RAID1</h2>

<p>Til NAS-serveren har jeg valgt at køre med RAID1, hvilket betyder at de to harddiske er spejlet. HVis der sker skade på det ene drev, så ligger der en kopi på det andet drev. Det beskytter data mod harddiskfejl, men ikke hvis der sker fysisk skade på hele computeren. RAID1 er en sikring ... men ikke backup.</p>

<p>Man opretter er RAID (<span class="inl_cmd">/dev/md0</span>) med nedestående kommando:</p>

<code class="cmd">sudo mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1</code>

<p>Output er:</p>

<pre class="black">tj@nas:~$ sudo mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1
mdadm: Note: this array has metadata at the start and
    may not be suitable as a boot device.  If you plan to
    store '/boot' on this device please ensure that
    your boot-loader understands md/v1.x metadata, or use
    --metadata=0.90
mdadm: size set to 2147349504K
mdadm: automatically enabling write-intent bitmap on large array
Continue creating array? y <span class="red">&larr; Her skal du indtaste et y for at bekræfte</span>
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
</pre>

<p>Vi tester om vores RAID er blevet oprettet (jeg har markeret den sigende linie med rødt).</p>

<code class="cmd">cat /proc/mdstat</code>

<pre class="black">tj@nas:~$ cat /proc/mdstat
Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]
<span class="red">md0 : active raid1 sdc1[1] sdb1[0]</span>
      2147349504 blocks super 1.2 [2/2] [UU]
      [>....................]  resync =  1.5% (33847168/2147349504) finish=170.7min speed=206290K/sec
      bitmap: 16/16 pages [64KB], 65536KB chunk

unused devices: &lt;none>
</pre>

<h2>Formatering og montering</h2>

<p>Vi formaterer vores RAID</p>

<code class="cmd">sudo mkfs.ext4 -F /dev/md0</code>

<pre class="black">tj@nas:~$ sudo mkfs.ext4 -F /dev/md0
mke2fs 1.44.1 (24-Mar-2018)
Creating filesystem with 536837376 4k blocks and 134209536 inodes
Filesystem UUID: 02d2d0f0-8095-4077-affe-61b8f6076e0d
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,
        102400000, 214990848, 512000000

Allocating group tables: done
Writing inode tables: done
Creating journal (262144 blocks): done
Writing superblocks and filesystem accounting information: done

</pre>

<p>Nu skal vi mounte vores RAID i filstrukturen. Det gør vi i mappen <span class="inl_cmd">/srv</span>, som er beregnet til serverfunktioner</p>

<code class="cmd">sudo mount /dev/md0 /srv</code>

<p>Vi kontrollerer (vigtige linier markeret med rødt)</p>

<pre class="black">tj@nas:~$ lsblk
NAME    MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINT
loop0     7:0    0 86.6M  1 loop  /snap/core/4486
sda       8:0    0    1T  0 disk
├─sda1    8:1    0    1M  0 part
└─sda2    8:2    0 1024G  0 part  /
sdb       8:16   0    2T  0 disk
└─sdb1    8:17   0    2T  0 part
<span class="red">  └─md0   9:0    0    2T  0 raid1 /srv</span>
sdc       8:32   0    2T  0 disk
└─sdc1    8:33   0    2T  0 part
<span class="red">  └─md0   9:0    0    2T  0 raid1 /srv</span>
sr0      11:0    1 1024M  0 rom
</pre>

<p>For at ændringen skal slå igennem efter genstart skal vi genopfriske kernen og konfigurere <span class="inl_cmd">/dev/fstab</span>.</p>

<code class="cmd">sudo update-initramfs -u</code>

<code class="more_cmd">echo '/dev/md0 /srv ext4 defaults,nofail,discard 0 0' | sudo tee -a /etc/fstab</code>

<pre class="black">tj@nas:~$ sudo update-initramfs -u
update-initramfs: Generating /boot/initrd.img-4.15.0-20-generic <span class="red">&larr; dette tager noget tid....</span>
tj@nas:~$ echo '/dev/md0 /srv ext4 defaults, nofail, discard 0 0' | sudo tee -a /etc/
fstab
/dev/md0 /srv ext4 defaults, nofail, discard 0 0
</pre>

<p>Kontroller at linien er indsat:</p>

<code class="cmd">cat /etc/fstab</code>

<pre class="black">tj@nas:~$ cat /etc/fstab
UUID=04d1db9e-539f-11e8-8d84-7085c24ac239 / ext4 defaults 0 0
UUID=5F0E-7E69 /boot/efi vfat defaults 0 0
/swap.img	none	swap	sw	0	0
/dev/md0 /srv ext4 defaults,nofail,discard 0 0
</pre>


<p>Herefter skal computeren genstartes for at sikre os at det hele virker som det skal.</p>

<code class="cmd">sudo reboot</code>

<p>Efter genstarten tjekker vi om vores RAID drev stadig er monteret med kommandoen <span class="inl_cmd">lsblk</span>.</p>

</div><!-- end: col-md-9 -->

<footer>

	<p onclick="parentNode.remove()"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons licens" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>Indholdet på Vidas.dk er  er licenseret under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> og er skrevet af Thomas Jensen. (<a href="../hvem_er_jeg.html" target="_blank">Læs mere</a>)</p>

</footer>
	
	
</div><!-- end: row-fluid -->

</div> <!-- end: container-fluid -->


<!-- SCRIPT SECTION -->
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/jquery-ui.min.js"></script>
<script type="text/javascript" src="../js/jquery.tocify.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>

<!-- PRETTYFY-->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>


<!-- HIGHLIGHT -->
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>

<!-- MATHJAX -->
<script type="text/javascript" 
	src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "left",
  displayIndent: "0em"
});
</script>


<!-- TOCIFY -->
<script>
	$(function() {var toc = $("#toc").tocify({ selectors: "h1, h2, h3, h4" }).data("toc-tocify"); });
</script>
<!-- GOOGLE ANALYTICS -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89933285-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
