<!DOCTYPE html>

<head>
	
	<meta charset="UTF-8" lang="da"/>

	<title>Vidas.dk</title>

	<link rel="stylesheet" href="../css/style.css" />
	<link rel="stylesheet" href="../css/styles/docco.css" />
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

	<script src="http://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script src="../js/toc2.js" type="text/javascript"></script>
	<script>$(function(){$("#license").load("license.html"); });</script>
	<script type="text/javascript" async
		src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
		MathJax.Hub.Config({ jax: ["input/TeX","output/HTML-CSS"], displayAlign: "left"
 		});
	</script>
        <script>
	$(document).ready(function(){
		$(".hide").click(function(){$("#toc").hide();});
		$(".show").click(function(){$("#toc").show();});
	});
	</script>
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<!-- 
code highlighter : https://highlightjs.org/
code converter : http://www.freebits.co.uk/convert-html-code-to-text.html 
-->
<html>
<body onload="generateTOC(document.getElementById('toc'));">

<footer id="license"></footer>

<header>
	<div class="show" id="toggle_menu"></div> 
</header>

<div class="toggle">
	<div id="toc" class="hide">
		<div id="toc_title"><span class=""><a href="#" target="">(Luk)</a></span></div>	
	</div>
</div>
		
<p></p><p></p>

<div class="title">OpenSSH</div>


<h1>Hvad er SSH</h1>

<p>SSH (<span class="bold">S</span>ecure <span class="bold">SH</span>ell) er en protokol der giver krypteret adgang til andre maskiner over netværk. Ved hjælp af SSH kan man fjernadministrere maskiner på nettet, og overføre kommandoer og data.</p>

<p>I denne guide vil der bliver gennemgået følgende:</p>

<ol class="">
	<li>Noget om sikkerhed</li>
	<li>SSH adgang ved hjælp af password</li>
	<li>SSH adgang ved hjælp af nøglefiler</li>
	<li>Kopiering af filer ved hjælp af SSH</li>
	<li>Kommandoer ved hjælp af SSH</li>
</ol>

<p>Konkret vil vi anvende OpenSSH, da dette er standard på Ubuntu.</p>

<p>SSH er når alt kommer til alt fjernadgang til en computer ved hjælp af et netværk. Som standard gælder følgende:</p>

<ul class="disc">
	<li>OpenSSH er opensource. Koden ligger tilgængelig - for alle</li>
	<li>Krypteret kommunikationen allerede før brugernavn og kodeord er anvendt.</li>
	<li>Stærke godkendelsesprocedurer (Strong authentication) der bl.a. forhindrer IP- og DNS-spoofing</li>
</ul>

<p>Derudover kan OpenSSH konfigureres med langt stærkere sikkerhedsfeatures, bl.a. hvor godkendelsen er baseret på de fysiske maskiner.</p>

<h2>Denne guide</h2>

<p>Guiden tager udgangspunkt i en selvstændig server der er sat op på dit netværk. Netværket har følgende parametre:</p>

<table class="">
	<thead>
		<tr>
			<th></th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Netværk</td>
			<td>10.0.2.0</td>
		</tr>
		<tr>
			<td>Netmaske</td>
			<td>255.255.255.0 (CIDR /24)</td>
		</tr>
		<tr>
			<td>Gateway</td>
			<td>10.0.2.1</td>
		</tr>
		<tr>
			<td>DNS</td>
			<td>8.8.8.8 8.8.4.4 (Googles DNS)</td>
		</tr>
		<tr>
			<td>DHCP-scope</td>
			<td>10.0.2.100 - 10.0.2.200</td>
		</tr>
		<tr>
			<td>Server IP</td>
			<td>10.0.2.10</td>
		</tr>
		<tr>
			<td>FQDN</td>
			<td>mainsrv.home.local</td>
		</tr>
	</tbody>
</table>

<h1>Installation og konfiguration af OpenSSH</h1>

<p>Normalt vil man sørge for at OpenSSH-serveren er installeret fra start, men det skal tilvælges. Har du ikke gjort det kan du installere det med følgende kommando:</p>

<code class="cmd">sudo apt-get install openssh-server -y</code>

<p>SSH skal ikke installeres på Linux-klienter da SSH er indbygget som standard. Herunder vil de forskellige måde at tilgå en SSH server blive gennemgået. Der vil blive vist hvad der skal gøres på både vært og klient.</p>

<ol class="">
	<li>Ændring af portnummer (fra 22 -> 222)</li>
	<li>Fjern muligheden for root-login</li>
	<li>Specifier tilladte brugere</li>
	<li>Velkomst hilsen</li>
	<li>Hold liv i forbindelsen</li>
</ol>

<p>Alle ændringer herunder skal laves i filen <span class="inl_cmd">/etc/ssh/sshd_config</span>. Åbne filen med nano:</p>

<code class="cmd">sudo nano /etc/ssh/sshd_config</code>

<span class="afsnit">Ændring af portnummer</span>

<p>Som standard er OpenSSH sat til port 22. I mange guides ændres det til 222, hvilket reelt må anses for en lige så dårlig ide. Der er i alt 16 bit numre (2¹⁶ = 65536) så du kan teoretisk vælge et tal mellem 1 og 65536. Visse numre er dog afsat til konkrete protokoller (se liste <a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" target="_blank">her</a>).</p>

<p>Ændr <span class="inl_cmd"># What ports, IPs and protocols we listen for</span> </p>

<pre class="black">
# What ports, IPs and protocols we listen for
Port 22 <span class="red">&#8592; Ændr dette tal til 222</span>
</pre>

<p>Genstart ssh og test ved at logge ind igen med det nye portnummer.</p>

<code class="cmd">sudo service ssh restart</code>

<span class="afsnit">Fjern muligheden for root-login</span>

<p>Root bør ikke have adgang til at logge på over SSH, da det giver evt. hackere direkte adgang til systemet. Anvend altid en almindelig konto, som har <span class="inl_cmd">sudo</span> rettigheder.</p>

<p>Ændr:</p>

<pre class="black">
PermitRootLogin prohibit-password
</pre>

<p>til</p>

<pre class="black">
PermitRootLogin no
</pre>

<p></p>

<span class="afsnit">Specifier tilladte brugere</span>

<p>En anden effektiv måde at begrænse brugerne på systemer er, at indføre en positiv- eller negativliste over brugere. Tilføj linierne <span class="inl_cmd">AllowUsers</span> eller <span class="inl_cmd">DenyUsers</span> i bunden af filen. Hvilen man anvender må være en overvejelse over de brugere man har. Er der få der skal have adgang vil <span class="inl_cmd">AllowUsers</span> være simplest at administrere. Er der få der ikke skal have vil det være lettest at anvende <span class="inl_cmd">DenyUsers</span>.</p>

<p>Tilføj de brugere der må anvende SSH til <span class="inl_cmd">Allowusers</span> f.eks:</p>

<pre class="black">
Allowusers thoj anne
</pre>

<p>Tilføj de brugere der ikke må anvende SSH til <span class="inl_cmd">DenyUsers</span> f.eks:</p>

<pre class="black">
Denyusers wipe asti
</pre>

<p>Du kan senere prøve at sætte dig selv på positiv og negativlisterne og teste det.</p>

<span class="afsnit">Velkomst hilsen</span>

<p>Hvis du vil have at brugeren får nogle informationer ved login, kan det gøres gennem filen <span class="inl_cmd">/etc/issue.net</span>. Fjern hash foran linien<span class="inl_cmd">#Banner /etc/issue.net</span>.</p>



<p>Nogle guides foreslår at man laver en advarsel om at misbrug vil blive meldt til myndighederne, ligesom når man skal se en film. Jeg tvivler på at det virker, så jeg anvender blot: Behave!. Vær opmærksom på at tegntabellen er begrænset. Så ingen æ, ø og å</p>

<p>Rediger <span class="inl_cmd">/etc/issue.net</span>. Skriv f.eks:</p>

<pre class="black">

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

</pre>

<p>Så vil enhver der logger ind ved hjælp af SSH på serveren se følgende:</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh thoj@10.0.2.10 -p 222

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

thoj@10.0.2.10's password:
</pre>

<p>Hvis du ønsker at lave noget acscii art kan du anvender <span class="inl_cmd">banner</span>, <span class="inl_cmd">figlet</span> eller <span class="inl_cmd">toilet</span> til at lave dine værker. Alle tre programmer skal installeres særskilt. Læs mere her: <a href="http://askubuntu.com/questions/282715/how-can-i-make-ascii-banners-from-the-command-line" target="_blank">http://askubuntu.com/questions/282715/how-can-i-make-ascii-banners-from-the-command-line</a>.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ banner Behave!
######                                            ###
#     #  ######  #    #    ##    #    #  ######   ###
#     #  #       #    #   #  #   #    #  #        ###
######   #####   ######  #    #  #    #  #####     #
#     #  #       #    #  ######  #    #  #
#     #  #       #    #  #    #   #  #   #        ###
######   ######  #    #  #    #    ##    ######   ###

</pre>

<span class="afsnit">Hold liv i forbindelsen</span>

<p>SSH serveren forventer at der er aktivitet på forbindelsen, og hvis den udebliver afsluttes forbindelsen. Da det er noget klienten skal udføre skal der ændres/tilføjes i <span class="inl_cmd">/etc/ssh/ssh_config</span>. Tilføj følgende i afslutningen af filen</p>

<code class="cmd">ServerAliveInterval 20</code>

<p>På den måde vil din forbindelse blive fornyet hver 20 sekund</p>

<h1>SSH adgang ved hjælp af password</h1>

<p>Det er denne  måde SSH er konfigureret som standard, hvilket er praktisk i konfigurationsfasen. Man får adgang til en SSH server ved at anvende kommandoen:</p>

<code class="cmd">ssh *brugernavn*@*IP/FQDN* -p *portnummer*</code>

<p>Hvis man ikke har ændret portnummeret så vil ssh automatisk søge på port 22. Konkret vil koden her være:</p>

<code class="cmd">ssh thoj@10.0.2.10 -p 222</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh thoj@10.0.2.10 -p 222
The authenticity of host '[10.0.2.10]:222 ([10.0.2.10]:222)' can't be established.
ECDSA key fingerprint is SHA256:HRpyhhq5ZB4BxYX37Hu75vLUOZxYbZfsRjtNUuBF2RA.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '[10.0.2.10]:222' (ECDSA) to the list of known hosts.
Ubuntu 16.04 LTS
thoj@10.0.2.10's password: 
</pre>

<p>Første gang man lokker på vil klienten have verificeret host'en. Dette er en ekstra sikkerhedsforanstaltning der sikrer at man har fat i den rigtige maskine og ikke en password-logger der er blevet sat på netværket. Den bliver lagt ind i filen <span class="inl_cmd">~/.ssh/known_hosts</span> som en krypteret henvisning.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ls -al ~/.ssh
totalt 16
drwx------  2 thoj thoj 4096 okt  4 11:44 .
drwxr-xr-x 19 thoj thoj 4096 okt  4 11:44 ..
-rw-r--r--  1 thoj thoj  222 okt  4 11:44 known_hosts
</pre>

<p>Efter du har angivet dit password er du logget på serveren som om du sad ved den selv.</p>

<pre class="ubuntu_terminal">
Welcome to Ubuntu 16.04 LTS (GNU/Linux 4.4.0-21-generic x86_64)

 * Documentation:  https://help.ubuntu.com/

0 pakker kan opdateres.
0 opdateringer er sikkerhedsopdateringer.


Last login: Fri May 27 10:14:29 2016
<span class="green1">thoj@mainsrv</span>:<span class="blue1">~</span>
</pre>

<p>Vær opmærksom på at man ikke behøver at angive brugernavn, hvis ens brugernavn er det samme både på maskinen du logger ind fra og serveren.</p>

<h1>SSH adgang ved hjælp af nøglefiler</h1>

<p>For at øge sikkerheden kan godkendelse af forbindelser sættes til også at være baseret på en krypteret nøglefil. Dette giver flere fordele. Det betyder bl.a. at man ikke skal angive sit password når man logger ind, da automatikken sørger for at godkende en. Dette skal gøres i to trin:</p>

<ol class="">
	<li>Konfigurer SSH så man kan logge ind med nøglefilerne</li>
	<li>Opret en offentlig og en privat nøgle på din klient</li>
	<li>Tilføj din nøgle til din konto på SSH-værten</li>
	<li>Fjern muligheden for at logge på ved hjælp af passwords</li>
</ol>

<p>Sikkerheden opnås det ovenstående ved, at brugeren bliver "trusted". Så længe SSH-brugeren har sine credentials har han adgang til serveren. Vi vil her oprette nøgler til en bruger, kopiere dem over på serveren og herefter fjerne muligheden for at logge på serveren ved hjælp af passwords.</p>

<h2>Konfigurer SSH-serveren</h2>

<p>Rediger <span class="inl_cmd">/etc/ssh/sshd_config</span> på SSH-serveren.</p>

<p>Fjern # foran <span class="inl_cmd">AuthorizedKeysFile</span></p>

<pre class="black">
AuthorizedKeysFile     %h/.ssh/authorized_keys
</pre>

<p>Genstart SSH</p>

<code class="cmd">sudo service ssh restart</code>

<h2>Opret nøgler på klienten</h2>

<p>Alle SSH nøgler skal lægges i mappen <span class="inl_cmd">~/.ssh</span>.</p> 

<p>Opret nøglen med kommandoen:</p>

<code class="more_cmd">ssh-keygen -t rsa</code>

<p>Vær opmærksom på at du ikke kan se din indtastning ved "passfrase". Standard krypteringen er sat til 2048 bit, men du kan sætte den til 4096 bit ved at sætte <span class="inl_cmd">-b 4096</span> bagerst i kommandoen.</p>

<p>Du får også muligheden for at indtaste en <span class="inl_cmd">passphrase</span>. Dette kodeord gælder kun lokalt og bliver aldrig sendt over nettet. Det er designet til at beskytte din nøgle på din computer. Så hvis du mister din computer har du tid og mulighed for at lave de nødvendige ændringer på serveren, så nøglefilen bliver ugyldig.</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/thoj/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/thoj/.ssh/id_rsa.
Your public key has been saved in /home/thoj/.ssh/id_rsa.pub.
The key fingerprint is:
fb:5d:24:d0:ca:b8:ea:0d:d3:d9:67:8d:c6:99:5f:2f thoj@thoj-VirtualBox
The key's randomart image is:
+--[ RSA 2048]----+
|                 |
|           .     |
|          . .    |
|         o o     |
|        S o . .  |
|       . = . B   |
|      o = . O o .|
|       = . = oE..|
|     .o . . . ...|
+-----------------+
thoj@thoj-VirtualBox:~$ 
</pre>

<p>Tjek at filerne er blevet oprettet</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ls -al ~/.ssh
totalt 16
drwx------  2 thoj thoj 4096 okt  4 10:46 .
drwxr-xr-x 18 thoj thoj 4096 okt  4 10:45 ..
-rw-------  1 thoj thoj 1679 okt  4 10:46 id_rsa
-rw-r--r--  1 thoj thoj  402 okt  4 10:46 id_rsa.pub
</pre>

<h2>Registrer din nøglefil på serveren</h2>

<p>Registrer den offentlige nøgle på din bruger på serveren:</p>

<code class="cmd">ssh-copy-id thoj@10.0.2.10 -p 222</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh-copy-id thoj@10.0.2.10 -p 222
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys

***************************************************
***                                             ***
***  Welcome to mainsrv 10.0.2.10/24 - Behave!  ***
***                                             ***
***************************************************

thoj@10.0.2.10's password: 
</pre>

<p>Efter du har indtastet dit password får du følgende output.</p>

<pre class="ubuntu_terminal">
Number of key(s) added: 1

Now try logging into the machine, with:   "ssh -p '222' 'thoj@10.0.2.10'"
and check to make sure that only the key(s) you wanted were added.

<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Læg mærke til at du ikke er logget ind på serveren, men stadig er på din lokale maskine. Log ind på serveren igen</p>

<code class="cmd">ssh thoj@10.0.2.10 -p 222</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh thoj@10.0.2.10 -p 222

***************************************************
***                                             ***
***  Welcome to mainsrv 10.0.2.10/24 - Behave!  ***
***                                             ***
***************************************************

</pre>

<p>Her stopper programmet for at du kan bekræftige den "passphrase" du lavede din nøgle med.</p>

<p>Hvis du tilgår serveren fra en Ubuntu klient, så vil du få nedestående vindue frem. Det skyldes at GUI'en anvender et program til at administrere dine nøgler på systemet. Nøgleringskoden er den samme kode som du angav, da du oprettede SSH nøglen.</p>

<figure id="">

	<img src="images/openssh_key_ring.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Denne nøglering fungerer ved at den holder orden på de passwords/nøgler du anvender på nettet. Den bliver tilgængelig når du logger på din brugerkonto.</p>

<p>Når du efterfølgende anvender SSH til denne server vil du ikke blive spurgt om dit password, men på en GUI kan du blive afkrævet din kode til "nøgleringsprogrammet".</p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh thoj@10.0.2.10 -p 222

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

Welcome to Ubuntu 16.04 LTS (GNU/Linux 4.4.0-22-generic x86_64)

 * Documentation:  https://help.ubuntu.com/

0 pakker kan opdateres.
0 opdateringer er sikkerhedsopdateringer.


Last login: Fri May 27 11:02:51 2016 from 10.0.2.50
<span class="green1">thoj@mainsrv</span>:<span class="blue1">~</span>$ 

</pre>

<p>Fremover logger du ind uden password.</p>

<h1>Kopiering af filer med SSH</h1>

<p>Til at kopiere anvender vi <span class="inl_cmd">scp</span> - <span class="bold">S</span>ecure <span class="bold">C</span>o<span class="bold">P</span>y. Programmet fungerer på følgende måde:</p>

<code class="cmd">scp *Kildefil* *Destinationsfil*</code>

<p>Den lokale fil angives som normalt f.eks. <span class="inl_cmd">~/testfil</span>. Fjernfilen adresseres som ovenfor ved ssh, blot med den undtagelse at det skal være <span class="inl_cmd">-P</span> til at angive portnummeret:*brugernavn*@*IP*:*filnavn* -P 222.</p>

<p>Hvis jeg f.eks. vil kopiere filen <span class="inl_cmd">testfil</span> over til en fjerncomputeren med port 222: </p>

<code class="cmd">scp -P 222 ~/testfil thoj@10.0.2.10:/home/thoj</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ scp -P 222 ~/testfil thoj@10.0.2.10:/home/thoj

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

testfil                                       100%    0     0.0KB/s   00:00    
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<h1>Kommandoer ved hjælp af SSH</h1>

<p>Man kan sende kommandoer (tekststrenge) med SSH ved at tilføje dem i anførselstegn f.eks.</p>

<code class="cmd">ssh -p 222 thoj@10.0.2.10 "touch testfil1"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "touch testfil1"

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Læg mærke til at der ikke kommer noget output fra serveren, men at du vender tilbage til din egen kommandolinie. Det eneste "tegn" der er på at du faktisk har haft kontakt med serveren er banneret.</p>

<p>Hvis en kommando har et output vil det blive vist før du vender tilbage din egen kommandolinie:</p>

<code class="cmd">ssh -p 222 thoj@10.0.2.10 "ls -al | grep testfil"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "ls -al | grep testfil"

***************************************************
***                                             ***
***  Welcome to mainsrv 10.0.2.10/24 - Behave!  ***
***                                             ***
***************************************************

-rw-rw-r-- 1 thoj thoj    0 okt  4 20:02 testfil
-rw-rw-r-- 1 thoj thoj    0 okt  4 20:19 testfil1
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<h2>Superbruger kommandoer</h2>

<p>Her overfor har vi kun arbejdet med brugerens egne kommandoer, men man kan have brug for at sende <span class="inl_cmd">sudo</span> kommandoer afsted. Lad os prøve at oprette brugeren <span class="inl_cmd">test1</span> på serveren: </p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "sudo adduser test1"

***************************************************
***                                             ***
***  Welcome to mainsrv 10.0.2.10/24 - Behave!  ***
***                                             ***
***************************************************

sudo: ingen tty til stede og intet askpass-program angivet <span class="red">&#8592; Fejlmeddelse</span>
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Hvis kommandoen kræver at brugeren skal indtaste noget (f.eks. et password) skal man sætte <span class="inl_cmd">-t</span> på, for at SSH kan åbne en tty (teletypewriter) eller i daglig tale en kommandoprompt : </p>

<code class="cmd">ssh <span class="red">-t</span> -p 222 thoj@10.0.2.10 "sudo adduser test1"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -t -p 222 thoj@10.0.2.10 "sudo adduser test1"

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

[sudo] adgangskode for thoj: 
Tilføjer bruger »test1«...
Tilføjer ny gruppe »test1« (1001)...
Tilføjer ny bruger »test1« (1001) med gruppe »test1«...
Opretter hjemmemappe »/home/test1«...
Kopierer filer fra »/etc/skel«...
Indtast ny UNIX-adgangskode: 
Genindtast ny UNIX-adgangskode: 
passwd: password updated successfully
Changing the user information for test1
Enter the new value, or press ENTER for the default
	Full Name []: 
	Room Number []: 
	Work Phone []: 
	Home Phone []: 
	Other []: 
Er informationerne korrekte? [J/n] 
Connection to 10.0.2.10 closed.
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Generelt bør man ikke udføre superbruger kommandoer på denne måde. Der bør man oprette en ren SSH forbindelse til serveren. Men det kan være meget anvendeligt i scripts.</p>

<h1>Montering af drev over SSH</h1>

<h2>Installer SSHFS</h2>

<p>Installer med kommandoen:</p>

<code class="cmd">sudo apt-get install sshfs -y</code>

<p>Tilføj din bruger til fuse gruppen</p>

<p>Vi vil oprette en mappe på SSH-serveren med navnet <span class="inl_cmd">ssh_drive</span>. Denne mappe biver så monteret lokalt i vores homedirectory i en mappe ved samme navn</p>

<h2>Oprette mapper</h2>

<p>Opret lokal mappe</p>

<code class="cmd">mkdir ~/ssh_drive</code>

<p>Opret fjernmappe og kontroller at den er oprettet</p>

<code class="cmd">ssh -p 222 thoj@10.0.2.10 "mkdir ~/ssh_drive"</code>

<code class="more_cmd">ssh -p 222 thoj@10.0.2.10 "ls -al ~ | grep ssh_drive"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "ls -al ~ | grep ssh_drive"

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

drwxrwxr-x 2 thoj thoj 4096 maj 29 08:53 ssh_drive
</pre>

<h2>Monter drevet ved hjælp af SSHFS</h2>

<p>Brug nedestående kommando</p>

<code class="cmd">sshfs -p 222 thoj@10.0.2.10:/home/thoj/ssh_drive ~/ssh_drive</code>

<p>Læg mærke til at man ikke kan anvende <span class="inl_cmd">~</span> til at betegne hjemmemappen på fjernsystemet. Det skal gøres med den fulde sti (<span class="inl_cmd">/home/thoj/ssh_drive</span>)</p>

<p>Tjek at drevet er monteret:</p>

<code class="cmd">df | grep ssh_drive</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ df | grep ssh_drive
thoj@10.0.2.10:/home/thoj/<span class="red">ssh_drive</span>  19092180    45136 18054176    1% /home/thoj/<span class="red">ssh_drive</span>
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Drevet afmonteres med: </p>

<code class="cmd">fusermount -u ~/ssh_drive</code>



<h1>Læs mere</h1>

<p>SSH/OpenSSH/Configuring
<a href="https://help.ubuntu.com/community/SSH/OpenSSH/Configuring" target="_blank">
https://help.ubuntu.com/community/SSH/OpenSSH/Configuring</a></p>

<p>SSH/OpenSSH/keys
<a href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys" target="_blank">
https://help.ubuntu.com/community/SSH/OpenSSH/Keys</a></p>

<p>Proper way to sudo over SSH
<a href="http://stackoverflow.com/questions/10310299/proper-way-to-sudo-over-ssh" target="_blank">
http://stackoverflow.com/questions/10310299/proper-way-to-sudo-over-ssh</a></p>

<p>SSHFS
<a href="https://help.ubuntu.com/community/SSHFS" target="_blank">
https://help.ubuntu.com/community/SSHFS</a></p>




<p></p>

<p></p>

<p></p>

	</body>

</html>
