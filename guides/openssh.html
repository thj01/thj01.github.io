<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vidas.dk</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/jquery-ui.min.css">
  <link rel="stylesheet" href="../css/jquery.tocify.css">
  <link rel="stylesheet" href="../css/style_new.css" />
<!-- Scripts in bottom to speed up pageload-->
 

</head>
<body>
	
	
<div class="container-fluid">

<div class="row-fluid">
	
<div class="col-sm-3">
	
	<div id="toc">
	
		<div id="toc_headline"></div>
	
	</div>

</div><!-- Start slut 1. kolonne - TOC -->
	
<div class="col-sm-9">
	
<div class="title">OpenSSH</div>


<h1>Hvad er SSH</h1>

<p>SSH (<span class="bold">S</span>ecure <span class="bold">SH</span>ell) er en protokol der giver krypteret og sikker adgang til andre maskiner over netværk. Det som OpenSSH tilbyder er:</p>

<p>I denne guide vil der bliver gennemgået følgende:</p>

<ul class="disc">
	<li>OpenSSH er opensource. Koden ligger tilgængelig - for alle</li>
	<li>Krypteret kommunikationen allerede før brugernavn og kodeord er anvendt.</li>
	<li>Stærke godkendelsesprocedurer (Strong authentication) der bl.a. forhindrer IP- og DNS-spoofing - ved at det både er bruger og netværksenhed der anvendes til autentifikation..</li>
</ul>

<h2>Indhold</h2>

<p>I dette materiale vil følgende blive gennemgået.</p>

<ol class="">
	<li>Noget om sikkerhed</li>
	<li>SSH adgang ved hjælp af password</li>
	<li>SSH adgang ved hjælp af nøglefiler</li>
	<li>Kopiering af filer ved hjælp af SSH</li>
	<li>Kommandoer ved hjælp af SSH</li>
</ol>

<h2>Denne guide</h2>

<p>Guiden tager udgangspunkt i to Linux computere på samme private netværk.</p>

<table class="">
	<thead>
		<tr>
			<th></th>
			<th>Computer 1</th>
			<th>Computer 2</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>IP</td>
			<td>192.168.0.52</td>
			<td>192.168.0.61</td>
		</tr>
		<tr>
			<td>Rolle</td>
			<td>SSH-server*</td>
			<td>SSH-klient</td>
		</tr>
		<tr>
			<td>CIDR (netmaske)</td>
			<td>/24 (225.225.225.0)</td>
			<td>/24 (225.225.225.0)</td>
		</tr>
		<tr>
			<td>Computernavn</td>
			<td>tj-Virtualbox</td>
			<td>tj-desktop</td>
		</tr>
	</tbody>
</table>

<p>* SSH-server betyder at andre skal kunne tilgå denne maskine ved hjælp af SSH.</p>

<p>Du kan finde dine computeres IP-adresser med kommandoen <span class="inl_cmd">IP</span></p>

<code class="cmd">ip address</code>

<p>IP-adressen er markeret med rødt</p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ ip address
1: lo: &lt;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:4c:dc:34 brd ff:ff:ff:ff:ff:ff
    inet <span class="red">192.168.0.52/24</span> brd 192.168.0.255 scope global dynamic enp0s3
       valid_lft 3479sec preferred_lft 3479sec
    inet6 fe80::e1f9:b5a9:f659:fb46/64 scope link 
       valid_lft forever preferred_lft forever
</pre>

<h2>SSH-klienter</h2>

<ul class="fat_li none">
	<li>Linux</li>
	
		<p>På Linux-systemer er SSH-klienten en del af terminalen. Arbejder man i en GUI skal man altså blot bruge tastekombinationen <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>t</kbd></p>
	
	<li>Windows</li>
	
		<p>På windows er der to muligheder:</p>
		
		<ul class="none">
			<li>PuTTy - <a href="http://www.putty.org/" target="_blank">http://www.putty.org/</a></li>
			
			<li>Windows subsystem for Linux - <a href="https://msdn.microsoft.com/da-dk/commandline/wsl/install_guide" target="_blank">https://msdn.microsoft.com/da-dk/commandline/wsl/install_guide</a></li>
			
		</ul>

	<li>Mac</li>
</ul>

<p>Anvender du windows kan jeg på varmeste anbefale dig at installere <span class="inl_cmd">Windows subsystem for Linux</span></p>



<h1>Installation</h1>

<p>Normalt vil man sørge for at OpenSSH-serveren er installeret fra start, men det skal tilvælges. Har du ikke gjort det kan du installere det med følgende kommando:</p>

<code class="cmd">sudo apt-get install openssh-server -y</code>

<p>Vi tester om det virker ved at SSH fra <span class="inl_cmd">tj-desktop</span> til <span class="inl_cmd">tj-Virtualbox (192.168.0.52)</span>, med kommandoen:</p>

<code class="cmd">ssh tj@192.168.0.52</code>

<p>Kommandoen fortæller at vi skal SSH til brugeren <span class="inl_cmd">tj</span> på (<span class="inl_cmd">@</span>) 192.168.0.52 (maskinens IP-adresse).</p>

<p>Vi tester:</p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh tj@192.168.0.52
The authenticity of host '192.168.0.52 (192.168.0.52)' can't be established.
ECDSA key fingerprint is SHA256:OCDOHsbLATzhobmq/BcaFHLHQDvATBweP4Rneo4CNAw.
Are you sure you want to continue connecting (yes/no)? 
</pre>

<p>Første gang vi skal skabe forbindelse spørger SSH om vi er sikre. Du skal skrive <span class="inl_cmd">yes</span>, hvorefter du bliver spurgt om password til brugeren <span class="inl_cmd">tj</span> på  SSH-serveren.</p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh tj@192.168.0.52
The authenticity of host '192.168.0.52 (192.168.0.52)' can't be established.
ECDSA key fingerprint is SHA256:OCDOHsbLATzhobmq/BcaFHLHQDvATBweP4Rneo4CNAw.
Are you sure you want to continue connecting (yes/no)? 
Warning: Permanently added '192.168.0.52' (ECDSA) to the list of known hosts.
tj@192.168.0.52's password: 
Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 pakker kan opdateres.
0 opdateringer er sikkerhedsopdateringer.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

<span class="green1">tj@tj-Virtualbox</span>:<span class="blue1">~</span>$
</pre>

<p>Læg mærke til at du starter med at være på <span class="inl_cmd">tj-desktop</span>, men nu er på <span class="inl_cmd">tj-Virtualbox</span></p>

<p>Du logger af med kommandoen <span class="inl_cmd">exit</span></p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-Virtualbox</span>:<span class="blue1">~</span>$ exit
log ud
Connection to 192.168.0.52 closed.
<span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$
</pre>


<h1>Basale ændringer</h1>

<p>Her vil vi vise hvordan vi kan lave de mest basale sikkerheds ændringer. Du bør som minimum ændre dem med røde stjerner.</p>

<ol class="">
	<li>Fjern muligheden for root-login<span class="red">*</span></li>
	<li>Ændring af portnummer (fra 22 -> 222)<span class="red">*</span></li>
	<li>Specifier tilladte brugere</li>
	<li>Velkomst hilsen</li>
	<li>Hold liv i forbindelsen<span class="red">*</span></li>
</ol>

<p>Alle ændringer herunder skal laves i filen <span class="inl_cmd">/etc/ssh/sshd_config</span> på SSH-serveren (<span class="inl_cmd">192.168.0.52</span>).</p>

<p>Åbn filen med nano:</p>

<code class="cmd">sudo nano /etc/ssh/sshd_config</code>

<h2>Fjern root-login</h2>

<p>Root bør ikke have adgang til at logge på over SSH, da det giver evt. hackere direkte adgang til systemet. Skal en bruger kunne udføre administrationsarbejde på skal det være rettigheder der er givet lokalt på fjernmaskinen.</p>

<p>Ændr:</p>

<pre class="black">
PermitRootLogin prohibit-password
</pre>

<p>til</p>

<pre class="black">
PermitRootLogin no
</pre>

<p>Genindlæs konfigurationsfilerne, så dine ændringer slår igennem.</p>

<code class="cmd">sudo service ssh reload</code>

<h2>Ændring af portnummer</h2>

<p>Ved at ændre portnummeret gør man det sværere for hackere at bryde ind. Derfor ændrer vi port-nummeret.</p>

<p>Som standard er OpenSSH sat til port 22. I mange guides ændres det til 222, hvilket reelt må anses for en lige så dårlig ide. Der er i alt 16 bit numre (2¹⁶ = 65536) så du kan teoretisk vælge et tal mellem 1 og 65536. Visse numre er dog afsat til konkrete protokoller (se liste <a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" target="_blank">her</a>).</p>

<p>Ændr <span class="inl_cmd"># What ports, IPs and protocols we listen for</span> </p>

<pre class="black">
# What ports, IPs and protocols we listen for
Port 22 <span class="red">&#8592; Ændr dette tal til 222</span>
</pre>

<p>Genstart ssh og test ved at logge ind igen med det nye portnummer.</p>

<code class="cmd">sudo service ssh reload</code>

<h3>Test</h3>

<p>Hvis vi nu prøver at logge ind som før sker der følgende:</p>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh tj@192.168.0.52
ssh: connect to host 192.168.0.52 port 22: Connection refused
<span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$
</pre>

<p>Det skyldes at vi har ændret portnummeret, så det ikke mere er standardporten 22. Vi skal ændre vores kommando, så vi med <span class="inl_cmd">-p</span> angiver portnummeret:</p>

<code class="cmd">ssh -p 222 tj@192.168.0.52</code>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh -p 222 tj@192.168.0.52
tj@192.168.0.52's password: 
Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 pakker kan opdateres.
0 opdateringer er sikkerhedsopdateringer.

Last login: Sun May 28 12:31:22 2017 from 192.168.0.61

<span class="green1">tj@tj-Virtualbox</span>:<span class="blue1">~</span>$
</pre>


<h2>Tilladte brugere</h2>

<p>En anden effektiv måde at begrænse brugerne på systemer er, at indføre en positiv- eller negativliste over brugere. Tilføj linierne <span class="inl_cmd">AllowUsers</span> eller <span class="inl_cmd">DenyUsers</span> i bunden af filen. Hvilen man anvender må være en overvejelse over de brugere man har. Er der få der skal have adgang vil <span class="inl_cmd">AllowUsers</span> være simplest at administrere. Er der få der ikke skal have vil det være lettest at anvende <span class="inl_cmd">DenyUsers</span>.</p>

<p>Tilføj de brugere der må anvende SSH til <span class="inl_cmd">Allowusers</span> f.eks:</p>

<pre class="black">
Allowusers thoj anne
</pre>

<p>Tilføj de brugere der ikke må anvende SSH til <span class="inl_cmd">DenyUsers</span> f.eks:</p>

<pre class="black">
Denyusers wipe asti
</pre>

<p>Du kan senere prøve at sætte dig selv på positiv og negativlisterne og teste det.</p>

<p>Genindlæs konfigurationsfilerne, så dine ændringer slår igennem.</p>

<code class="cmd">sudo service ssh reload</code>

<h2>Velkomst hilsen</h2>

<p>Hvis du vil have at brugeren får nogle informationer ved login, kan det gøres gennem filen <span class="inl_cmd">/etc/issue.net</span>. For at gøre det skal du fjerne hash foran linien <span class="inl_cmd">#Banner /etc/issue.net</span> i konfigurationsfilen <span class="inl_cmd">/etc/ssh/sshd_config</span>.</p>

<p>Vær opmærksom på at tegntabellen er begrænset (ASCII), så ingen æ, ø og å</p>

<p>Genindlæse konfigurationsfilerne, så dine ændringer slår igennem.</p>

<code class="cmd">sudo service ssh reload</code>

<blockquote>
	<p>Nogle guides foreslår at man laver en advarsel om at misbrug vil blive meldt til myndighederne, ligesom når man skal se en film. Jeg tvivler på at det virker, så jeg anvender blot: Behave!. </p>
</blockquote>

<p>Rediger <span class="inl_cmd">/etc/issue.net</span>. Skriv f.eks:</p>

<pre class="black">

**************************************************
***                                            ***
***    Welcome to 192.168.0.51/24 - Behave!    ***
***                                            ***
**************************************************

</pre>

<p>Du skal ikke genindlæse konfigurationsfilerne her, da denne fil bliver hentet direkte af SSH. Nu vil enhver der logger ind ved hjælp af SSH på serveren se følgende:</p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh -p 222 tj@192.168.0.52

**************************************************
***                                            ***
***    Welcome to 192.168.0.51/24 - Behave!    ***
***                                            ***
**************************************************

tj@192.168.0.52's password:
</pre>

<p>Hvis du ønsker at lave noget acscii art kan du anvender <span class="inl_cmd">banner</span>, <span class="inl_cmd">figlet</span> eller <span class="inl_cmd">toilet</span> til at lave dine værker. Alle tre programmer skal installeres særskilt. Læs mere her: <a href="http://askubuntu.com/questions/282715/how-can-i-make-ascii-banners-from-the-command-line" target="_blank">http://askubuntu.com/questions/282715/how-can-i-make-ascii-banners-from-the-command-line</a>.</p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-Virtualbox</span>:<span class="blue1">~</span>$ banner Behave!
######                                            ###
#     #  ######  #    #    ##    #    #  ######   ###
#     #  #       #    #   #  #   #    #  #        ###
######   #####   ######  #    #  #    #  #####     #
#     #  #       #    #  ######  #    #  #
#     #  #       #    #  #    #   #  #   #        ###
######   ######  #    #  #    #    ##    ######   ###

</pre>

<h2>Hold liv i forbindelsen</h2>

<p>SSH serveren forventer at der er aktivitet på forbindelsen, og hvis den udebliver afsluttes forbindelsen. Da det er noget klienten skal udføre skal der ændres/tilføjes i <span class="inl_cmd">/etc/ssh/ssh_config</span>. Tilføj følgende i afslutningen af filen, så "vækkes" forbindelsen hvert 20' sekund.</p>

<code class="cmd">ServerAliveInterval 20</code>

<p>På den måde vil din forbindelse blive fornyet hver 20 sekund</p>

<h1>Nøglefiler</h1>

<p>Nøglefiler hæver sikkerhedsniveauet på SSH adgang betragteligt. I stedet for at verificere brugeren ud fra et indtastet password, så bliver "genkender" SSH-serveren brugeren ud fra om to filer passer sammen.</p>

<p>Disse filer er som standard 2048-bit, hvilket svarer til 2048 0'er og 1-taller, men kan også sættes til 2096-bit, hvis man er lidt ekstra paranoid. Hvorom alt er - de er langt mere sikre end "menneske"-kodeord.</p>

<p>Hele processen foregår i 4 trin:</p>

<ol class="">
	<li>Konfigurer SSH så man kan logge ind med nøglefilerne (SSH-server)</li>
	<li>Opret en offentlig og en privat nøgle på din klient (SSH-klient)</li>
	<li>Tilføj din nøgle til din konto på SSH-værten (SSH-klient)</li>
	<li>Fjern muligheden for at logge på ved hjælp af passwords (SSH-server)</li>
</ol>

<p>Sikkerheden opnås det ovenstående ved, at brugeren bliver "trusted". Så længe SSH-brugeren har sine credentials har han adgang til serveren. Vi vil her oprette nøgler til en bruger, kopiere dem over på serveren og herefter fjerne muligheden for at logge på serveren ved hjælp af passwords.</p>

<h2>Konfigurer SSH-serveren</h2>

<p>Rediger <span class="inl_cmd">/etc/ssh/sshd_config</span> på SSH-serveren.</p>

<p>Fjern # foran <span class="inl_cmd">AuthorizedKeysFile</span></p>

<pre class="black">
AuthorizedKeysFile     %h/.ssh/authorized_keys
</pre>

<p>Genindlæse konfigurationsfilerne, så dine ændringer slår igennem.</p>

<code class="cmd">sudo service ssh reload</code>

<h2>Opret nøgler på klienten</h2>

<p>Alle SSH nøgler skal lægges i mappen <span class="inl_cmd">~/.ssh</span>. Så først tjekker vi om mappen findes.</p> 

<code class="cmd">ls -al ~ | grep ssh</code>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ ls -al ~ | grep ssh
drwx------  2 tj   tj    4096 apr 12 14:51 .<span class="red">ssh</span>
</pre>

<p>Hvis mappen ikke findes oprettes den på følgende måde:</p>

<code class="cmd">mkdir ~/.ssh</code>

<code class="more_cmd">chmod 700 ~/.ssh</code>

<p>Opret nøglen med kommandoen:</p>

<code class="more_cmd">ssh-keygen -t rsa</code>

<p>Vær opmærksom på at du ikke kan se din indtastning ved "passfrase". Standard krypteringen er sat til 2048 bit, men du kan sætte den til 4096 bit ved at sætte <span class="inl_cmd">-b 4096</span> bagerst i kommandoen.</p>

<p>Du får også muligheden for at indtaste et kodeord <span class="inl_cmd">passphrase</span>. Dette kodeord gælder kun lokalt og bliver aldrig sendt over nettet. Det er designet til at beskytte din nøgle på din computer. Så hvis du mister din computer har du tid og mulighed for at lave de nødvendige ændringer på serveren, så nøglefilen bliver ugyldig.</p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/tj/.ssh/id_rsa):   <span class="red">&larr; Tast <span class="knap">Enter</span></span>
Enter passphrase (empty for no passphrase): <span class="red">&larr; indtast kodeord</span>
Enter same passphrase again: <span class="red">&larr; indtast kodeord igen</span>
Your identification has been saved in /home/tj/.ssh/id_rsa.
Your public key has been saved in /home/tj/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:FQwQYpdm71A87M01/8eumQ382UXEU96l7XJR1aAeMJc tj@tj-desktop
The key's randomart image is:
+---[RSA 2048]----+
|    o +*.o+ ....B|
|   . o+ = .=E. =*|
|     o + +..oo.o*|
|      . o.o. ..oo|
|       oS   . .o+|
|        .    . ++|
|              o.o|
|               *=|
|              +o+|
+----[SHA256]-----+
<span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$
</pre>

<p>Tjek at filerne er blevet oprettet</p>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ls -al ~/.ssh
totalt 20
drwx------  2 tj tj 4096 maj 29 00:29 .
drwxr-xr-x 45 tj tj 4096 maj 29 00:18 ..
-rw-------  1 tj tj 1766 maj 29 00:29 id_rsa
-rw-r--r--  1 tj tj  395 maj 29 00:29 id_rsa.pub
-rw-r--r--  1 tj tj  444 maj 28 12:03 known_hosts
</pre>

<h2>Registrer din nøglefil på serveren</h2>

<p>Registrer den offentlige nøgle på din bruger på serveren:</p>

<code class="cmd">ssh-copy-id tj@192.168.0.52 -p 222</code>

<pre class="ubuntu_terminal"><span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh-copy-id tj@192.168.0.52 -p 222
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys

**************************************************
***                                            ***
***    Welcome to 192.168.0.51/24 - Behave!    ***
***                                            ***
**************************************************

tj@192.168.0.52's password: 
</pre>

<p>Efter du har indtastet dit password får du følgende output.</p>

<pre class="ubuntu_terminal">
Number of key(s) added: 1

Now try logging into the machine, with:   "ssh -p '222' 'tj@192.168.0.52'"
and check to make sure that only the key(s) you wanted were added.

<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Læg mærke til at du ikke er logget ind på serveren, men stadig er på din lokale maskine. Vi har kun overført vores offentlige nøgle. Vi logger ind igen:</p>

<code class="cmd">ssh tj@192.168.0.52 -p 222</code>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ ssh thoj@10.0.2.10 -p 222

***************************************************
***                                             ***
***  Welcome to mainsrv 10.0.2.10/24 - Behave!  ***
***                                             ***
***************************************************

</pre>

<p>Her stopper programmet for at du kan bekræftige den "passphrase" du lavede din nøgle med.</p>

<p>Hvis du tilgår serveren fra en Ubuntu klient, så vil du få nedestående vindue frem. Det skyldes at GUI'en anvender et program til at administrere dine nøgler på systemet. Nøgleringskoden er den samme kode som du angav, da du oprettede SSH nøglen.</p>

<figure id="">

	<img class="p40" src="images/openssh_key_ring.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Ved at aktivere <span class="inl_cmd">"Lås automatisk denne nøgle ..."</span> gemmer din computer kodeordet til din SSH nøgle. Når du efterfølgende anvender SSH til denne server vil du ikke blive spurgt om dit password, men på en GUI kan du blive afkrævet din kode til "nøgleringsprogrammet".</p>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-desktop</span>:<span class="blue1">~</span>$ ssh tj@192.168.0.52 -p 222

**************************************************
***                                            ***
***    Welcome to 192.168.0.51/24 - Behave!    ***
***                                            ***
**************************************************

Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 pakker kan opdateres.
0 opdateringer er sikkerhedsopdateringer.

Last login: Sun May 28 12:38:43 2017 from 192.168.0.61

<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Fremover logger du ind ved hjælp af dine nøglefiler.</p>

<h2>Fjern password adgang</h2>

<p>Når SSH-serveren har fået tilføjet alle de offentlige nøgler den skal bruge, kan vi låse den. Det gør vi ved at redigere i filen <span class="inl_cmd">/etc/ssh/sshd_config</span></p>

<code class="cmd">sudo nano /etc/ssh/sshd_config</code>

<p>Ændr:</p>

<pre class="black">
# Change to no to disable tunnelled clear text passwords
#PasswordAuthentication yes
</pre>

<p>til ...</p>

<pre class="black"># Change to no to disable tunnelled clear text passwords
PasswordAuthentication no 
</pre>

<p>Genindlæse konfigurationsfilerne, så dine ændringer slår igennem.</p>

<code class="cmd">sudo service ssh reload</code>

<h1>Filkopiering</h1>

<p>Til at kopiere anvender vi <span class="inl_cmd">scp</span> - <span class="bold">S</span>ecure <span class="bold">C</span>o<span class="bold">P</span>y. Programmet fungerer på følgende måde:</p>

<code class="cmd">scp *Kildefil* *Destinationsfil*</code>

<p>Den lokale fil angives som normalt f.eks. <span class="inl_cmd">~/testfil</span>. Fjernfilen adresseres som ovenfor ved ssh, blot med den undtagelse at det skal være <span class="inl_cmd">-P</span> til at angive portnummeret:*brugernavn*@*IP*:*filnavn* -P 222.</p>

<p>Hvis jeg f.eks. vil kopiere filen <span class="inl_cmd">testfil</span> over til en fjerncomputeren med port 222: </p>

<code class="cmd">scp -P 222 ~/testfil thoj@10.0.2.10:/home/thoj</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ scp -P 222 ~/testfil thoj@10.0.2.10:/home/thoj

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

testfil                                       100%    0     0.0KB/s   00:00    
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<h1>Kommandoer</h1>

<p>Man kan sende kommandoer (tekststrenge) med SSH ved at tilføje dem i anførselstegn f.eks.</p>

<code class="cmd">ssh -p 222 thoj@10.0.2.10 "touch testfil1"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "touch testfil1"

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Læg mærke til at der ikke kommer noget output fra serveren, men at du vender tilbage til din egen kommandolinie. Det eneste "tegn" der er på at du faktisk har haft kontakt med serveren er banneret.</p>

<p>Hvis en kommando har et output vil det blive vist før du vender tilbage din egen kommandolinie:</p>

<code class="cmd">ssh -p 222 thoj@10.0.2.10 "ls -al | grep testfil"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "ls -al | grep testfil"

***************************************************
***                                             ***
***  Welcome to mainsrv 10.0.2.10/24 - Behave!  ***
***                                             ***
***************************************************

-rw-rw-r-- 1 thoj thoj    0 okt  4 20:02 testfil
-rw-rw-r-- 1 thoj thoj    0 okt  4 20:19 testfil1
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<h2>Superbruger kommandoer</h2>

<p>Her overfor har vi kun arbejdet med brugerens egne kommandoer, men man kan have brug for at sende <span class="inl_cmd">sudo</span> kommandoer afsted. Lad os prøve at oprette brugeren <span class="inl_cmd">test1</span> på serveren: </p>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "sudo adduser test1"

***************************************************
***                                             ***
***  Welcome to mainsrv 10.0.2.10/24 - Behave!  ***
***                                             ***
***************************************************

sudo: ingen tty til stede og intet askpass-program angivet <span class="red">&#8592; Fejlmeddelse</span>
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Hvis kommandoen kræver at brugeren skal indtaste noget (f.eks. et password) skal man sætte <span class="inl_cmd">-t</span> på, for at SSH kan åbne en tty (teletypewriter) eller i daglig tale en kommandoprompt : </p>

<code class="cmd">ssh <span class="red">-t</span> -p 222 thoj@10.0.2.10 "sudo adduser test1"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -t -p 222 thoj@10.0.2.10 "sudo adduser test1"

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

[sudo] adgangskode for thoj: 
Tilføjer bruger »test1«...
Tilføjer ny gruppe »test1« (1001)...
Tilføjer ny bruger »test1« (1001) med gruppe »test1«...
Opretter hjemmemappe »/home/test1«...
Kopierer filer fra »/etc/skel«...
Indtast ny UNIX-adgangskode: 
Genindtast ny UNIX-adgangskode: 
passwd: password updated successfully
Changing the user information for test1
Enter the new value, or press ENTER for the default
	Full Name []: 
	Room Number []: 
	Work Phone []: 
	Home Phone []: 
	Other []: 
Er informationerne korrekte? [J/n] 
Connection to 10.0.2.10 closed.
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Generelt bør man ikke udføre superbruger kommandoer på denne måde. Der bør man oprette en ren SSH forbindelse til serveren. Men det kan være meget anvendeligt i scripts.</p>

<h1>Drevmontering</h1>

<h2>Installer SSHFS</h2>

<p>Installer med kommandoen:</p>

<code class="cmd">sudo apt-get install sshfs -y</code>

<p>Tilføj din bruger til fuse gruppen</p>

<p>Vi vil oprette en mappe på SSH-serveren med navnet <span class="inl_cmd">ssh_drive</span>. Denne mappe biver så monteret lokalt i vores homedirectory i en mappe ved samme navn</p>

<h2>Oprette mapper</h2>

<p>Opret lokal mappe</p>

<code class="cmd">mkdir ~/ssh_drive</code>

<p>Opret fjernmappe og kontroller at den er oprettet</p>

<code class="cmd">ssh -p 222 thoj@10.0.2.10 "mkdir ~/ssh_drive"</code>

<code class="more_cmd">ssh -p 222 thoj@10.0.2.10 "ls -al ~ | grep ssh_drive"</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ ssh -p 222 thoj@10.0.2.10 "ls -al ~ | grep ssh_drive"

*******************************************************
***                                                 ***
***    Welcome to mainsrv 10.0.2.10/24 - Behave!    ***
***                                                 ***
*******************************************************

drwxrwxr-x 2 thoj thoj 4096 maj 29 08:53 ssh_drive
</pre>

<h2>Monter drevet ved hjælp af SSHFS</h2>

<p>Brug nedestående kommando</p>

<code class="cmd">sshfs -p 222 thoj@10.0.2.10:/home/thoj/ssh_drive ~/ssh_drive</code>

<p>Læg mærke til at man ikke kan anvende <span class="inl_cmd">~</span> til at betegne hjemmemappen på fjernsystemet. Det skal gøres med den fulde sti (<span class="inl_cmd">/home/thoj/ssh_drive</span>)</p>

<p>Tjek at drevet er monteret:</p>

<code class="cmd">df | grep ssh_drive</code>

<pre class="ubuntu_terminal">
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ df | grep ssh_drive
thoj@10.0.2.10:/home/thoj/<span class="red">ssh_drive</span>  19092180    45136 18054176    1% /home/thoj/<span class="red">ssh_drive</span>
<span class="green1">thoj@thoj-VirtualBox</span>:<span class="blue1">~</span>$ 
</pre>

<p>Drevet afmonteres med: </p>

<code class="cmd">fusermount -u ~/ssh_drive</code>



<h1>Læs mere</h1>

<p>SSH/OpenSSH/Configuring
<a href="https://help.ubuntu.com/community/SSH/OpenSSH/Configuring" target="_blank">
https://help.ubuntu.com/community/SSH/OpenSSH/Configuring</a></p>

<p>SSH/OpenSSH/keys
<a href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys" target="_blank">
https://help.ubuntu.com/community/SSH/OpenSSH/Keys</a></p>

<p>Proper way to sudo over SSH
<a href="http://stackoverflow.com/questions/10310299/proper-way-to-sudo-over-ssh" target="_blank">
http://stackoverflow.com/questions/10310299/proper-way-to-sudo-over-ssh</a></p>

<p>SSHFS
<a href="https://help.ubuntu.com/community/SSHFS" target="_blank">
https://help.ubuntu.com/community/SSHFS</a></p>



	
</div><!-- end: col-md-9 -->

<footer>

	<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons licens" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>Indholdet på Vidas.dk er licenseret under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> og er skrevet af Thomas Jensen. (<a href="../hvem_er_jeg.html" target="_blank">Læs mere</a>)</p>

</footer>
	
	
</div><!-- end: row-fluid -->

</div> <!-- end: container-fluid -->


<!-- SCRIPT SECTION -->
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/jquery-ui.min.js"></script>
<script type="text/javascript" src="../js/jquery.tocify.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>

<!-- PRETTYFY-->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>


<!-- HIGHLIGHT -->
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>

<!-- MATHJAX -->
<script type="text/javascript" 
	src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "left",
  displayIndent: "0em"
});
</script>


<!-- TOCIFY -->
<script>
	$(function() {var toc = $("#toc").tocify({ selectors: "h1, h2, h3, h4" }).data("toc-tocify"); });
</script>
<!-- GOOGLE ANALYTICS -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89933285-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
