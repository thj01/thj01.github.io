<!DOCTYPE html>

<head>
	
	<meta charset="UTF-8" lang="da"/>

	<title>Vidas.dk</title>

	<link rel="stylesheet" href="../css/style.css" />
	<link rel="stylesheet" href="../css/styles/docco.css" />
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

	<script src="http://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script src="../js/toc2.js" type="text/javascript"></script>
	<script>$(function(){$("#license").load("license.html"); });</script>
	<script type="text/javascript" async
		src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
		MathJax.Hub.Config({ jax: ["input/TeX","output/HTML-CSS"], displayAlign: "left"
 		});
	</script>
        <script>
	$(document).ready(function(){
		$(".hide").click(function(){$("#toc").hide();});
		$(".show").click(function(){$("#toc").show();});
	});
	</script>
</head>
<!-- 
code highlighter : https://highlightjs.org/
code converter : http://www.freebits.co.uk/convert-html-code-to-text.html 
-->
<html>
<body onload="generateTOC(document.getElementById('toc'));">

<footer id="license"></footer>

<header>
	<div class="show" id="toggle_menu"></div> 
</header>

<div class="toggle">
	<div id="toc" class="hide">
		<div id="toc_title"><span class=""><a href="#" target="_blank">(Luk)</a></span></div>	
	</div>
</div>
		
<p></p><p></p>

<div class="title">Webserver med Linux</div>

<h1>Indledning</h1>

<p>I denne guide vil du lære hvordan man opretter en LAMP webserver. LAMP står for <span class="bold">L</span>inux, <span class="bold">A</span>pache, <span class="bold">M</span>ySQL og <span class="bold">P</span>hp. I denne guide vil vi anvende mariaDB som SQL server i stedet for MySQL.</p>

<p>De tjenester der skal tilføjes serveren er følgende:</p>

<table class="">
	<thead>
		<tr>
			<th>Tjeneste</th>
			<th>Beskrivelse</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Apache 2</td>
			<td></td>
		</tr>
		<tr>
			<td>PHP 7</td>
			<td></td>
		</tr>
		<tr>
			<td>MariaDB</td>
			<td></td>
		</tr>
		<tr>
			<td>phpmyadmin</td>
			<td></td>
		</tr>
		<tr>
			<td>Nextcloud</td>
			<td></td>
		</tr>
		<tr>
			<td>Wordpress</td>
			<td></td>
		</tr>
		<tr>
			<td>Webmin</td>
			<td></td>
		</tr>
	</tbody>
</table>

<p>Derudover vil konfigurere serveren sådan at hver lokal bruger også får adgang til sin egen personlige web-server</p>

<p>Ønsker du ikke at anvende database baserede hjemmesideframeworks som f.eks. Nextcloud, Wordpress, Joomla osv, kan du udelade afsnittet med mariaDB og PHP</p>

<h1>Apache 2</h1>

<p>Apache installeres med følgende kommando</p>

<code class="cmd">sudo apt -y install apache2</code>

<p>Kontroller at den virker ved at åbne en browser og indtast webserverens IP-adresse, som i dette tilfælde er <span class="inl_cmd">192.168.0.10</span>:</p>

<figure id="">

	<img class="p90" src="images/webserver_kontroller_apache.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Selve webserverens filer ligger i mappen <span class="inl_cmd">/var/www/html</span>:</p>

<h2>Aktiver SSL (https)</h2>

<p>Som standard anvender Apache HTTP. Her vil vi installere SSL, så vi kan anvende HTTPS, så siden kan godkendes med et certifikat. Vær opmærksom på at det ikke betyder at en side er sikker. Det eneste et certifikat betyder er, at der er nogen der har udstedt et certifikat til siden. Når browseren rammer en side der kræver certifikat, beder den om en bekræftigelse fra de udbydere som browseren stoler på. Hvis browseren ikke kan få bekræftiget det certifikat der ligger advarer den brugeren.</p>

<p>Kør følgende kommandoer:</p>

<code class="cmd">sudo a2enmod ssl</code>

<code class="more_cmd">sudo a2ensite default-ssl.conf </code>

<code class="more_cmd">sudo systemctl restart apache2</code>

<p>Herefter vil du kunne anvende HTTPS. Skriv adressen <span class="inl_cmd">https://192.168.0.10</span>. Vær opmærksom på, at det giver en fejl når man anvender serveren, da siden ikke har noget certifikat.</p>

<figure id="">

	<img class="p90" src="images/webserver_kontroller_apache_HTTPS01.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Vælg <span class="inl_cmd">Avanceret</span> og <span class="inl_cmd">Fortsæt til 192.168.0.10 (usikkert)</span></p>

<figure id="">

	<img class="p90" src="images/webserver_kontroller_apache_HTTPS02.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Herefter kommer siden frem i browseren, hvor https er rødt og streget over. Fremover vil browseren huske undtagelsen og lade dig ind uden andre advarsler end overstregningen.</p>

<figure id="">

	<img class="p90" src="images/webserver_kontroller_apache_HTTPS04.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Siden er stadig krypteret, men for at undgå denne fejl skal man anskaffe og konfigurere et certifikat. Det kan man gøre gratis fra f.eks: <a href="https://letsencrypt.org/" target="_blank">https://letsencrypt.org/</a>.</p>


<h1>PHP 7</h1>

<p></p>

<code class="cmd">sudo apt -y install php7.0 libapache2-mod-php7.0 php7.0-mbstring php7.0-mcrypt php7.0-xmlrpc php7.0-mysql</code>

<p>Efter installationen skal Apache genstartes, så ændringer kan slå igennem:</p>

<code class="cmd">sudo systemctl restart apache2</code>

<p>For at kontrollere at PHP er installeret korrekt skal vi: opretter vi filen <span class="inl_cmd">/var/www/html/info.php</span> med lidt kode</p>

<code class="cmd">echo "&lt;?php phpinfo(); ?&gt;" | sudo tee /var/www/html/info.php</code>

<p>Tjek siden i browseren på adressen <span class="inl_cmd">10.0.2.10/info.php</span>:</p>

<figure id="">

	<img class="p90" src="images/webserver_kontroller_php.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Efter det er kontrolleret bør info.php slettes igen, da filen indeholder tekniske informationer om serverens installation.</p>

<code class="cmd">sudo rm /var/www/html/info.php</code>


<h1>Nogle tricks</h1>

<p>Her er nogle af de praktiske tricks jeg anvender på min webserver</p>

<h2>Symbolsk link</h2>

<p>Her vil vi oprette en genvej (symbolsk link) til <span class="inl_cmd">/var/www/html</span>. Det gør vi ved at "binde" en mappe i vores hjemme-mappe til webserverens mappe. Link-mappen får samme navn som den mappe den linker til.</p>

<p>Opret det symbolske link:</p>

<code class="cmd">ln -s /var/www/html/ ~</code>

<p>Tjek om linket er oprettet og det virker:</p>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ ls -l
totalt 0
lrwxrwxrwx 1 thoj thoj 14 jul  3 21:11 <span class="turk">html</span> -> <span class="blue1">/var/www/html/</span>
-rw-rw-r-- 1 thoj thoj  0 jul  3 00:31 testfile
thoj@mainsrv:~$ cd ~/html <span class="red">&lt;--- naviger ind i html mappen</span>
thoj@mainsrv:~/html$ ls -l
totalt 16
-rw-r--r-- 1 root root 11321 jul  3 20:01 index.html
-rw-r--r-- 1 root root    20 jul  3 20:20 info.php
</pre>

<h2>Gør dig selv til ejer</h2>

<p>Ved at gøre dig selv til ejer af www-serverens filer kan du redigere direkte i filerne uden at bekymre dig om rettighederne.</p>

<p>Ændr ejerskab og rettigheder for filerne i mappen <span class="inl_cmd">/var/www/html</span> til dig selv - i dette tilfælde <span class="inl_cmd">thoj</span></p>

<code class="cmd">sudo chown -R thoj:thoj /var/www/html</code>

<code class="cmd">sudo chmod 705 -R /var/www/html</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ ls -l /var/www/html/
totalt 16
-rwx---r-x 1 thoj thoj 11321 jul  3 20:01 <span class="green1">index.html</span>
</pre>

<p>Læg mærke til at man bliver nød til at bruge den fulde sti til mappen for at se indholdet. Hvis man viser en liste ved at bruge det symbolske link sker der følgende:</p>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ ls -l ~/html
lrwxrwxrwx 1 thoj thoj 14 jul  4 18:45 <span class="turk">/home/thoj/html</span> -> <span class="blue1">/var/www/html/</span>
</pre>

<p>Grunden til at vi ikke ser indholdet af den mappe det symbolske link henviser til skyldes, at linket egentlig er en fil. Derfor kan man ikke liste indholdet af mappen. Man kan godt godt "ramme" en fil igennem det symbolske link f.eks:</p>

<code class="cmd">cat ~/html/index.html | head -5</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ cat ~/html/index.html | head -5
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
  &lt;!--
    Modified from the Debian original for Ubuntu
</pre>


<h2>Personlige hjemmesider</h2>

<p>Hvis man har flere brugere på webserveren kan man give hver af dem deres egen hjemmeside på webserveren. Den kan så tilgås fra adressen: <span class="inl_cmd">*serveradresse*/~*brugernavn*</span></p>

<p>Alle brugere bliver oprettet ud fra en skabelon som ligger i <span class="inl_cmd">/etc/skel</span>.</p>

<pre class="ubuntu_terminal">
thoj@tjmainsrv:/etc/skel$ ls -al
total 20
drwxr-xr-x  2 root root 4096 dec  4 08:08 .
drwxr-xr-x 98 root root 4096 dec 16 11:30 ..
-rw-r--r--  1 root root  220 apr  9  2014 .bash_logout
-rw-r--r--  1 root root 3637 apr  9  2014 .bashrc
-rw-r--r--  1 root root  675 apr  9  2014 .profile
</pre>

<p>I denne mappe skal vi have oprettet en privat www-mappe, som vi kalder <span class="inl_cmd">public_html</span>. I denne mappe læger vi mapperne: <span class="inl_cmd">images</span> til billeder, <span class="inl_cmd">css</span> til CSS filer og <span class="inl_cmd">js</span> til Javascript filer.</p>

<code class="cmd">sudo mkdir -p /etc/skel/public_html/images /etc/skel/public_html/css /etc/skel/public_html/js</code>

<p>Herefter opretter vi filerne <span class="inl_cmd">index.html</span>, som indeholder en enkelt linie: Overskriften "Din Hjemmeside"</p>

<code class="cmd">echo "&lt;h1&gt;Din hjemmeside&lt;/h1&gt;" | sudo tee /etc/skel/public_html/index.html </code>

<p>Det sidste vi skal have gjort er at ændre filrettighederne for brugernes www-mapper.</p>

<code class="cmd">sudo chmod -R 705 /etc/skel/public_html</code>

<p>Vi kan tjekke filstrukturen med kommandoen tree, som vi først skal have installeret:</p>

<code class="cmd">sudo apt install tree</code>

<code class="more_cmd">tree /etc/skel -pua --dirsfirst</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ tree /etc/skel -pua --dirsfirst
<span class="blue1">/etc/skel</span>
├── [drwx---r-x root    ]  <span class="blue1">public_html</span>
│   ├── [drwx---r-x root    ]  <span class="blue1">css</span>
│   ├── [drwx---r-x root    ]  <span class="blue1">images</span>
│   ├── [drwx---r-x root    ]  <span class="blue1">js</span>
│   └── [-rwx---r-x root    ]  <span class="green1">index.html</span>
├── [-rw-r--r-- root    ]  .bash_logout
├── [-rw-r--r-- root    ]  .bashrc
└── [-rw-r--r-- root    ]  .profile

4 directories, 5 files
</pre>

<p>På webservere er det normen at man giver filerne 705 rettigheder. På den måde har ejeren af mappen læse, skrive og udføre på alle filer, men alle kan læse og udføre når de åbner filen i en browser.</p>

<p>Apache2 har slået PHP fra i brugerens directories. For at slå det til skal vi udkommentere følgende i <span class="inl_cmd">/etc/apache2/mods-enabled/php7.0.conf</span>. Ændr det fra: </p>

<code class="cmd">sudo nano /etc/apache2/mods-enabled/php7.0.conf</code>

<pre class="black">
# Running PHP scripts in user directories is disabled by default
#
# To re-enable PHP in user directories comment the following lines
# (from &lt;IfModule ...&gt; to &lt;/IfModule&gt;.) Do NOT set it to On as it
# prevents .htaccess files from disabling it.
&lt;IfModule mod_userdir.c&gt;
    &lt;Directory /home/*/public_html&gt;
        php_admin_flag engine Off 
    &lt;/Directory&gt; 
&lt;/IfModule&gt; 
</pre>

<p>til ...</p>

<pre class="black">
# Running PHP scripts in user directories is disabled by default
#
# To re-enable PHP in user directories comment the following lines
# (from &lt;IfModule ...&gt; to &lt;/IfModule&gt;.) Do NOT set it to On as it
# prevents .htaccess files from disabling it.
<span class="red">#</span>&lt;IfModule mod_userdir.c&gt; <span class="red">&lt;--- Start linien med #</span>
<span class="red">#</span>    &lt;Directory /home/*/public_html&gt; <span class="red">&lt;--- Start linien med #</span>
<span class="red">#</span>        php_admin_flag engine Off <span class="red">&lt;--- Start linien med #</span>
<span class="red">#</span>    &lt;/Directory&gt; <span class="red">&lt;--- Start linien med #</span>
<span class="red">#</span>&lt;/IfModule&gt; <span class="red">&lt;--- Start linien med #</span>
</pre>

<p>Som det sidste skal vi have aktiveret brugernes webfolders i apache2 og genstartet tjenesten</p>

<code class="cmd">sudo a2enmod userdir</code>

<code class="more_cmd">sudo systemctl restart apache2</code>

<p>Test ved at oprette brugeren <span class="inl_cmd">testweb</span> og naviger til <span class="inl_cmd">192.168.0.10/~testweb</span> i en browser og tilgå brugerens mappe over FTP. Vær opmærksom på at det kun er brugere, der er oprettet efter ændringen der får oprettet disse mapper.</p>

<code class="cmd">sudo adduser testweb</code>

<p>Åbn browseren og sæt adressen til <span class="inl_cmd">192.168.0.10\~testweb</span> for at test den personlige hjemmeside.</p>

<figure id="">

	<img class="p90" src="images/webserver_kontroller_apache_lokal_bruger.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Vær opmærksom på at det kun er brugere, der er oprettet efter ændringen der får oprettet disse mapper. Ønsker du at give de oprindelige brugere deres egen web-mappe skal de kopieres ind og der skal ændres ejerskab.Her gøres det for min bruger <span class="inl_cmd">thoj</span>.</p>

<code class="cmd">cp -R /etc/skel/public_html /home/thoj</code>

<code class="more_cmd">chown -R thoj:thoj /home/thoj/public_html/</code>

<h1>mariaDB og PHPMyAdmin</h1>

<p>Opsætningen af mariaDB og PHPMyAdmin skal gøres over 3 trin:</p>

<ol class="">
	<li>Installation og opsætning af mariaDB pg PHPMyAdmin</li>
	<li>Installation af PHPMyAdmin</li>
	<li>Sætte rettigheder for kørsel af mariaDB</li>
</ol>

<p>Grunden til at opsætningen skal køres over 3 stadier skyldes, at vi ønsker at give adgang til databasen fra andre end systemets <span class="inl_cmd">root</span>bruger. For at undgå problemer med rettighederne skal mariaDB og PHPMyAdmin sættes op før vi roder med rettighederne for tilgangen til databasen.</p>


<h2>mariaDB</h2>

<p></p>

<code class="cmd">sudo apt install -y mariadb-server mariadb-client</code>

<p>Kør konfigurationen af mariaDB</p>

<code class="cmd">sudo mysql_secure_installation</code>

<p>I dette script bliver <span class="inl_cmd">mariaDB</span>  sat op, så den er klar til brug. Da det er en ny installation har databasen endnu ikke noget password, så det skal vi oprette. Ellers er de svar du skal anvende angivet med en taste.</p>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ sudo mysql_secure_installation

NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we'll need the current
password for the root user.  If you've just installed MariaDB, and
you haven't set the root password yet, the password will be blank,
so you should just press enter here.

Enter current password for root (enter for none): <kbd>Enter</kbd> 
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MariaDB
root user without the proper authorisation.

Set root password? [Y/n] y <kbd>y</kbd>
New password: <span class="red">&lt;--- Indtast password for databasens root bruger</span>
Re-enter new password: <span class="red">&lt;--- Gentag password for databasens root bruger</span>
Password updated successfully!
Reloading privilege tables..
 ... Success!


By default, a MariaDB installation has an anonymous user, allowing anyone
to log into MariaDB without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] y <kbd>y</kbd>
 ... Success!

Normally, root should only be allowed to connect from 'localhost'.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] y <kbd>y</kbd>
 ... Success!

By default, MariaDB comes with a database named 'test' that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n] y <kbd>y</kbd>
 - Dropping test database...
ERROR 1008 (HY000) at line 1: Can't drop database 'test'; database doesn't exist
 ... Failed!  Not critical, keep moving...
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n] <kbd>y</kbd>
 ... Success!

Cleaning up...

All done!  If you've completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!
thoj@mainsrv:~$
</pre>

<p>Der er to brugere der nu har adgang til databasen. Det er systemets root og databasens rod. Som det er lige nu er det kun systemets rod der har lov til at logge på databasen. Det skal ændres, sådan at andre brugere også kan logge på databasen. Start <span class="inl_cmd">mysql</span> som systemets rod</p>

<h2>PHPMyAdmin</h2>

<p>For at administrere MySQL databaser anvender man ofte PHPMyAdmin</p>

<code class="cmd">sudo apt install php-gettext phpmyadmin -y</code>

<p>Under installationen skal der gøres følgende:</p>

<ol class="">
	<li>Vælge webserver der skal køre <span class="inl_cmd">PHPMyAdmin</span></li>
	<li>Opsætning af nødvendig database til PHPMyAdmin</li>
	<li>Lave root password til PHPMyAdmin</li>
</ol>
<p></p>

<p>Vælg <span class="inl_cmd">Apache2</span> og vælg <span class="terminal_valg">O.k.</span></p>

<figure id="">

	<img class="p80" src="images/webserver_phpmyadmin01.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Sæt databasen op ved at vælge <span class="terminal_valg">Ja</span></p>

<figure id="">

	<img class="p80" src="images/webserver_phpmyadmin02.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Indtast password 2 gange (her vælger jeg <span class="inl_cmd">123qwe</span>) til PHPMyAdmins root-konto: </p>

<figure id="">

	<img class="p80" src="images/webserver_phpmyadmin03.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Genstart Apache 2</p>

<code class="cmd">sudo systemctl restart apache2</code>

<h2>Konfiguration af mariaDB</h2>

<p>Som det er lige nu kan databasen kun tilgås ved hjælp af root-shell. Det ændrer vi, så alle brugere med mariaDB's root password kan få adgang til databasen.</p>

<code class="cmd">sudo mysql</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ sudo mysql
<span class="bold">Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 65
Server version: 10.0.25-MariaDB-0ubuntu0.16.04.1 Ubuntu 16.04

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span>

MariaDB [(none)]>
</pre>

<p>Herefter køres følgende kommandoer i <span class="inl_cmd">mysql</span>. Husk at afslutte kommandoerne med <span class="inl_cmd">;</span>:</p>

<code class="cmd">use mysql;</code>
<code class="more_cmd">update user set plugin='' where User='root';</code>
<code class="more_cmd">flush privileges;</code>
<code class="more_cmd">exit</code>


<pre class="ubuntu_terminal">
MariaDB [(none)]> <span class="red">use mysql;</span>
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [mysql]> <span class="red">update user set plugin='' where User='root';</span>
<span class="bold">Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0</span>

MariaDB [mysql]> <span class="red">flush privileges;</span>
<span class="bold">Query OK, 0 rows affected (0.00 sec)</span>

MariaDB [mysql]> <span class="red">exit</span>
<span class="bold">Bye</span>
thoj@mainsrv:~$                <span class="red">&lt;--- Tilbage på kommandolinien</span>
</pre>

<p>Prøv herefter at logge på <span class="inl_cmd">mysql's</span> root, med din egen bruger (altså uden sudo):</p>

<code class="cmd">mysql -u root -p</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ mysql -u root -p
Enter password: 
<span class="bold">Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 53
Server version: 10.0.25-MariaDB-0ubuntu0.16.04.1 Ubuntu 16.04

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span>

MariaDB [(none)]> exit
<span class="bold">Bye</span>
thoj@mainsrv:~$
</pre>

<p>Vi logger også på <span class="inl_cmd">PHPMyAdmin</span> fra en browser med adressen: <span class="inl_cmd">10.0.2.10/phpmyadmin</span></p>

<figure id="">

	<img class="p90" src="images/webserver_phpmyadmin_browser_01.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Efter vi er logget ind med PHPMyAdmin's <span class="inl_cmd">root</span> får vi adgang til brugerfladen.</p>

<figure id="">

	<img class="p90" src="images/webserver_phpmyadmin_browser_02.png" alt="" title="" />

	<figcaption></figcaption>

</figure>


<h1>Nextcloud</h1>

<p>Denne guide er lavet med udgangspunkt i installationsguiden fra nextclouds egen hjemmeside: <a href="https://docs.nextcloud.org/server/9/admin_manual/installation/source_installation.html" target="_blank">https://docs.nextcloud.org/server/9/admin_manual/installation/source_installation.html</a></p>

<p>Nextcloud anbefaler at man installerer nogle ekstra PHP-moduler</p>

<code class="cmd">sudo apt -y install php7.0-curl php7.0-bz2 php7.0-zip php7.0-intl php-imagick</code>

<p>Herefter er vi klar til at hente Nextcloud fra serveren. Tjek efter den nyeste version på adressen: <a href="https://download.nextcloud.com/server/releases" target="_blank">https://download.nextcloud.com/server/releases</a>. Vi skal have fat i <span class="inl_cmd">tar.bz2</span> filen.Da guiden er skrevet er det version 9.0.52 kommer kommandoen til at se ud som herunder. Ændr. versionsnummeret der står med rødt, så det passer til din version. Først navigerer vil til vores hjemmemappe, så vi ved hvor filen bliver gemt.</p>

<code class="cmd">wget https://download.nextcloud.com/server/releases/nextcloud-<span class="red">9.0.52</span>.tar.bz2</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ wget https://download.nextcloud.com/server/releases/nextcloud-9.0.52.tar.bz2
--2016-07-05 17:34:23--  https://download.nextcloud.com/server/releases/nextcloud-9.0.52.tar.bz2
Løser download.nextcloud.com (download.nextcloud.com)... 88.198.160.133
Tilslutter download.nextcloud.com (download.nextcloud.com)|88.198.160.133|:443... forbundet.
HTTP forespørgsel sendt, afventer svar... 200 OK
Længde: 28523179 (27M) [application/x-bzip2]
Gemmer til: 'nextcloud-9.0.52.tar.bz2'

nextcloud-9.0.52.ta 100%[==================>]  27,20M  3,41MB/s    in 8,0s    

2016-07-05 17:34:32 (3,41 MB/s) - 'nextcloud-9.0.52.tar.bz2' gemt [28523179/28523179]
</pre>

<p>Udpak filen</p>

<code class="cmd">tar -xjf nextcloud-9.0.52.tar.bz2</code>

<p>Som du kan se herunder er filerne pakket ud i mappen <span class="inl_cmd">nextcloud</span>.</p>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ tar -xjf nextcloud-9.0.52.tar.bz2
thoj@mainsrv:~$ ls -l
totalt 27864
lrwxrwxrwx  1 thoj thoj       14 jul  5 10:28 <span class="turk">html</span> -> <span class="blue1">/var/www/html/</span>
drwxr-xr-x 14 thoj thoj     4096 jul  5 11:10 <span class="blue1">nextcloud</span>
-rw-rw-r--  1 thoj thoj 28523179 jul  5 11:12 <span class="red">nextcloud-9.0.52.tar.bz2</span>
drwx---r-x  5 thoj thoj     4096 jul  5 10:39 <span class="blue1">public_html</span>
</pre>

<p>Flyt mappen <span class="inl_cmd">nextcloud</span> til <span class="inl_cmd">/var/www</span></p>

<code class="cmd">sudo cp -r nextcloud /var/www/</code>

<p>Opret mappe til data i <span class="inl_cmd">/srv/nextcloudData</span></p>

<code class="cmd">sudo mkdir /srv/nextcloudData</code>

<span class="afsnit">Midlertidige rettigheder</span>

<p>Sæt midlertidige bruger- og filrettigheder på nextcloud</p>

<code class="cmd">sudo chown -R www-data:www-data /var/www/nextcloud</code>

<code class="more_cmd">sudo chmod -R 700 /var/www/nextcloud</code>

<p>... og datamappen</p>

<code class="cmd">sudo chown -R www-data:www-data /srv/nextcloudData/</code>

<code class="cmd">sudo chmod -R 700 /srv/nextcloudData</code>

<h2>Konfigurer Apache</h2>

<p>For at kunne udbyde nextcloud skal der oprettes en konfigurationsfil i Apache. Opret følgende fil <span class="inl_cmd">/etc/apache2/sites-available/nextcloud.conf</span> med nedestående indhold:</p>

<code class="cmd">sudo nano /etc/apache2/sites-available/nextcloud.conf</code>

<pre class="black">
Alias /nextcloud "/var/www/nextcloud/"

&lt;Directory /var/www/nextcloud/>
  Options +FollowSymlinks
  AllowOverride All

 &lt;IfModule mod_dav.c>
  Dav off
 &lt;/IfModule>

 SetEnv HOME /var/www/nextcloud
 SetEnv HTTP_HOME /var/www/nextcloud

&lt;/Directory>
</pre>

<p>Lav herefter et symbolsk link til filen, så Apache kan tilgå den.</p>

<code class="cmd">sudo ln -s /etc/apache2/sites-available/nextcloud.conf /etc/apache2/sites-enabled/nextcloud.conf</code>

<p>Som det sidste skal vi sikre os at nogle moduler er startet op i Apache</p>

<code class="cmd">sudo a2enmod rewrite headers</code>

<p>Genstart Apache2, så ændringer kan blive aktiveret.</p>

<code class="cmd">sudo systemctl restart apache2</code>

<p>Kontroller at nextcloud kører ved at gå til adressen <span class="inl_cmd">https://192.168.0.10/nextcloud</span>:</p>

<figure id="">

	<img class="p90" src="images/webserver_nexcloud_setup.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Det vi har her er konfigurationsskærmen til Nextcloud. Som vi udfylder senere:</p>

<h2>Opret database</h2>

<p>Før vi går i gang med at konfigurere Nextcloud skal vi have oprettet en database og en administrator til databasen. Det vi skal gøre er følgende:</p>

<ol class="">
	<li>Log på databaseserveren</li>
	
	<code class="cmd">mysql -u root -p</code>
	
	<li>Opret databasen <span class="inl_cmd">nextcloudDB</span></li>
	
	<code class="cmd">CREATE DATABASE nextcloudDB;</code>
	
	<li>Opret brugeren <span class="inl_cmd">nextcloud</span> og med password: <span class="inl_cmd">123qwe</span>.</li>
	
	<code class="cmd">CREATE USER nextcloud@localhost IDENTIFIED BY '123qwe';</code>
	
	<li>Giv brugeren <span class="inl_cmd">nextcloud</span> fulde rettigheder til databasen</li>
	
	<code class="cmd">GRANT ALL PRIVILEGES ON nextcloudDB.* TO nextcloud@localhost;</code>
	
	<li>Genindlæs rettighedenrne for hele databasen</li>
	
	<code class="cmd">FLUSH PRIVILEGES;</code>
		
	<li>Luk forbindelsen databaseserveren</li>

	<code class="cmd">exit</code>

</ol>

<p>Det kommer til at se ud som følger. Kommandoer er markeret med rødt:</p>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ <span class="red">mysql -u root -p</span>
Enter password: 
<span class="bold">Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 7
Server version: 10.0.25-MariaDB-0ubuntu0.16.04.1 Ubuntu 16.04

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span>

MariaDB [(none)]> <span class="red">CREATE DATABASE nextcloudDB;</span>
<span class="bold">Query OK, 1 row affected (0.01 sec)</span>

MariaDB [(none)]> <span class="red">CREATE USER nextcloud@localhost IDENTIFIED BY '123qwe';</span>
<span class="bold">Query OK, 0 rows affected (0.01 sec)</span>

MariaDB [(none)]> <span class="red">GRANT ALL PRIVILEGES ON nextcloudDB.* TO nextcloud@localhost;</span>
<span class="bold">Query OK, 0 rows affected (0.00 sec)</span>

MariaDB [(none)]> <span class="red">FLUSH PRIVILEGES;</span>
<span class="bold">Query OK, 0 rows affected (0.01 sec)</span>

MariaDB [(none)]> <span class="red">exit</span>
<span class="bold">Bye</span>
</pre>

<h2>Konfigurer Nextcloud</h2>

<p>Åbn Nextcloud i browseren på adressen: <span class="inl_cmd">https://192.168.0.10/nextcloud</span>. Første gang Nextcloud startes på skal admin kontoen konfigureres. Herunder er konfigurationssiden "klippet" over:</p>

<span class="afsnit">Administrator konto</span>

<p>Dette er kontoen som skal anvendes til at administrere Nextcloud med. Det kan f.eks. være at oprette brugere, sætte deres rettigheder og installere apps.</p>

<figure id="">

	<img class="p35" src="images/webserver_nexcloud_setup01.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<table class="">
	<thead>
		<tr>
			<th>Felt</th>
			<th>Beskrivelse</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Username</td>
			<td>Indsæt navnet på den bruger der skal administrere Nextcloud. F.eks: <span class="inl_cmd">nextadmin</span></td>
		</tr>
		<tr>
			<td>Password</td>
			<td>Giv administrationsbrugeren et password. F.eks: <span class="inl_cmd">123qwe</span></td>
		</tr>
	</tbody>
</table>

<span class="afsnit">Placering af data</span>

<p>Her placeres de data som brugerne lægger op. På den måde er data ikke tilgængelige for selve webserveren, men kræver adgang til databasen.</p>

<figure id="">

	<img class="p35" src="images/webserver_nexcloud_setup02.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<table class="">
	<thead>
		<tr>
			<th>Felt</th>
			<th>Beskrivelse</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Data folder</td>
			<td>Mappen som filerne fra Nextcloud skal lægges i. Her har vi valgt <span class="inl_cmd">/srv/nextcloudData</span></td>
		</tr>
	</tbody>
</table>

<figure id="">

	<img class="p35" src="images/webserver_nexcloud_setup03.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<table class="">
	<thead>
		<tr>
			<th>Felt</th>
			<th>Beskrivelse</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Database user</td>
			<td>Her skal vi angive den bruger der ejer databasen. I dette tilfælde: <span class="inl_cmd">nextcloud</span></td>
		</tr>
		<tr>
			<td>Database password</td>
			<td>Angiv password til databasen: I dette tilfælde: <span class="inl_cmd">123qwe</span></td>
		</tr>
		<tr>
			<td>Database name</td>
			<td>Angiv databasens navn: I dette tilfælde: <span class="inl_cmd">nextcloudDB</span></td>
		</tr>
		<tr>
			<td>Localhost</td>
			<td>Angiv databasens placering. I vores tilfælde skal det ikke ændres da databasen ligger på samme fysiske maskine som webserveren.</td>
		</tr>
	</tbody>
</table>

<span class="afsnit">Afslut installationen</span>

<p>Klik på <span class="inl_cmd">Finish setup</span>, for at afslutte konfigurationen af Nextcloud. Efter lidt til start Nextcloud op.</p>

<figure id="">

	<img class="p90" src="images/webserver_nexcloud_setup05.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<h2>Optimering af Nextcloud</h2>

<span class="afsnit">Konfigurer datacache</span>

<p>For at optimere data i nextcloud skal programmet PACu installeres:</p>

<code class="cmd">sudo apt install php-apcu</code>

<p>For at aktivere cachen skal linien <span class="inl_cmd">'memcache.local' => '\OC\Memcache\APCu',</span> indsættes i <span class="inl_cmd">/var/www/nextcloud/config/config.php</span></p>

<code class="cmd">sudo nano /var/www/nextcloud/config/config.php</code>

<pre class="black">
<span class="green1">&lt;?php</span>
$CONFIG = array (
  'instanceid' => 'ocopuk8v1cp5',
  'passwordsalt' => 'VvzYXbnqZRiv8fSS5NDE+zMgy6h8Uk',
  'secret' => 'MoI6HPw1OjXv6+v5KKUgRVcnzaUQ8/4SQAwl0EfKH7ZqUOcb',
  'trusted_domains' => 
  array (
    0 => '192.168.0.10',
  ),
  'datadirectory' => '/srv/nextcloudData',
  'overwrite.cli.url' => 'http:<span class="blue1">//192.168.0.10/nextcloud',</span>
  'dbtype' => 'mysql',
  'version' => '9.0.52.0',
  'dbname' => 'nextcloudDB',
  'dbhost' => 'localhost',
  'dbtableprefix' => 'oc_',
  'dbuser' => 'nextcloud',
  'dbpassword' => '123qwe',
  'logtimezone' => 'UTC',
  'installed' => true,
<span class="red">  'memcache.local' => '\OC\Memcache\APCu',</span>
);
<span class="green1">?></span>
</pre>

<p>Indsæt herefter linien: <span class="inl_cmd">apc.enable_cli = 1</span> nedest i <span class="inl_cmd">/etc/php/7.0/apache2/php.ini</span></p>

<code class="cmd">sudo nano /etc/php/7.0/apache2/php.ini</code>

<pre class="black">
....

; Local Variables:
; tab-width: 4
; End:
<span class="red">apc.enable_cli = 1</span>
</pre>

<span class="afsnit">Konfigurering af max filstørrelse</span>

<p>Som standard er Nextcloud sat til at filer ikke må være større end 513 MB. Det kan være upraktisk hvis man f.eks. ønsker at bruge nextclouod til backup eller ISO-filer. For at ændre dette skal vi have ændret i den skjulte fil <span class="inl_cmd">.htaccess</span>, der ligger i Nextclouds webmappe <span class="inl_cmd">/var/www/nextcloud</span>.</p>

<code class="cmd">sudo nano /var/www/nextcloud/.htaccess</code>

<p>Find tekststrengen <span class="inl_cmd">&lt;IfModule mod_php7.c></span> og de to linier med <span class="inl_cmd">upload_max_filesize</span> og <span class="inl_cmd">post_max_size</span>.</p>

<pre class="black">
&lt;IfModule mod_php7.c>
<span class="red">  php_value upload_max_filesize 513M
  php_value post_max_size 513M</span>
  php_value memory_limit 512M
  php_value mbstring.func_overload 0
  php_value default_charset 'UTF-8'
  php_value output_buffering 0
  &lt;IfModule mod_env.c>
    SetEnv htaccessWorking true
  &lt;/IfModule>
&lt;/IfModule>
</pre>

<p>Ændr værdierne fra <span class="inl_cmd">513M</span> til <span class="inl_cmd">4G</span> (513 Mb til 4Gb), sådan at der står:</p>

<pre class="black">
&lt;IfModule mod_php7.c>
<span class="red">  php_value upload_max_filesize 4G
  php_value post_max_size 4G</span>
  php_value memory_limit 512M
  php_value mbstring.func_overload 0
  php_value default_charset 'UTF-8'
  php_value output_buffering 0
  &lt;IfModule mod_env.c>
    SetEnv htaccessWorking true
  &lt;/IfModule>
&lt;/IfModule>
</pre>

<p>Genstart Apache 2 for at ændringerne slår igennem.</p>

<code class="cmd">sudo systemctl restart apache2</code>

<h2>Sæt sikkerheden</h2>

<p>Som det er nu er sikkerheden på nextcloudfilerne sat rimeligt. Men for at de bliver så sikre som muligt skal der gøres en del arbejde. Hertil anvendes der et script, som er vist herunder:</p>

<p>Sørg for at du står i din home-mappe, opret filen og kopier indholdet af nedestående script in i filen <span class="inl_cmd">nextcloud_rettigheder.sh</span></p>

<code class="cmd">cd ~</code>

<code class="more_cmd">nano nextcloud_rettigheder.sh</code>

<pre class="black">
#!/bin/bash

### Scriptet er taget fra nedestående og tilrettet denn guide
### https://docs.nextcloud.org/server/9/admin_manual/installation/installation_wizard.html#setting-strong-directory-permissions
### Relevante linier er udkommenteret og der er indsat kommentarer ved 
### linier der er tilføjet

datapath='/srv/nextcloudData' ### Tilføjet path til data
ncpath='/var/www/nextcloud'
htuser='www-data'
htgroup='www-data'
rootuser='root' 

printf "Creating possible missing Directories\n"
#mkdir -p $ncpath/data
mkdir -p $ncpath/assets
mkdir -p $ncpath/updater

printf "chmod Files and Directories\n"
find ${ncpath}/ -type f -print0 | xargs -0 chmod 0640
find ${ncpath}/ -type d -print0 | xargs -0 chmod 0750

### linier tilføjet for at sætte rettigheder på datapath
find ${datapath}/ -type f -print0 | xargs -0 chmod 0640
find ${datapath}/ -type d -print0 | xargs -0 chmod 0750

printf "chown Directories\n"
chown -R ${rootuser}:${htgroup} ${ncpath}/
chown -R ${htuser}:${htgroup} ${ncpath}/apps/
chown -R ${htuser}:${htgroup} ${ncpath}/assets/
chown -R ${htuser}:${htgroup} ${ncpath}/config/
chown -R ${htuser}:${htgroup} ${ncpath}/data/
chown -R ${htuser}:${htgroup} ${ncpath}/themes/
chown -R ${htuser}:${htgroup} ${ncpath}/updater/

### Linie tilføjet for at sætte rettigheder på datapath
chown -R ${htuser}:${htgroup} ${datapath}/


chmod +x ${ncpath}/occ

printf "chmod/chown .htaccess\n"
if [ -f ${ncpath}/.htaccess ]
 then
  chmod 0644 ${ncpath}/.htaccess
  chown ${rootuser}:${htgroup} ${ncpath}/.htaccess
fi
if [ -f ${datapath}/.htaccess ]
 then
  chmod 0644 ${datapath}/.htaccess
  chown ${rootuser}:${htgroup} ${datapath}/.htaccess
fi
</pre>

<p>Sæt rettigheder så filen kan køres:</p>

<code class="cmd">chmod 700 nextcloud_rettigheder.sh</code>

<p>Scriptet er lavet så det skal køres i en <span class="inl_cmd">root</span>-shell. Det gør vi ved at køre kommandoen <span class="inl_cmd">sudo su</span>.</p>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ sudo su
Adgangskode: 
root@mainsrv:/home/thoj#
</pre>

<p>Læg mærke til at linien skifter fra <span class="inl_cmd">thoj@mainsrv:~$</span> til <span class="inl_cmd">root@mainsrv:/home/thoj#</span>. Kør scriptet i root-shell med kommandoen:</p>

<code class="cmd">./nextcloud_rettigheder.sh </code>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# ./nextcloud_rettigheder.sh 
Creating possible missing Directories
chmod Files and Directories
chown Directories
chmod/chown .htaccess
root@mainsrv:/home/thoj#
</pre>

<p>Efter scriptet er kørt er alle filer og mapper konfigureret på den bedst mulige måde. Afslut <span class="inl_cmd">root</span>-shell med kommandoen <span class="inl_cmd">exit</span>.</p>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# exit
exit
thoj@mainsrv:~$ 
</pre>

<h1>Wordpress</h1>

<p>Wordpress er en meget populær CMS (<span class="bold">C</span>ontent <span class="bold">M</span>anagement <span class="bold">S</span>ystem, som gør det nemt at oprette en hjemmeside. Her vil vi installere Wordpress, så den overtager ens hjemmeside.</p>

<p>Hent den nyeste version af wordpress</p>

<code class="cmd">wget https://wordpress.org/latest.tar.gz</code>

<p>Udpak filen</p>

<code class="cmd">tar -xzf latest.tar.gz</code>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ tar -xzf latest.tar.gz
thoj@mainsrv:~$ ls -l
totalt 27864
lrwxrwxrwx  1 thoj thoj       14 jul  5 10:28 <span class="turk">html</span> -> <span class="blue1">/var/www/html/</span>
-rw-rw-r--  1 thoj thoj  7773389 jun 21 18:18 <span class="red">latest.tar.gz</span>
drwxr-xr-x 14 thoj thoj     4096 jul  5 11:10 <span class="blue1">nextcloud</span>
-rw-rw-r--  1 thoj thoj 28523179 jul  5 11:12 <span class="red">nextcloud-9.0.52.tar.bz2</span>
drwx---r-x  5 thoj thoj     4096 jul  5 10:39 <span class="blue1">public_html</span>
drwxr-xr-x  5 thoj thoj     4096 jul  5 10:39 <span class="blue1">wordpress</span>
</pre>

<p>Kopier Wordpress over i webserverens mappe</p>

<code class="cmd">sudo cp -r wordpress/* /var/www/html</code>

<p>Opret en mappe til uploads:</p>

<code class="cmd">sudo mkdir /var/www/html/wp-content/uploads</code>

<p>Fjern index.html, som blev oprettet under installationen af Apache.</p>

<code class="cmd">sudo rm /var/www/html/index.html</code>

<span class="afsnit">Midlertidige rettigheder</span>

<p>Sæt midlertidige ejerskab og skriverettigheder for wordpress</p>

<code class="cmd">sudo chown -R www-data:www-data /var/www/html</code>

<code class="more_cmd">sudo chmod -R 755 /var/www/html</code>


<h2>Opret database</h2>

<ol class="">
	<li>Log på databaseserveren</li>
	
	<code class="cmd">mysql -u root -p</code>
	
	<li>Opret databasen <span class="inl_cmd">wordpressDB</span></li>
	
	<code class="cmd">CREATE DATABASE wordpressDB;</code>
	
	<li>Opret brugeren <span class="inl_cmd">wordpress</span> og med password: <span class="inl_cmd">123qwe</span>.</li>
	
	<code class="cmd">CREATE USER wordpress@localhost IDENTIFIED BY '123qwe';</code>
	
	<li>Giv brugeren <span class="inl_cmd">wordpress</span> fulde rettigheder til databasen</li>
	
	<code class="cmd">GRANT ALL PRIVILEGES ON wordpressDB.* TO wordpress@localhost;</code>
	
	<li>Genindlæs rettighederne for hele databasen</li>
	
	<code class="cmd">FLUSH PRIVILEGES;</code>
		
	<li>Luk forbindelsen databaseserveren</li>

	<code class="cmd">exit</code>

</ol>


<pre class="ubuntu_terminal">
thoj@mainsrv:~$ mysql -u root -p
Enter password: 
<span class="bold">Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 7
Server version: 10.0.25-MariaDB-0ubuntu0.16.04.1 Ubuntu 16.04

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span>

MariaDB [(none)]> CREATE DATABASE wordpressDB;
<span class="bold">Query OK, 1 row affected (0.00 sec)</span>

MariaDB [(none)]> CREATE USER wordpress@localhost IDENTIFIED BY '123qwe';
<span class="bold">Query OK, 0 rows affected (0.00 sec)</span>

MariaDB [(none)]> GRANT ALL PRIVILEGES ON wordpressDB.* TO wordpress@localhost;
<span class="bold">Query OK, 0 rows affected (0.00 sec)</span>

MariaDB [(none)]> FLUSH PRIVILEGES;
<span class="bold">Query OK, 0 rows affected (0.00 sec)</span>

MariaDB [(none)]> exit
<span class="bold">Bye</span>
thoj@mainsrv:~$ 
</pre>

<h2>Sæt upload indstillinger</h2>

<p>Som standard er Wordpress sat til at uploade filer der maksimalt er 2 MB store. Dette er uhensigtsmæssigt, hvis man vil lægge video og lignene på på sin side. Derfor vil vi ændre det til 64 MB. Ændr følgende 4 linier i filen <span class="inl_cmd">/etc/php/7.0/apache2/php.ini</span>. Åbn <span class="inl_cmd">php.ini</span> med kommandoen:</p>

<code class="cmd">sudo nano /etc/php/7.0/apache2/php.ini</code>

<p>Find nedestående linier og ændr størrelsen til <span class="inl_cmd">64MB</span> og <span class="inl_cmd">300</span>.</p>

<pre class="black">
upload_max_filesize <span class="red">64M</span>

post_max_size <span class="red">64M</span>

max_execution_time <span class="red">300</span>

max_input_time <span class="red">300</span>
</pre>

<h2>Konfigurer Wordpress</h2>

<p>Da vi har sat wordpress til at være roden på vores webserver, skal vi blot indtaste IP-adressen i browseren: <span class="inl_cmd">https://192.168.0.10/</span></p>

<p>Åbn Nextcloud i browseren på adressen: https://192.168.0.10/. Første gang Wordpress startes bliver man ført igennem konfigurationen. Herunder er vist og forklaret:</p>

<span class="afsnit">Vælg sprog</span>

<p>Vælg dansk og tryk <span class="knap">Fortsæt</span></p>

<figure id="">

	<img class="p40" src="images/webserver_wordpress_setup01.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<span class="afsnit">Velkomstside med forklaring af processen</span>

<p>Siden er blot til information vælg <span class="knap">Lad os komme i gang</span></p>


<figure id="">

	<img class="p90" src="images/webserver_wordpress_setup02.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<span class="afsnit">Angiv database information</span>

<table class="">
	<thead>
		<tr>
			<th>Felt</th>
			<th>Beskrivelse</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Databasenavn</td>
			<td>Angiv navnet på din database. Her: <span class="inl_cmd">wordpressDB</span>. Husk forskellen mellem store og små bogstaver.</td>
		</tr>
		<tr>
			<td>Brugernavn</td>
			<td>Angiv den bruger som administrerer databasen. Her: <span class="inl_cmd">wordpress</span>.</td>
		</tr>
		<tr>
			<td>Adgangskode</td>
			<td>Angiv databasebrugerens adgangskode. Her: <span class="inl_cmd">123qwe</span></td>
		</tr>
		<tr>
			<td>Database Host</td>
			<td>Angiv databasens adresse. På netværk anvender computere og tjenester IP-adresser til at identificere sig. Her: <span class="inl_cmd">localhost</span>. Localhost svarer til at det er den samme maskine som webserveren befinder sig på.</td>
		</tr>
		<tr>
			<td>Tabelpræfiks</td>
			<td>Er der flere Wordpress brugere i i samme database kan man adskille dem ved at indsætte et præfiks i alle tabelnavnene. På den måde kan man sortere i hvilke data der tilhører hvilke brugere. Behold <span class="inl_cmd">wp_</span>.</td>
		</tr>
	</tbody>
</table>

<p>Efter informationerne er indtastet. Vælg <span class="knap">Send</span> og <span class="knap">Start installation</span> på den næste side.</p>

<figure id="">

	<img class="p90" src="images/webserver_wordpress_setup03.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p></p>

<figure id="">

	<img class="p90" src="images/webserver_wordpress_setup04.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<span class="afsnit">Nødvendige informationer</span>

<table class="">
	<thead>
		<tr>
			<th>Felt</th>
			<th>Beskrivelse</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Sidetitel</td>
			<td>Hvad skal titlen være på siden?</td>
		</tr>
		<tr>
			<td>Brugernavn</td>
			<td>Dette brugernavn er til sidens administrator. Her har jeg valgt <span class="inl_cmd">Thomas</span></td>
		</tr>
		<tr>
			<td>Adgangskode</td>
			<td>Her skal du angive en adgangskode til administratoren. Som du kan se bliver koden <span class="inl_cmd">123qwe</span> angivet som svag. En god adgangskode bør have mindst 8 tegn (gerne mere), som er en blanding mellem store og små bogstaver, tal og tegn.<br/><br/>Af samme grund skal det bekræftiges at man anvender en svag adgangskode. </td>
		</tr>
		<tr>
			<td>Din e-mail</td>
			<td>Wordpress-administratorens email. Anvendes til notifikationer og vigtige beskeder.</td>
		</tr>
		<tr>
			<td>Søgemaskinesynlighed</td>
			<td>Ved at sætte flueben her vil nogle søgemaskiner ikke indeksere din hjemmeside. Det er ikke nogen garanti for at det også forholder sig sådan.</td>
		</tr>
	</tbody>
</table>


<figure id="">

	<img class="p90" src="images/webserver_wordpress_setup05.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Efter at informationerne er indtastet vælges <span class="knap">Installer Wordpress</span>, og der kommer en side der bekræftiger at Wordpress er installeret med succes. Vælg <span class="knap">Login</span>.</p>

<figure id="">

	<img class="p90" src="images/webserver_wordpress_setup06.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<span class="afsnit">Første login</span>

<p>Login med dit valgte brugernavn og kode. Vælg kun <span class="inl_cmd">Husk mig</span>, hvis du sidder på din lokale computer.</p>

<figure id="">

	<img class="p35" src="images/webserver_wordpress_setup07.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Efter login får du adgang til kontrolpanelet.</p>

<figure id="">

	<img class="p90" src="images/webserver_wordpress_setup08.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<span class="afsnit">Første kig på din side</span>

<p>I øverste venstre hjørne klikker du på "Min Wordpress", hvorefter du får adgang til din hjemmeside som den ser ud for dem som besøger den.</p>

<figure id="">

	<img class="p70" src="images/webserver_wordpress_setup09.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<figure id="">

	<img class="p90" src="images/webserver_wordpress_setup10.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<h2>Sæt sikkerheden</h2>

<p>Problemet med sikkerhed er, at en ting er hvad der er sikkert, og en anden ting er hvad der er let. Hvis man ønsker at det skal være let at opdatere og vedligeholde Wordpress, så bliver man nød til at åbne for rettigheder. Herunder er angivet anvisninger til en fornuftig opsætning. Og her vil vi anvende scriptet herunder:</p>

<p>Sørg for at du står i din home-mappew og kopier indholdet af nedestående script ind i filen <span class="inl_cmd">wordpress_rettigheder.sh</span></p>

<code class="cmd">cd ~</code>

<code class="more_cmd">nano wordpress_rettigheder.sh</code>

<pre class="black">
#!/bin/bash

### Scriptet er inspireret af
### https://docs.nextcloud.org/server/9/admin_manual/installation/installation_wizard.html#setting-strong-directory-permissions
### Rettelser er lavet efter de guidelines som anbefales af wordpress:
### https://codex.wordpress.org/Hardening_WordPress

wpPath='/var/www/html'
htuser='www-data'
htgroup='www-data'
rootuser='root'

printf "chmod Files and Directories\n"
find ${wpPath}/ -type f -print0 | xargs -0 chmod 0640
find ${wpPath}/ -type d -print0 | xargs -0 chmod 0750

printf "chown Directories\n"
chown -R ${rootuser}:${htgroup} ${wpPath}/
chown -R ${htuser}:${htgroup} ${wpPath}/wp-admin/
chown -R ${htuser}:${htgroup} ${wpPath}/wp-content/
chown -R ${htuser}:${htgroup} ${wpPath}/wp-includes/

printf "chmod/chown .htaccess\n"
chmod 0644 ${wpPath}/.htaccess
chown ${rootuser}:${htgroup} ${wpPath}/.htaccess
</pre>

<p>Sæt rettigheder så filen kan køres:</p>

<code class="cmd">chmod 700 wordpress_rettigheder.sh</code>

<p>Scriptet er lavet så det skal køres i en <span class="inl_cmd">root</span>-shell. Det gør vi ved at køre kommandoen <span class="inl_cmd">sudo su</span>.</p>

<pre class="ubuntu_terminal">
thoj@mainsrv:~$ sudo su
Adgangskode: 
root@mainsrv:/home/thoj#
</pre>

<p>Læg mærke til at linien skifter fra <span class="inl_cmd">thoj@mainsrv:~$</span> til <span class="inl_cmd">root@mainsrv:/home/thoj#</span>. Kør scriptet i root-shell med kommandoen:</p>

<code class="cmd">./nextcloud_rettigheder.sh </code>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# ./wordpress_rettigheder.sh 
chmod Files and Directories
chown Directories
chmod/chown .htaccess
root@mainsrv:/home/thoj# 
</pre>

<p>Efter scriptet er kørt er alle filer og mapper konfigureret på den bedst mulige måde. Afslut <span class="inl_cmd">root</span>-shell med kommandoen <span class="inl_cmd">exit</span>.</p>

<pre class="ubuntu_terminal">
root@mainsrv:/home/thoj# exit
exit
thoj@mainsrv:~$ 
</pre>

<!--

<h1>Webmin</h1>

<p>Webmin er et webinterface til at tilgå serveren med. Den indeholder mange konfigurationsmuligheder. Tilføj 2 repositories til <span class="inl_cmd">/etc/apt/sources.list</span></p>

<pre class="black">
deb http://download.webmin.com/download/repository sarge contrib
deb http://webmin.mirror.somersettechsolutions.co.uk/repository sarge contrib
</pre>

<p>Hent og installer webmins GPG nøgle</p>

<code class="cmd">cd /root</code>

<code class="more_cmd">wget http://www.webmin.com/jcameron-key.asc -O- | apt-key add -</code>

<p>Opdater apt og installer webmin</p>

<code class="cmd">apt update && apt install webmin -y</code>

<p>Efter installationen er færdig kan du tilgå webmin ved at anvende adressen <a href="https://10.0.2.10:10000" target="_blank">https://10.0.2.10:10000</a>. Logger du ind med en bruger fra sudo gruppen har du administratorrettigheder når webmin kører.</p>

<figure id="">

	<img class="p90" src="images/fildeling_webmin.png" alt="" title="" />

	<figcaption></figcaption>

</figure>

<p>Som du kan se giver webmin et overblik over serverens status, og giver adgang til de tjenester du har installeret. Webmin er et meget kraftfuldt værktøj og har automatiseret mange af de opgaver man skal udføre som administrator. Som alle andre værktøjer på en server skal man tænke sig om når man anvender det.</p>

-->

<p></p>
<p></p>
<p></p>
<p></p>





	</body>

</html>





