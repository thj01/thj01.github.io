<!DOCTYPE html>
<html lang="da">
<head>
  <title>Harddiske</title>
  <link rel="icon" href="../images/favicon.png">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu|Ubuntu+Condensed' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/stylesheets/jquery.tocify.min.css">
  <link rel="stylesheet" href="../css/style_new.css" />
<!-- Scripts in bottom to speed up pageload-->
 

</head>
<body>
	
	
<div class="container-fluid">

<div class="row">
	
<div class="col-sm-3">
	
	<nav>
		
		<div id="toc">
		
			<div id="toc_headline"></div>
		
		</div>
		
	</nav>

</div><!-- Start slut 1. kolonne - TOC -->
	
<div class="col-sm-9">
	
<h1>Terminalen: Harddiske og partitioner</h1>

<h2>Grundbegreber</h2>

<p>For at forstå måden Linux arbejder med harddiske, tager vi lige et kig på opsætningen af den server du kan sætte op ved hjælp af Ubuntu Guiden (<a href="Ubuntuserver_20.04_installation.html" target="_blank">Ubuntuserver_20.04_installation.html</a>). Kommandoen vi har brugt bliver gennemgået længere nede.</p>

<samp>NAME                      TYPE FSTYPE        SIZE RO TYPE MOUNTPOINT
loop0                     loop squashfs     97.9M  1 loop /snap/core/10444
loop1                     loop squashfs     55.4M  1 loop /snap/core18/1932
loop2                     loop squashfs       55M  1 loop /snap/core18/1880
loop3                     loop squashfs    125.9M  1 loop /snap/docker/471
loop4                     loop squashfs     71.3M  1 loop /snap/lxd/16099
loop5                     loop squashfs     67.8M  1 loop /snap/lxd/18150
loop6                     loop squashfs     31.1M  1 loop /snap/snapd/10492
loop7                     loop squashfs     15.3M  1 loop /snap/wormhole/112
loop8                     loop squashfs     29.9M  1 loop /snap/snapd/8542
sda                       disk               100G  0 disk 
├─sda1                    part                 1M  0 part 
├─sda2                    part ext4            1G  0 part /boot
└─sda3                    part LVM2_member    99G  0 part 
  └─ubuntu--vg-ubuntu--lv lvm  ext4           30G  0 lvm  /
sr0                       rom               1024M  0 rom  </samp>

<p>I første række er der nævnt 3 forskellige ting: loop, sda og sr0.</p>

<p>Det eneste navn der viser til en fysisk harddisk er <em>sda</em>, og den er på 100 GB. Linux kalder alle disse enheder for et <em>block device</em> - herefter kaldet en <em>blok enhed</em>.</p>

<h2>Blok enhed (Block device)</h2>

<p>Simpelt fortalt er en blok en fastsat størrelse af data (f.eks. 512 kb), og en blokenhed - ja den kan kan man hente blokke fra og i mange tilfælde også skrive til den. Man kan f.eks. både læse og skrive til en harddisk, men man kan ikke skrive til en almindelig CD.</p>

<p>I billed sprog:</p>

<ul class="disc">
	<li>En bog = block</li>
	<li>En reol = block device</li>
	<li>et bibliotek = cluster</li>
</ul>

<p>Så alt vi over kan vi altså læse fra ... og skrive til. I eksemplet øverst angiver tallet 1 under <em>RO</em>, at <em>read only</em> er aktiveret.</p>

<details>

	<summary>Beskrivelse fra Wikipedia (engelsk)</summary>

	<p>
		In computing (specifically data transmission and data storage), a block, sometimes called a physical record, is a sequence of bytes or bits, usually containing some whole number of records, having a maximum length; a block size. Data thus structured are said to be blocked.
	</p>
	
	<p><a href="https://en.wikipedia.org/wiki/Block_(data_storage)" target="_blank">https://en.wikipedia.org/wiki/Block_(data_storage) [15.12.2020]</a></p>


</details>

<p>Her vil jeg gennemgå de 3 blok enhedstyper vi har på serveren:</p>

<ul class="disc">
	<li>Loops</li>
	<li>sda</li>
	<li>sr0</li>
</ul>

<h3>sda</h3>

<p><em>sda</em> er vores fysiske harddisk, og vi kan se at der er 3 partitioner på den:</p>

<samp><b>NAME                      TYPE FSTYPE        SIZE RO TYPE MOUNTPOINT</b>
sda                       disk               100G  0 disk 
├─sda1                    part                 1M  0 part 
├─sda2                    part ext4            1G  0 part /boot
└─sda3                    part LVM2_member    99G  0 part 
  └─ubuntu--vg-ubuntu--lv lvm  ext4           30G  0 lvm  /</samp>
  
<p>Kun to af enhederne er tilgængelige (monteret). <em>/boot</em> (1 GB), indeholder de filer der skal bruges til at boote computeren med og <em>/</em> (30GB) er roden, som indeholder alt andet.</p>

<p>Vi kan altså se at det er muligt både at læse og skrive til dem, da RO = 0.</p>

<h3>loop</h3>

<samp>NAME                      TYPE FSTYPE        SIZE RO TYPE MOUNTPOINT
loop0                     loop squashfs     97.9M  1 loop /snap/core/10444
loop1                     loop squashfs     55.4M  1 loop /snap/core18/1932
loop2                     loop squashfs       55M  1 loop /snap/core18/1880
loop3                     loop squashfs    125.9M  1 loop /snap/docker/471
loop4                     loop squashfs     71.3M  1 loop /snap/lxd/16099
loop5                     loop squashfs     67.8M  1 loop /snap/lxd/18150
loop6                     loop squashfs     31.1M  1 loop /snap/snapd/10492
loop7                     loop squashfs     15.3M  1 loop /snap/wormhole/112
loop8                     loop squashfs     29.9M  1 loop /snap/snapd/8542</samp>

<p>Et loop er i ubuntu en mappe, der bliver behandlet somom det var en harddisk. Alle loop ligger i mappen <em>/snap</em>.</p>

<pre><code>ls -al /snap</code></pre>

<samp>total 40
drwxr-xr-x  9 root root 4096 Dec 14 09:37 <span class="terminal_blue"><b>.</b></span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue"><b>..</b></span>
drwxr-xr-x  2 root root 4096 Dec 14 12:41 <span class="terminal_blue"><b>bin</b></span>
drwxr-xr-x  3 root root 4096 Dec 14 09:36 <span class="terminal_blue"><b>core</b></span>
drwxr-xr-x  4 root root 4096 Dec 14 12:41 <span class="terminal_blue"><b>core18</b></span>
drwxr-xr-x  3 root root 4096 Dec 14 09:37 <span class="terminal_blue"><b>docker</b></span>
drwxr-xr-x  4 root root 4096 Dec 14 12:41 <span class="terminal_blue"><b>lxd</b></span>
-r--r--r--  1 root root  548 Dec 14 09:36 README
drwxr-xr-x  4 root root 4096 Dec 14 12:41 <span class="terminal_blue"><b>snapd</b></span>
drwxr-xr-x  3 root root 4096 Dec 14 09:37 <span class="terminal_blue"><b>wormhole</b></span></samp>

<p><em>snap</em> er et software pakke- og distrubutionssystem, der er udviklet af Canonical, og som virker på tværs af mange Linux distributioner.</p>

<p>Ved at have et program installeret som snap (som små block enheder), svarer det til at det ligger på en harddisk, som ikke er en del af selve systemet. Udvikleren har altså helt styr på hvad der skal opdateres og ændres. Og han ved præcist hvor de ligger i systemet.</p>

<h3>sr0</h3>

<p><em>/dev/sr0</em> er computerens CD/DVD/BR-drev. Selvom du ikke har installeret et drev, så er det registreret som en blok enhed. Ubuntu har altså lavet plads til at der kan komme data ind.</p>

<samp>NAME                      TYPE FSTYPE        SIZE RO TYPE MOUNTPOINT
sr0                       rom               1024M  0 rom  </samp>

<p>I Linux </p>


<h2>Harddisk betegnelser</h2>

<p>Linuxsystemet administrerer sine diske ved hjælp af den fysiske placering på bundkortet. Betegnelsen <em>sd</em> står for, at det er en fysisk harddisk. Bogstaverne bagefter står for hvilken harddisk det er. </p>

<p>Når systemet bliver installeret bliver der lavet en enhed i <em>/dev</em>. Harddiskene bliver navngivet på følgende måde:</p>

<ul class="disc">
	<li>/dev/sda - 1. harddisk</li>
	<li>/dev/sdb - 2. harddisk</li>
	<li>/dev/sdc - 3. hardidsk</li>
	<li>...</li>
</ul>

<h2>Partitioner</h2>

<p>For at kunne bruge en harddiskene skal den have en eller partitoner. Det kan du gøre enten ved hjælp af <em>MBR</em> (Master Boot Record) eller <em>GPT</em> (GUID Partition Table).</p>

<dl class="">
	<dt>MBR</dt>
	<dd>Harddiske op til 2 TB </dd>
	<dd>Maks. 4 primære partitioner</dd>
	<dd>Maks </dd>
	<dt>GPT</dt>
	<dd>Harddiske op til 9,4 ZB (9.400.000.000 TB)</dd>
	<dd>Uendlig - dog ofte begrænset til 128</dd>
</dl>

<p>Selve den fysiske harddisk skal gøres tilgængelig for et filsystem. Det gøres ved hjælp af partitioner (inddelinger), som formateres med et filsystem. Her findes der to typer: <em>primære</em>- og <em>logiske</em> partitioner. De logiske partitioner ligger på en udvidet primær partition.</p>

<p>Sidder du på en Ubuntu 20.04 Desktop, så anvender dit system sandsynligvis MBR</p>

<p>Sidder du på en Ubuntu 20.04 Server, så anvender dit system GPT</p>

<h3>MBR</h3>

<p>Der kan være 4 primære partitioner på en harddisk. Den 4. primære partition kan bruges til at lave op til 12 logiske partitioner.</p>

<dl class="">
	<dt>dev/sda1</dt>
	<dd>den 1. primære partition</dd>
	<dt>dev/sda2</dt>
	<dd>den 2. primære partition</dd>
	<dt>dev/sda3</dt>
	<dd>den 3. primære partition</dd>
	<dt>dev/sda4</dt>
	<dd>den 4. primære partition eller styrenhed for de logiske drev</dd>
	<dt>dev/sda5</dt>
	<dd>den 1. logiske partition</dd>
	<dt>dev/sda6</dt>
	<dd>den 2. logiske partition</dd>
	<dt>...</dt>
	<dt>dev/sda15</dt>
	<dd>den 15. logiske partition</dd>
</dl>

<p>Systemet herover har oprettet 3 (sda1-3).</p>

<h3>GPT</h3>

<p>Der kan være mange primære partitioner på en harddisk. I praksis er antallet ofte begrænset til 128.</p>

<dl class="">
	<dt>dev/sda1</dt>
	<dd>den 1. primære partition</dd>
	<dt>dev/sda2</dt>
	<dd>den 2. primære partition</dd>
	<dt>dev/sda3</dt>
	<dd>den 3. primære partition</dd>
	<dt>dev/sda4</dt>
	<dd>den 4. primære partition</dd>
	<dt>dev/sda5</dt>
	<dd>den 5. primære partition</dd>
	<dt>...</dt>
</dl>


<h2>Filsystemer</h2>

<p>Filsystemet er det som holder styr på hvor data på disken befinder sig.</p>

<p>På Ubuntu anvendes filsystemet <em>EXT4</em> som standard.</p>

<p>I overblikket herunder anvendes størrelser som PiB og EiB. Du kan finde en oversigt over størrelserne her: <a href="Term_data_størrelser.html" target="_blank">Term_data_størrelser.html</a></p>



<h3>EXT4</h3>

<ul class="none">
	<li>Max. størrelse: 1 EiB</li>
	<li>Max. filstørrelse: 16 TiB</li>
	<li>Max. fillængde: 255 bytes</li>
	<li>Max. Antal filer: 4 mia</li>
	<li>Introduceret: 2008</li>
</ul>

<p>Læs mere: <a href="https://en.wikipedia.org/wiki/Ext4" target="_blank">https://en.wikipedia.org/wiki/Ext4</a></p>

<h3>XFS</h3>

<p>Dette filsystem er blevet standard på <abbr title="Red Hat Enterprice Linux">RHEL</abbr> (Red Hat Enterprice Linux) og  <a href="https://en.wikipedia.org/wiki/NASA_Advanced_Supercomputing_Division" target="_blank">NASA Advanced Supercomputing Division</a></p>

<ul class="none">
	<li>Max. størrelse: 16 EiB</li>
	<li>Max. filstørrelse: 16 EiB</li>
	<li>Max. fillængde: 255 bytes</li>
	<li>Max. Antal filer: <span class="math">\( 2^{64} \)</span></li>
	<li>Introduceret: 1994</li>
</ul>

<p>Læs mere: <a href="https://en.wikipedia.org/wiki/xfs" target="_blank">https://en.wikipedia.org/wiki/xfs</a></p>

<h3>BTRFS</h3>

<p>BTRFS er et såkald <abbr title="copy-on-write">COW</abbr>- system (Copy-On-Write). I praksis betyder det, at det har indbygget en "snapshot" mulighed, så man kan vende tilbage til en tidligere tilstand. Det har også mange andre system tekniske avancerede muligheder.</p>

<p>Filsystemet anvendes som standard af SUSE LES (SUSE Linux Enterprise Server)</p>

<ul class="none">
	<li>Max. størrelse: 16 EiB</li>
	<li>Max. filstørrelse: 16 EiB</li>
	<li>Max. fillængde: 255 ASCII karakterer</li>
	<li>Max. Antal filer: <span class="math">\( 2^{64} \)</span></li>
	<li>Introduceret: 2009</li>
</ul>

<p>Læs mere: <a href="https://en.wikipedia.org/wiki/Btrfs" target="_blank">https://en.wikipedia.org/wiki/Btrfs</a></p>

<h3>Andre filsystemer</h3>

<h4>FAT32</h4>

<ul class="none">
	<li>Max. størrelse: 16 TiB</li>
	<li>Max. filstørrelse: 256 GiB</li>
	<li>Max. fillængde: 255 bytes</li>
	<li>Max. Antal filer: 268 mio.</li>
	<li>Introduceret: 1996</li>
</ul>

<p>Læs mere: <a href="https://en.wikipedia.org/wiki/fat32" target="_blank">https://en.wikipedia.org/wiki/fat32</a></p>

<h4>NTFS</h4>

<ul class="none">
	<li>Max. størrelse: 256 TiB </li>
	<li>Max. filstørrelse: 8 PiB</li>
	<li>Max. fillængde: 255 bytes</li>
	<li>Max. Antal filer: 4,3 mia (<span class="math">\( 2^{32}-1 \)</span>)</li>
	<li>Introduceret: 1993</li>
</ul>

<p>Læs mere: <a href="https://en.wikipedia.org/wiki/NTFS" target="_blank">https://en.wikipedia.org/wiki/NTFS</a></p>

<h2>lsblk</h2>

<p><em>lsblk</em> bruges til at få overblik over systemets harddiske. Det var den kommando der gav os overblikket i starten af siden.</p>

<pre><code>lsblk</code></pre>

<samp>NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
loop0                       7:0    0  97.9M  1 loop /snap/core/10444
loop1                       7:1    0  55.4M  1 loop /snap/core18/1944
loop2                       7:2    0  55.4M  1 loop /snap/core18/1932
loop3                       7:3    0 125.9M  1 loop /snap/docker/471
loop4                       7:4    0  71.3M  1 loop /snap/lxd/16099
loop5                       7:5    0  67.8M  1 loop /snap/lxd/18150
loop6                       7:6    0  15.3M  1 loop /snap/wormhole/112
loop7                       7:7    0  31.1M  1 loop /snap/snapd/10492
loop8                       7:8    0  29.9M  1 loop /snap/snapd/8542
sda                         8:0    0   100G  0 disk 
├─sda1                      8:1    0     1M  0 part 
├─sda2                      8:2    0     1G  0 part /boot
└─sda3                      8:3    0    99G  0 part 
  └─ubuntu--vg-ubuntu--lv 253:0    0    30G  0 lvm  /
sr0                        11:0    1  1024M  0 rom  </samp>

<div class="alert">
	<p>Herefter udelader jeg loops fra udskrifterne, for at give et bedre overblik</p>
</div>

<p><em>lsblk</em> kan give langt flere informationer ved at angive nogle options. Kommandoen skal køres som root, da nogle af informationerne kræver root-rettigheder </p>

<pre><code>sudo lsblk -o name,type,fstype,size,ro,type,mountpoint</code></pre>

<samp>NAME                      TYPE FSTYPE        SIZE RO TYPE MOUNTPOINT
sda                       disk               100G  0 disk 
├─sda1                    part                 1M  0 part 
├─sda2                    part ext4            1G  0 part /boot
└─sda3                    part LVM2_member    99G  0 part 
  └─ubuntu--vg-ubuntu--lv lvm  ext4           30G  0 lvm  /
sr0                       rom               1024M  0 rom  </samp>

<p>Vi kan se at <em>sda</em> er delt ind i 3 partitioner og hvad de er sat op som.</p>

<p>Vi kan også gøre output mere brugervenligt, f.eks. hvis vi kun vil se navn (placering), fstype (filtype) og monteringspunkt (mountpoint)</p>

<pre><code>sudo lsblk -o name,fstype,mountpoint</code></pre>

<samp>NAME                      FSTYPE      MOUNTPOINT
sda                                   
├─sda1                                
├─sda2                    ext4        /boot
└─sda3                    LVM2_member 
  └─ubuntu--vg-ubuntu--lv ext4        /
sr0              </samp>

<p>Vi kan også filtrere ved hjælp af <em>grep</em>, så vi kun finder de linier der indeholder vores søgning.</p>

<pre><code>sudo lsblk -o name,fstype,mountpoint | grep sda</code></pre>

<samp>NAME                      FSTYPE      MOUNTPOINT
<span class="red">sda</span>                                   
├─<span class="red">sda</span>1                                
├─<span class="red">sda</span>2                    ext4        /boot
└─<span class="red">sda</span>3                    LVM2_member</samp>

<pre><code>sudo lsblk -o name,fstype,mountpoint | grep sda\|LVM</code></pre>

<p>Eller hvis vi vil finde alle partitioner der er på sda og/eller der er formateret med ext</p>

<pre><code>sudo lsblk -o name,fstype,mountpoint | grep "sda\|ex4"</code></pre>

<samp>sda                                   
├─<span class="red">sda</span>1                                
├─<span class="red">sda</span>2                    <span class="red">ext</span>4        /boot
└─<span class="red">sda</span>3                    LVM2_member 
  └─ubuntu--vg-ubuntu--lv <span class="red">ext</span>4        /

</samp>

<h2>Find dine harddiske</h2>

<p>Fremgangsmåden til at konfigurere en harddisk er, at den skal:</p>

<ol class="">
	<li>Identificeres,</li>
	<li>Partitioneres,</li>
	<li>Formateres og</li>
	<li>Monteres</li>
</ol>

<p><em>lsblk</em> viser hvad operativsystemet kan se. Hvis vi ønsker at kigge på selve harddisken skal vi anvende programmet <em>parted</em>. <em>parted</em> skal køres som root Dette program konfigurerer selve harddisken og hvordan den er inddelt. </p>

<pre><code>sudo parted -l</code></pre>

<samp>Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sda: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  1076MB  1074MB  ext4
 3      1076MB  107GB   106GB


Model: Linux device-mapper (linear) (dm)
Disk /dev/mapper/ubuntu--vg-ubuntu--lv: 32.2GB
Sector size (logical/physical): 512B/512B
Partition Table: loop
Disk Flags: 

Number  Start  End     Size    File system  Flags
 1      0.00B  32.2GB  32.2GB  ext4

</samp>

<p><em>sda</em> blliver gjort tilgængelig for Linux ved hjælp af filen <em>/etc/fstab</em>. Vi kan kigge på filen ved hjælp af <em>cat</em>.</p>

<pre><code>cat /etc/fstab</code></pre>

<samp># /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system&gt; &lt;mount point&gt;  &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
/dev/disk/by-id/dm-uuid-LVM-5foacIv7aI3Fuz8tf2KlDE8OJ3cmezW6oep8ijeIRlOKJ1m54NkpmIZqhu439hfM / ext4 defaults 0 0
# /boot was on /dev/sda2 during curtin installation
/dev/disk/by-uuid/f7edd0c3-3730-4ad6-ae7e-4eb45afc3ba2 /boot ext4 defaults 0 0
/swap.img	none	swap	sw	0	0</samp>

<p>Det er meget rodet, men det der står om den første disk er:</p>

<dl class="">
	<dt>file</dt>
	<dd>/dev/disk/by-id/dm-uuid-LVM-5foacIv7aI3Fuz8tf2KlDE8OJ3cmezW6oep8ijeIRlOKJ1m54NkpmIZqhu439hfM</dd>
	<dt>mount point</dt>
	<dd>/</dd>
	<dt>type</dt>
	<dd>ext4</dd>
	<dt>options</dt>
	<dd>default</dd>
	<dt>dump</dt>
	<dd>0</dd>
	<dt>pass</dt>
	<dd>0</dd>
</dl>

<p>Det lange filnavn er en UUID (Universally Unique IDentifier ), som er specielt for lige præcis den harddisk. Det er et ekstra sikkerhedsniveau.</p>


<h2>Partitionering (parted)</h2>

<p>Harddiske partitioneres af programmet <em>parted</em>.</p>

<p>Her vil vi partitionere end ny harddisk vi sætter på systemet, som bliver genkendt som <em>/dev/sdb</em>. Harddisken er på 100 GB, og vi lave to partitioner på henholdsvis 30GB og 70 GB.</p>

<p>Vi ser på harddiskene på systemet efter vi har sat den nye disk i.</p>

<pre><code>sudo parted -l</code></pre>

<samp>Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sda: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  1076MB  1074MB  ext4
 3      1076MB  107GB   106GB


<span class="red">Error: /dev/sdb: unrecognised disk label
Model: ATA VBOX HARDDISK (scsi)                                           
Disk /dev/sdb: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: unknown
Disk Flags:</span> 

Model: Linux device-mapper (linear) (dm)
Disk /dev/mapper/ubuntu--vg-ubuntu--lv: 32.2GB
Sector size (logical/physical): 512B/512B
Partition Table: loop
Disk Flags: 

Number  Start  End     Size    File system  Flags
 1      0.00B  32.2GB  32.2GB  ext4
</samp>

<p>Her kan vi se vi får en fejl ved linien <em>ERROR: /dev/dsb</em>, som jeg har markeret med rødt. Det er fordi den endnu ikke har en partitionstabel.</p>

<p>Åbn <em>/dev/sdb</em> med parted</p>

<pre><code>sudo parted /dev/sdb</code></pre>

<samp>GNU Parted 3.3
Using /dev/sdb
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted)   </samp>

<p>Læg mærke til at vi får en ny kommandoprompt. Først kan vi kigge på hvad vi kan ved at skrive kommandoen <em>help</em>.</p>

<pre><code>help</code></pre>

<samp>  align-check TYPE N                       check partition N for TYPE(min|opt) alignment
  help [COMMAND]                           print general help, or help on COMMAND
  mklabel,mktable LABEL-TYPE               create a new disklabel (partition table)
  mkpart PART-TYPE [FS-TYPE] START END     make a partition
  name NUMBER NAME                         name partition NUMBER as NAME
  print [devices|free|list,all|NUMBER]     display the partition table, available devices, free space, all found partitions, or a particular partition
  quit                                     exit program
  rescue START END                         rescue a lost partition near START and END
  resizepart NUMBER END                    resize partition NUMBER
  rm NUMBER                                delete partition NUMBER
  select DEVICE                            choose the device to edit
  disk_set FLAG STATE                      change the FLAG on selected device
  disk_toggle [FLAG]                       toggle the state of FLAG on selected device
  set NUMBER FLAG STATE                    change the FLAG on partition NUMBER
  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition NUMBER
  unit UNIT                                set the default unit to UNIT
  version                                  display the version number and copyright information of GNU Parted
</samp>

<div class="alert">
	
	<p>Hvis du på noget tidspunkt bliver i tvivl om du har gjort det rigtigt kan du altid trykke <kbd>Ctrl</kbd>+<kbd>c</kbd>. Så stopper du programmet. </p>
	
</div>

<p>Lav en GPT partionstabel</p>

<pre><code>mklabel gpt</code></pre>

<p>Sæt standardenheden til GB</p>

<pre><code>unit gb</code></pre>

<p>Vi tager et overblik</p>

<pre><code>print</code></pre>

<samp>Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sdb: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start  End  Size  File system  Name  Flags</samp>

<p>Vi kan se at parted ser en harddisk på 107GB (da 107GB = 100GiB). Vi ændrer derfor harddiskene til henholdsvis 32GB og 75GB.</p>


<p>Lav en ext4 partiton på 32GB (fra 0 - 32 GiB)</p>

<pre><code>mkpart primary ext4 0 32</code></pre>

<p>Lav en ext4 partiton på 75GiB (fra 32-107 GiB)</p>

<pre><code>mkpart primary ext4 32 107</code></pre>

<p>Vi laver en udskrift for at se om alt er korrekt.</p>

<pre><code>print</code></pre>

<samp>Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sdb: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name     Flags
 1      0.00GB  32.0GB  32.0GB  ext4         primary
 2      32.0GB  107GB   75.4GB  ext4         primary
</samp>

<p>Det er om det skal være og vi forlader <em>parted</em>:</p>

<pre><code>quit</code></pre>

<p>Vi kan lige se hvordan systemet ser den nye harddisk</p>

<pre><code>sudo parted -l</code></pre>

<samp>Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sda: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  1076MB  1074MB  ext4
 3      1076MB  107GB   106GB


<span class="green">Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sdb: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name     Flags
 1      1049kB  32.0GB  32.0GB               primary
 2      32.0GB  107GB   75.4GB               primary</span>


Model: Linux device-mapper (linear) (dm)
Disk /dev/mapper/ubuntu--vg-ubuntu--lv: 32.2GB
Sector size (logical/physical): 512B/512B
Partition Table: loop
Disk Flags: 

Number  Start  End     Size    File system  Flags
 1      0.00B  32.2GB  32.2GB  ext4

</samp>

<p>Denne gang kommer der ikke nogen fejlmeddelelse, og hardiskens partitioner står fint frem.</p>

<h3>Filsystemer</h3>

<p><em>parted</em> understøtter en del filsystemer. I vores sammenhæng er følgende relevante:</p>

<dl class="">
	<dt>ext4</dt>
	<dd>Linux</dd>
	<dt>FAT32</dt>
	<dd>USB-diske</dd>
	<dt>NTFS</dt>
	<dd>Drev der skal være windows compatible</dd>
</dl>

<p>Du kan finde alle understøttede drev her: <a href="https://www.gnu.org/software/parted/manual/parted.html#mkpart" target="_blank">https://www.gnu.org/software/parted/manual/parted.html#mkpart</a></p>


<h3>Partitionering med script</h3>

<p>Det kan også lade sig gøre at partitionere harddiskene ved hjælp af et script. Se på eksemplet herunder, hvor skråstregen gør at kommandoen laver et linieskift hver gang:</p>

<pre><code>sudo parted /dev/sdb --script \ mklabel gpt \ unit gb \ mkpart primary ext4 0 32 \ mkpart primary ext4 32 107 </code></pre>

<p>Det er måske ikke så smart, når det kun er en harddisk vi skal partitionere... men det kan bruges hvis et system automatisk skal oprette diske fra bunden i et server setup.</p>

<p>Læs mere: <a href="https://www.gnu.org/software/parted/manual/parted.html" target="_blank">https://www.gnu.org/software/parted/manual/parted.html</a></p>

<h2>Formatering</h2>

<p>Harddisken skal fomateres til <em>ext4</em>. Det første vi gør er lige at skabe os et overblik:</p>

<pre><code>sudo lsblk -o name | grep sdb</code></pre>

<samp><span class="red">sdb</span>
├─<span class="red">sdb</span>1
└─<span class="red">sdb</span>2</samp>

<p>Vi skal altså have formateret harddiskene <em>/dev/sdb1</em> og <em>/dev/sdb2</em>. Det gør vi med kommandoen <em>mkfs.ext4</em>.</p>

<div class="alert">
	
	<p>Husk at du gør det på den rigtige harddisk. Hvis du ved en fejl vælger en af dine andre diske, så vil den blive formateret - og alle dine data er væk.</p>
	
</div>

<pre><code>sudo mkfs.ext4 /dev/sdb1</code></pre>

<samp>mke2fs 1.45.5 (07-Jan-2020)
Creating filesystem with 7812352 4k blocks and 1954064 inodes
Filesystem UUID: 623bda93-5cc6-49f3-bcc7-4e09c6d0937a
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done</samp>

<pre><code>sudo mkfs.ext4 /dev/sdb2</code></pre>

<samp>mke2fs 1.45.5 (07-Jan-2020)
Creating filesystem with 18401536 4k blocks and 4603904 inodes
Filesystem UUID: f835e2c2-a04e-422e-9314-87230522633f
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (131072 blocks): done
Writing superblocks and filesystem accounting information: done </samp>

<p>Vi tjekker om harddisken er formateret korrekt</p>

<pre><code>sudo lsblk -o name,fstype | grep ext4</code></pre>

<samp>├─sda2                     <span class="red">ext4</span>
  └─ubuntu--vg-ubuntu--lv  <span class="red">ext4</span>
├─sdb1                     <span class="red">ext4</span>
└─sdb2                     <span class="red">ext4</span>
</samp>

<p>Du kan se, at der nu er 4 drev der er formateret med <em>ext4</em>. Nu skal vi have dem monteret på filsystemet</p>

<h3>Andre filsystemer</h3>

<p>Du kan også formatere diske til andre filsystemer.</p>

<p>For at formatere til NTFS bruger du <em>mkfs.ntfs</em></p>

<pre><code>sudo mkfs.ntfs -f /dev/sdb1</code></pre>

<p>Læg mærke til optionen <em>-f</em>. Den er sat på, da NTFS drev som standard bliver initialiseret med 0'er. </p>

<p>Hvis du vil formatere til <em>FAT32</em> bruger du <em>mkfs.vfat</em>.</p>

<pre><code>sudo mkfs.vfat /dev/sdb1</code></pre>

<p>Du kan finde en komplet liste ved at starte med at skrive mkfs på kommendolinjen og så trykke <kbd>TAB</kbd>.</p>

<samp><span class="terminal_green">tj@server1</span>:<span class="terminal_tilde">~</span>$  mkfs
mkfs         mkfs.bfs     mkfs.btrfs   mkfs.cramfs  mkfs.ext2    mkfs.ext3    
mkfs.ext4    mkfs.fat     mkfs.minix   mkfs.msdos   mkfs.ntfs    mkfs.vfat    
mkfs.xfs</samp>



<h2>Fast montering i filsystemet</h2>

<p>Arbejdsgangen når man monterer en disk er følgende:</p>

<ol class="">
	<li>Oprette en mappe til at montere drevet i.</li>
	<li>Monteres på filsystemet (Montering)</li>
	<li>Konfigureres (Rettigheder)</li>
	<li>Find diskens UUID (sikkerhed)</li>
	
</ol>

<p>Her vil vi monteret vores nye partitioner på følgende måde:</p>

<ul class="disc">
	<li>/dev/sdb1 (32GB )monteres som /srv/backup </li>
	<li>/dev/sdb2 (75GB )monteres som /srv/data </li>
</ul>

<h3>Opret mapperne og sæt rettigheder</h3>

<pre><code>sudo mkdir /srv/backup /srv/backup</code></pre>

<h3>Monter på filsystemet</h3>

<p>Åbn <em>/etc/fstab</em> med <em>nano</em></p>

<samp># /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system> &lt;mount point>   &lt;type>  &lt;options>       &lt;dump>  &lt;pass>
# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
/dev/disk/by-id/dm-uuid-LVM-5foacIv7aI3Fuz8tf2KlDE8OJ3cmezW6oep8ijeIRlOKJ1m54Nk>
# /boot was on /dev/sda2 during curtin installation
/dev/disk/by-uuid/f7edd0c3-3730-4ad6-ae7e-4eb45afc3ba2 /boot ext4 defaults 0 0
/swap.img       none    swap    sw      0       0</samp>

<p>Tilføj disse linier i bunden af filen</p>

<samp>#Harddiske der er tilføjet efter installation
/dev/sdb1 /srv/backup ext4 defaults 0 2
/dev/sdb2 /srv/data ext4 defaults 0 2</samp>

<p>Filen skal se ud som her:</p>

<samp># /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system> &lt;mount point>   &lt;type>  &lt;options>       &lt;dump>  &lt;pass>
# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
/dev/disk/by-id/dm-uuid-LVM-5foacIv7aI3Fuz8tf2KlDE8OJ3cmezW6oep8ijeIRlOKJ1m54Nk>
# /boot was on /dev/sda2 during curtin installation
/dev/disk/by-uuid/f7edd0c3-3730-4ad6-ae7e-4eb45afc3ba2 /boot ext4 defaults 0 0
/swap.img       none    swap    sw      0       0
#Harddiske der er tilføjet efter installation
/dev/sdb1 /srv/backup ext4 defaults 0 2
/dev/sdb2 /srv/data ext4 defaults 0 2
</samp>

<p>Genstart serveren</p>

<pre><code>sudo reboot</code></pre>

<p>Efter du har logget på kan du kontrollere, at diskene er monteret korrekt.</p>

<pre><code>sudo lsblk -o name,mountpoint | grep sdb</code></pre>

<samp><span class="red">sdb</span>                  
├─<span class="red">sdb</span>1                    /srv/backup
└─<span class="red">sdb</span>2                    /srv/data</samp>


<p>Læs mere: <a href="https://help.ubuntu.com/community/Fstab" target="_blank">https://help.ubuntu.com/community/Fstab</a></p>

<h3>Rettigheder</h3>

<p>Drevene vi har monteret ovenfor er ejet af root.</p>

<pre><code>ls -al /srv</code></pre>

<samp>total 16
drwxr-xr-x  4 root root 4096 Dec 17 08:48 <span class="terminal_blue">.</span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue">..</span>
drwxr-xr-x  3 root root 4096 Dec 17 06:58 <span class="terminal_blue">backup</span>
drwxr-xr-x  3 root root 4096 Dec 17 08:06 <span class="terminal_blue">data</span>
</samp>

<p>For at ændre rettigheder på disse drev anvender vi <em>chown</em> og <em>chmod</em>.</p>

<p>I dette eksempel skifter jeg ejerskab til brugeren <em>tj</em> og giver <em>tj</em> alle rettigheder </p>

<p>Ændr ejerskab</p>

<pre><code>sudo chown -R tj:tj /srv/backup /srv/data</code></pre>

<p>Ændr rettigheder</p>

<pre><code>sudo chmod 700 /srv/backup /srv/data</code></pre>

<p>Vi kontrollerer</p>

<pre><code>ls -al /srv</code></pre>

<samp>total 16
drwxr-xr-x  4 root root 4096 Dec 17 08:48 <span class="terminal_blue">.</span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue">..</span>
drwx------  3 tj   tj   4096 Dec 17 06:58 <span class="terminal_blue">backup</span>
drwx------  3 tj   tj   4096 Dec 17 08:06 <span class="terminal_blue">data</span>
</samp>

<h3>Brug UUID (sikkerhed)</h3>

<p>Hvis du gerne vil øge sikkerheden, så kan du anvende disken UUID i stedet for harddisken placering (eks: <em>/dev/sdb1</em>) </p>

<p>Vi finder disken UUID.</p>

<pre><code>lsblk -o PATH,UUID | grep sdb</code></pre>

<samp>/dev/<span class="red">sdb</span>                          
/dev/<span class="red">sdb</span>1                         c7dabb59-10ee-4677-b49c-08a1037085b8
/dev/<span class="red">sdb</span>2                         ea24bfad-6db1-4d60-a803-80ff85c3f48e</samp>

<p>Her skal du altså lave følgende ændringer</p>

<ul class="disc">
	<li><em>/dev/sdb1</em> erstattes af <em>UUID=c7dabb59-10ee-4677-b49c-08a1037085b8</em></li>
	<li><em>/dev/sdb2</em> erstattes af <em>UUID=ea24bfad-6db1-4d60-a803-80ff85c3f48e</em></li>
</ul>

<p>Åbn <em>/etc/fstab</em> med <em>nano</em>:</p>

<pre><code>sudo nano /etc/fstab</code></pre>

<samp># /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system> &lt;mount point>   &lt;type>  &lt;options>       &lt;dump>  &lt;pass>
# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
/dev/disk/by-id/dm-uuid-LVM-5foacIv7aI3Fuz8tf2KlDE8OJ3cmezW6oep8ijeIRlOKJ1m54Nk>
# /boot was on /dev/sda2 during curtin installation
/dev/disk/by-uuid/f7edd0c3-3730-4ad6-ae7e-4eb45afc3ba2 /boot ext4 defaults 0 0
/swap.img       none    swap    sw      0       0
#Harddiske der er tilføjet efter installation
/dev/sdb1 /srv/backup ext4 defaults 0 2
/dev/sdb2 /srv/data ext4 defaults 0 2</samp>

<p>Kopier de to nederste linier og sæt <em>#</em> foran de første. På den måde kan vi altid få den gamle opsætning tilbage igen. Fremgangsmåde:</p>

<ol class="">
	<li>Marker tekst</li>
	<li>Tryk <kbd>Alt</kbd>+<kbd>6</kbd> (kopier)</li>
	<li>Flyt cursoren helt ned i bunde</li>
	<li>Tryk <kbd>Ctrl</kbd>+<kbd>U</kbd> (indsæt)</li>
	<li>Sæt <em>#</em> foran i de to første linjer </li>
</ol>

<samp>#Harddiske der er tilføjet efter installation
#/dev/sdb1 /srv/backup ext4 defaults 0 2
#/dev/sdb2 /srv/data ext4 defaults 0 2
/dev/sdb1 /srv/backup ext4 defaults 0 2
/dev/sdb2 /srv/data ext4 defaults 0 2</samp>

<p>Erstat ud fra følgende:</p>

<ul class="disc">
	<li><em>/dev/sdb1</em> erstattes af <em>UUID=c7dabb59-10ee-4677-b49c-08a1037085b8</em></li>
	<li><em>/dev/sdb2</em> erstattes af <em>UUID=ea24bfad-6db1-4d60-a803-80ff85c3f48e</em></li>
</ul>

<samp>#Harddiske der er tilføjet efter installation
#/dev/sdb1 /srv/backup ext4 defaults 0 2
#/dev/sdb2 /srv/data ext4 defaults 0 2
UUID=c7dabb59-10ee-4677-b49c-08a1037085b8 /srv/backup ext4 defaults 0 2
UUID=ea24bfad-6db1-4d60-a803-80ff85c3f48e /srv/data ext4 defaults 0 2
</samp>

<p>Genstart serveren og tjek, at partitionerne stadig er monteret.</p>

<pre><code>sudo reboot</code></pre>

<p>Efter serveren er genstartet</p>

<pre><code>sudo lsblk -o name,mountpoint | grep sdb</code></pre>

<samp><span class="red">sdb</span>                  
├─<span class="red">sdb</span>1                    /srv/backup
└─<span class="red">sdb</span>2                    /srv/data</samp>


<p><a href="https://help.ubuntu.com/community/InstallingANewHardDrive" target="_blank">https://help.ubuntu.com/community/InstallingANewHardDrive</a></p>

<h2>Midlertidig montering</h2>

<p>Nogle gange kan vi have brug for at montere en ekstern harddisk eller et USB-drev midlertidig, f.eks. et backup eller et transportdrev.</p>

<p>Her vil vi montere en transportabel harddisk med NTFS, og den registreret som <em>/dev/sdc</em>.</p>

<pre><code>sudo parted -l</code></pre>

<p>Herunder er det kun selve <em>/dev/sdc</em> jeg har vist</p>

<samp>Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sdc: 107GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End    Size   File system  Name        Flags
 1      1049kB  107GB  107GB  ntfs         USB-BACKUP  msftdata</samp>
 

<h3>Oprettelse af mappe</h3>

<p>Som standard monteres eksterne enheder i mappen <em>/media</em>. Her vil vi oprette mappen <em>/media/transport</em>.</p>

<pre><code>sudo mkdir /media/transport</code></pre>

<p>Tjek mappens rettigheder</p>

<pre><code>ls -al /media</code></pre>

<samp>total 12
drwxr-xr-x  3 root root 4096 Dec 17 11:53 <span class="terminal_blue">.</span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue">..</span>
drwxr-xr-x  2 root root 4096 Dec 17 11:53 <span class="terminal_blue">transport</span>
</samp>

<h3>Montering af NTFS drev</h3>

<p>Monter enheden til filsystemet</p>

<pre><code>sudo mount -t ntfs-3g /dev/sdc1 /media/transport</code></pre>

<p>Tjek mappens rettigheder</p>

<pre><code>ls -al /media</code></pre>

<samp>total 12
drwxr-xr-x  3 root root 4096 Dec 17 11:53 <span class="terminal_blue">.</span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue">..</span>
drwxrwxrwx  2 root root 4096 Dec 17 11:53 <span class="terminal_blue">transport</span>
</samp>

<div class="alert">
	<p>Læg mærke til at rettighederne er blevet ændret så der er fuld adgang til drevet for alle brugere.</p>
</div>

<h3>Montering af EXT4 drev</h3>

<p>Monter enheden til filsystemet</p>

<pre><code>sudo mount /dev/sdc1 /media/transport</code></pre>

<p>Læg mærke til at du ikke skal vælge filsystem, da default er <em>ext4</em></p>

<p>Tjek mappens rettigheder</p>

<pre><code>ls -al /media</code></pre>

<samp>total 12
drwxr-xr-x  3 root root 4096 Dec 17 11:53 <span class="terminal_blue">.</span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue">..</span>
drwxr-xr-x  2 root root 4096 Dec 17 11:53 <span class="terminal_blue">transport</span>
</samp>

<p>Læg mærke til at rettighederne IKKE er blevet ændret så det er kun root brugeren der har fuld adgang til drevet.</p>

<p>For at ændre ejerskab til en anden bruger anvendes <em>chown</em>. Her til brugeren <em>tj</em>:</p>

<pre><code>chown tj:tj -R tj:tj /media/transport</code></pre>

<p>Tjek rettigheder</p>

<samp>total 12
drwxr-xr-x  3 root root 4096 Dec 17 11:53 <span class="terminal_blue">.</span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue">..</span>
drwxr-xr-x  2 tj   tj   4096 Dec 17 11:53 <span class="terminal_blue">transport</span>
</samp>

<h3>Montering af VFAT/FAT32 drev</h3>

<p>Monter enheden til filsystemet</p>

<pre><code>sudo mount -t vfat /dev/sdc1 /media/transport/</code></pre>

<p>Læg mærke til at du ikke skal vælge filsystem, da default er <em>ext4</em></p>

<p>Tjek mappens rettigheder</p>

<pre><code>ls -al /media</code></pre>

<samp>total 12
drwxr-xr-x  3 root root 4096 Dec 17 11:53 <span class="terminal_blue">.</span>
drwxr-xr-x 20 root root 4096 Dec 14 09:03 <span class="terminal_blue">..</span>
drwxr-xr-x  2 root root 4096 Dec 17 11:53 <span class="terminal_blue">transport</span>
</samp>

<p>Læg mærke til at rettighederne IKKE er blevet ændret så det er kun root brugeren der har fuld adgang til drevet.</p>

<p>For at ændre ejerskab til en anden bruger anvendes <em>chown</em>. Her til brugeren <em>tj</em>:</p>

<pre><code>chown tj:tj -R tj:tj /media/transport</code></pre>


<h3>Fjern drev</h3>

<p>Drevet fjernes med følgende kommando</p>

<pre><code>sudo umount /media/transport</code></pre>

<p>Vi tjekker det er afmonteret</p>

<pre><code>lsblk | grep sdc</code></pre>

<samp><span class="red">sdc</span>                         8:32   0   100G  0 disk 
└─<span class="red">sdc</span>1                      8:33   0   100G  0 part /media/transport
</samp>

<div class="alert">
	<p>Vær opmærksom på at mappen /media/transport ikke er fjernet</p>
</div>
<!--


<h2>USB-boot disk</h2>

<p>Ofte har man brug for at lave en nøjagtig kopi af en partition, f.eks. når man skal brænde en ISO fil over på en USB disk. Dette gøres med programmet <code class="bash">dd</code>. Der findes også GUI programmer til det, men min erfaring er, at de nogle gange roder med partitionstabellen, så USB disken reelt bliver ubrugelig. <code class="bash">dd</code> virker altid!</p> 

<code class="cmd">dd if=*input fil* of=*destinations fil* *Optioner*</code>
<code class="more_cmd">sync</code>

<div class="alert">

	<p>	Det er vigtigt at køre sync efter man har kopieret data, da man risikerer at ikke al data er skrevet. Det skyldes at mange filskrivningsoperationerer cached, så operativsystemet kan vente med at skrive til det har tid.</p>

</div>

<p>Herunder er vist hele proceduren med at oprette en USB bootdisk fra en ISO. Vær opmærksom på at USB disken først have sin partitionstabel renset, hvis den har været anvendt til at brænde ISO filer før. Dette skyldes at den skrivbare del er "begrænset" til ISO-filens størrelse.</p>

<ol class="">
	<li>Kør <code class="bash">isohybrid</code> på isofilen: <br/><br/>
	
	<code class="cmd">isohybrid *isofil*</code><br/>
	
	</li>
	
	<li>Sæt USB-nøglen i, og vent til systemet har initialiseret den (ca. 5 sekunder)<br/><br/></li>
	
	<li>Afmonter USB nøglen: <code class="bash">umount *sti_til_USB*</code><br/><br/>
	
	<code class="cmd">sudo dd if=*sti_til_filen* of=*sti_til_USB*</code><br/><br/>
	
	</li>
		
	<li>Fjern eksisterende partitioner med <em>fdisk</em> og opret en ny. Lad den nye partition fylde hele USB-disken.<br/><br/></li>
	
	<li>kør <code class="bash">dd</code><br/><br/>
	
		<code class="cmd">sudo dd if=*sti_til_filen* of=*sti_til_USB*</code> <br/><br/>
		
		</li>
		
	<li>Vent til Terminalen <br/><br/></li>
		
	<li><strong>VIGTIGT: </strong>Kør <code class="bash">sync</code>, for at sikr dig at alle data er skrevet til USB disken </li>
</ol>

<p>På systemet vi her går ud fra er der i forvejen to harddiske, hvilket betyder at en USB-disk vil blive registreret som den efterfølgende, altså <em>/dev/sdc</em>.</p>

<p>I eksemplet herunder oprettes en USB-bootdisk med systemrescueCD. En distribution jeg varmt kan anbefale til systemarbejde. ISO filen er blevet hentet på nettet (<a href="https://www.system-rescue-cd.org/Download" target="_blank">https://www.system-rescue-cd.org/Download</a>) og placeret her <em>/data/systemrescuecd-x86-4.7.1.iso</em>.</p>

<p>Find ISO-filens placering og navn med: <code class="bash">ls -al /data | grep *.iso</code>.</p>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ ls -al /data | grep *.iso
-rw-rw-r--  1 tj tj 481296384 feb 25 11:40 <span class="red">systemrescuecd-x86-4.7.1.iso</span>
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sudo isohybrid /data/systemrescuecd-x86-4.7.1.iso 
</pre>

<p>USB-disken sættes i (vent 5 sekunder), afmonter disken og tjek at den er afmonteret</p>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ lsblk | grep sdc
<span class="red">sdc</span>      8:16   1   3,8G  0 disk 
└─<span class="red">sdc</span>1   8:17   1   3,8G  0 part /media/tj/663A-63FE
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sudo umount /dev/sdb1
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sudo lsblk | grep sdb
<span class="red">sdc</span>      8:16   1   3,8G  0 disk 
└─<span class="red">sdc</span>1   8:17   1   3,8G  0 part
</pre>

<p>Kopier ISO filen over på USB-nøglen (Det tager et par minutter alt efter størrelsen på isofilen) og kør <em>sync</em></p>

<pre class="ubuntu_terminal">
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sudo dd if=/data/systemrescuecd-x86-4.7.1.iso of=/dev/sdb
[sudo] password for tj: 
940032+0 blokke ind
940032+0 blokke ud
481296384 byte (481 MB) kopieret, 130,186 s, 3,7 MB/s
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$ sync
<span class="green1">tj@tj-VirtualBox</span>:<span class="blue1">~</span>$
</pre>

<p>Herefter kan USB-drevet fjernes og anvendes til at boote med.</p>


<p>Læs også: <a href="https://www.system-rescue-cd.org/Sysresccd-manual-en_How_to_install_SystemRescueCd_on_an_USB-stick" target="_blank">https://www.system-rescue-cd.org/Sysresccd-manual-en_How_to_install_SystemRescueCd_on_an_USB-stick</a></p>

<p>Læs også: <a href="https://wiki.archlinux.org/index.php/disk_cloning" target="_blank">https://wiki.archlinux.org/index.php/disk_cloning</a></p>

<p>man-page dd: 
	<a href="http://manpages.ubuntu.com/manpages/trusty/man1/dd.1.html" target="_blank">
	http://manpages.ubuntu.com/manpages/trusty/man1/dd.1.html</a></p>

-->


	
</div><!-- end: col-md-9 -->

<footer>

	<p onclick="parentNode.remove()"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons licens" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>Indholdet på Vidas.dk er licenseret under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> og er skrevet af Thomas Jensen. (<a href="../hvem_er_jeg.html" target="_blank">Læs mere</a>)</p>

</footer>
	
	
</div><!-- end: row -->

</div> <!-- end: container-fluid -->


<!-- SCRIPT SECTION -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script>



<!-- HIGHLIGHT -->
	<script src="../js/highlight.pack.js" type="text/javascript"></script>
	<script>hljs.initHighlightingOnLoad();</script>

<!-- MATHJAX -->
<script type="text/javascript" 
	src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "left",
  displayIndent: "0em"
});
</script>


<!-- TOCIFY -->
<script>
	$(function() {var toc = $("#toc").tocify({ selectors: "h2, h3, h4" }).data("toc-tocify"); });
</script>
<!-- GOOGLE ANALYTICS -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89933285-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
